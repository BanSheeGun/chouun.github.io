
  
    <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Standard Code Library 2016 | Fate / Unlimited Darkness</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ChouUn">
    

    
    <meta name="description" content="For The 16th Zhejiang University Programming Contest.
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263## 基本### 對拍 (for linux)### 文件">
<meta property="og:type" content="website">
<meta property="og:title" content="Standard Code Library 2016">
<meta property="og:url" content="http://fateud.com/acm/scl2016.html">
<meta property="og:site_name" content="Fate / Unlimited Darkness">
<meta property="og:description" content="For The 16th Zhejiang University Programming Contest.
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263## 基本### 對拍 (for linux)### 文件">
<meta property="og:updated_time" content="2016-04-09T11:05:42.518Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Standard Code Library 2016">
<meta name="twitter:description" content="For The 16th Zhejiang University Programming Contest.
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263## 基本### 對拍 (for linux)### 文件">
<link rel="publisher" href="117134980329222155883">

    
    <link rel="alternative" href="/atom.xml" title="Fate / Unlimited Darkness" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

      <body>
        <header>
          
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Fate / Unlimited Darkness" title="Fate / Unlimited Darkness"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Fate / Unlimited Darkness">Fate / Unlimited Darkness</a></h1>
				<h2 class="blog-motto">命運 / 無盡長夜</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<form class="search" action="http://search.fateud.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 10131357063837787743 ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
        </header>
        <div id="container">
          <div id="main" class="page" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/acm/scl2016.html" title="Standard Code Library 2016" itemprop="url">Standard Code Library 2016</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/117134980329222155883?rel=author" title="ChouUn" target="_blank" itemprop="author">ChouUn</a>
		
  <p class="article-time">
    <time datetime="2015-10-06T16:58:12.000Z" itemprop="datePublished"> 发表于 2015-10-07</time>
    
  </p>
</header>
	<div class="article-content">
		
		<p>For The 16th Zhejiang University Programming Contest.</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## 基本</span></span><br><span class="line"><span class="preprocessor">### 對拍 (for linux)</span></span><br><span class="line"><span class="preprocessor">### 文件頭</span></span><br><span class="line"><span class="preprocessor">#### 標準庫</span></span><br><span class="line"><span class="preprocessor">#### 數學庫</span></span><br><span class="line"><span class="preprocessor">#### 算法庫</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 數學</span></span><br><span class="line"><span class="preprocessor">### 矩陣</span></span><br><span class="line"><span class="preprocessor">#### 矩陣類</span></span><br><span class="line"><span class="preprocessor">#### 高斯消元</span></span><br><span class="line"><span class="preprocessor">### 快速傅里葉變換</span></span><br><span class="line"><span class="preprocessor">### 分數</span></span><br><span class="line"><span class="preprocessor">### 大數</span></span><br><span class="line"><span class="preprocessor">### 随机素数测试和大分解</span></span><br><span class="line"><span class="preprocessor">### 莫比烏斯反演</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 圖論</span></span><br><span class="line"><span class="preprocessor">### 網絡流</span></span><br><span class="line"><span class="preprocessor">#### 最大流</span></span><br><span class="line"><span class="preprocessor">#### 費用流</span></span><br><span class="line"><span class="preprocessor">### 旅行推銷員問題</span></span><br><span class="line"><span class="preprocessor">### LCA</span></span><br><span class="line"><span class="preprocessor">### 次小生成樹</span></span><br><span class="line"><span class="preprocessor">### 二分圖匹配</span></span><br><span class="line"><span class="preprocessor">### 一般圖匹配</span></span><br><span class="line"><span class="preprocessor">### 2-SAT</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 結構</span></span><br><span class="line"><span class="preprocessor">### 莫隊算法</span></span><br><span class="line"><span class="preprocessor">### 樹狀數組</span></span><br><span class="line"><span class="preprocessor">### 可持久化樹狀數組</span></span><br><span class="line"><span class="preprocessor">### 斜堆</span></span><br><span class="line"><span class="preprocessor">### 傻逼樹</span></span><br><span class="line"><span class="preprocessor">### 伸展樹</span></span><br><span class="line"><span class="preprocessor">### 劃分樹</span></span><br><span class="line"><span class="preprocessor">### 動態樹</span></span><br><span class="line"><span class="preprocessor">### 主席樹</span></span><br><span class="line"><span class="preprocessor">### 紅黑樹</span></span><br><span class="line"><span class="preprocessor">### 線段樹</span></span><br><span class="line"><span class="preprocessor">### 稀疏表</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 字符串</span></span><br><span class="line"><span class="preprocessor">### 字符哈希</span></span><br><span class="line"><span class="preprocessor">### 後綴數組</span></span><br><span class="line"><span class="preprocessor">### AC自動機</span></span><br><span class="line"><span class="preprocessor">### KMP算法</span></span><br><span class="line"><span class="preprocessor">### 擴展KMP算法</span></span><br><span class="line"><span class="preprocessor">### 馬拉車算法</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 計算幾何</span></span><br><span class="line"><span class="preprocessor">### 類</span></span><br><span class="line"><span class="preprocessor">### 題</span></span><br><span class="line"><span class="preprocessor">### 旋轉卡殼</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 其他</span></span><br><span class="line"><span class="preprocessor">### 離散化</span></span><br><span class="line"><span class="preprocessor">### 三分查找</span></span><br><span class="line"><span class="preprocessor">### 防爆棧</span></span><br><span class="line"><span class="preprocessor">### 輸入掛</span></span><br><span class="line"><span class="preprocessor">### 黑科技</span></span><br><span class="line"><span class="preprocessor">### 整數拆分</span></span><br><span class="line"><span class="preprocessor">### 樹鏈剖分</span></span><br></pre></td></tr></table></figure>
<h2 id="基本">基本</h2><h3 id="對拍_(for_linux)">對拍 (for linux)</h3><p>執行<code>sh ./pat.sh</code>，內容如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">g++ -g gene.cpp -o gene</span><br><span class="line">g++ -g run.cpp -o run</span><br><span class="line">g++ -g std.cpp -o std</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">  ./gene &gt; input</span><br><span class="line">  ./run &lt; input &gt; output</span><br><span class="line">  ./std &lt; input &gt; answer</span><br><span class="line">  <span class="keyword">if</span> diff output answer; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> Accepted</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> Wrong Answer</span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<h3 id="文件頭">文件頭</h3><h4 id="標準庫">標準庫</h4><figure class="highlight cpp"><figcaption><span>csl_std.h</span><a href="/code/Template/csl_std.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : ChouUn's Standard Library 纸农の标准库</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"><span class="preprocessor">#ifndef CSL_STD_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> CSL_STD_H_ 20151122L</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vi;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;vi&gt; vvi;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;pii&gt; vpii;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> rep(i,a,b) for(auto i=a,i##_n=b;i&lt;i##_n;++i)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> rrep(i,a,b) for(auto i=b,i##_n=a;i--&gt;i##_n;)</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* CSL_STD_H_ */</span></span><br></pre></td></tr></table></figure>
<h4 id="數學庫">數學庫</h4><figure class="highlight cpp"><figcaption><span>csl_math.h</span><a href="/code/Template/csl_math.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Mathematical Computation 数学计算</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef CSL_MATH_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> CSL_MATH_H_ 20160313L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;cmath&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;functional&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> !_USE_MATH_DEFINES &amp;&amp; !_POSIX_C_SOURCE</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_E        2.71828182845904523536     <span class="comment">// - e</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_LOG2E    1.44269504088896340736     <span class="comment">// - log2(e)</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_LOG10E   0.434294481903251827651    <span class="comment">// - log10(e)</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_LN2      0.693147180559945309417    <span class="comment">// - ln(2)</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_LN10     2.30258509299404568402     <span class="comment">// - ln(10)</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_PI       3.14159265358979323846     <span class="comment">// - pi</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_1_PI     0.318309886183790671538    <span class="comment">// - 1/pi</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_SQRT2    1.41421356237309504880     <span class="comment">// - sqrt(2)</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> M_SQRT1_2  0.707106781186547524401    <span class="comment">// - 1/sqrt(2)</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* !_USE_MATH_DEFINES &amp;&amp; !_POSIX_C_SOURCE */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="comment">/*</span><br><span class="line">   * greatest common divisor</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> T <span class="title">gcd</span><span class="params">(T a, T b)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span>(T c = T(); !!b;)</span><br><span class="line">      c = a % b, a = <span class="built_in">std</span>::move(b), b = <span class="built_in">std</span>::move(c);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">/*</span><br><span class="line">   * extended Euclidean algorithm</span><br><span class="line">   * solve ax + by = gcd(a,b)</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function">T <span class="title">gcd</span><span class="params">(<span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b, T&amp; x, T&amp; y)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(!b) <span class="keyword">return</span> x = <span class="number">1</span>, y = <span class="number">0</span>, a;</span><br><span class="line">    T r = gcd(b, a % b, y, x);</span><br><span class="line">    <span class="keyword">return</span> y = y - a / b * x, r;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * least common multiple</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> T <span class="title">lcm</span><span class="params">(<span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> a / gcd(a, b) * b;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * divide and conquer algorithms (with modulo operation)</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, <span class="keyword">typename</span> K, <span class="keyword">typename</span> M, <span class="keyword">typename</span> F1, <span class="keyword">typename</span> F2&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">dnc</span><span class="params">(V c, V n, K k, M m, <span class="keyword">const</span> F1&amp; op1, <span class="keyword">const</span> F2&amp; op2)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span>(n = op2(n, m); !!k; n = op2(op1(n, n), m), k &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span>(k &amp; <span class="number">1</span>) c = op2(op1(c, n), m);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * divide and conquer algorithms</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, <span class="keyword">typename</span> K, <span class="keyword">typename</span> F&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">dnc</span><span class="params">(V c, V n, K k, <span class="keyword">const</span> F&amp; op)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span>(; k; n = op(n, n), k &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span>(k &amp; <span class="number">1</span>) c = op(c, n);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return a * b (mod m)</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">mul</span><span class="params">(V a, V b, <span class="keyword">const</span> V m)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> dnc(V(), a, b, m, <span class="built_in">std</span>::plus&lt;V&gt;(), <span class="built_in">std</span>::modulus&lt;V&gt;());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return c * n ^ k</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, <span class="keyword">typename</span> K&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">pow</span><span class="params">(V c, V n, <span class="keyword">const</span> K k)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> dnc(c, n, k, <span class="built_in">std</span>::multiplies&lt;V&gt;());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return c * n ^ k (mod m)</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, <span class="keyword">typename</span> K&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">pow</span><span class="params">(V c, V n, <span class="keyword">const</span> K k, V m)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> dnc(c, n, k, m, <span class="built_in">std</span>::multiplies&lt;V&gt;(), <span class="built_in">std</span>::modulus&lt;V&gt;());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return 1 / x (mod m)</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">inv</span><span class="params">(<span class="keyword">const</span> V&amp; x, <span class="keyword">const</span> V&amp; m)</span> </span>{</span><br><span class="line">    V p, q;</span><br><span class="line">    <span class="keyword">return</span> gcd(x, m, p, q), (p % m + m) % m;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V&gt;</span><br><span class="line">  <span class="keyword">inline</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;V&gt; divide(V x) {</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;V&gt; res;</span><br><span class="line">    <span class="keyword">if</span> (x % <span class="number">2</span> == <span class="number">0</span>) { res.push_back(<span class="number">2</span>); <span class="keyword">while</span> (x % <span class="number">2</span> == <span class="number">0</span>) x &gt;&gt;= <span class="number">1</span>; }</span><br><span class="line">    <span class="keyword">for</span> (<span class="function">V <span class="title">i</span><span class="params">(3)</span></span>; i * i &lt;= x; i += <span class="number">2</span>) {</span><br><span class="line">      <span class="keyword">if</span> (x % i) <span class="keyword">continue</span>;</span><br><span class="line">      res.push_back(i); <span class="keyword">while</span> (x % i == <span class="number">0</span>) x /= i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (x != V(<span class="number">1</span>)) res.push_back(x);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return Primitive Root of x about m</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> V <span class="title">root</span><span class="params">(<span class="keyword">const</span> V&amp; P)</span> </span>{</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;V&gt; p = csl::divide(P - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (V g = <span class="number">2</span>; g &lt; P; ++g) {</span><br><span class="line">      <span class="keyword">bool</span> flag = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> i = p.begin(); i != p.end(); ++i)</span><br><span class="line">        <span class="keyword">if</span> (csl::<span class="built_in">pow</span>(V(<span class="number">1</span>), g, (P - <span class="number">1</span>) / *i, P) == <span class="number">1</span>) { flag = <span class="keyword">false</span>; <span class="keyword">break</span>; }</span><br><span class="line">      <span class="keyword">if</span> (flag) <span class="keyword">return</span> g;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* CSL_MATH_H_ */</span></span><br></pre></td></tr></table></figure>
<h4 id="算法庫">算法庫</h4><figure class="highlight cpp"><figcaption><span>csl_algo.h</span><a href="/code/Template/csl_algo.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Algorithm 算法</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"><span class="preprocessor">#ifndef CSL_ALGO_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> CSL_ALGO_H_ 20150917L</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;cmath&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">double</span> M_EPS = <span class="number">1e-8</span>;</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * the sign of x is positive or nagetive</span><br><span class="line">   * return -1 means less, 0 means equal, 1 means greater</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">fabs</span>(x) &lt; M_EPS ? <span class="number">0</span> : (x &lt; <span class="number">0</span> ? -<span class="number">1</span> : <span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * compare between double a and double b</span><br><span class="line">   * return -1 means less, 0 means equal, 1 means greater</span><br><span class="line">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">double</span> a,<span class="keyword">double</span> b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> sgn(a - b);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return the minimum between double x and y</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">  <span class="keyword">struct</span> min {</span><br><span class="line">    <span class="keyword">const</span> _Tp&amp; <span class="keyword">operator</span> ()(<span class="keyword">const</span> _Tp&amp; x,<span class="keyword">const</span> _Tp&amp; y) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> x &lt; y ? x : y;</span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * return the maximum between double x and y</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">  <span class="keyword">struct</span> max {</span><br><span class="line">    <span class="keyword">const</span> _Tp&amp; <span class="keyword">operator</span> ()(<span class="keyword">const</span> _Tp&amp; x,<span class="keyword">const</span> _Tp&amp; y) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> x &gt; y ? x : y;</span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * calc the lowest factor of number (with prime &amp; phi &amp; mu)</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">namespace</span> prime {</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; mu;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="keyword">size_t</span>&gt; phi, div, prm;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="built_in">std</span>::size_t n)</span> </span>{</span><br><span class="line">      mu.assign(n, <span class="number">0</span>), mu[<span class="number">1</span>] = <span class="number">1</span>, phi.assign(n, <span class="number">0</span>), phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">      div.assign(n, <span class="number">0</span>), prm.clear(), prm.reserve(n &gt;&gt; <span class="number">3</span>);</span><br><span class="line">      <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="keyword">size_t</span> i = <span class="number">2</span>; i &lt; n; ++i) {</span><br><span class="line">        <span class="keyword">if</span>(!div[i]) mu[i] = -<span class="number">1</span>, phi[i] = i - <span class="number">1</span>, div[i] = i, prm.push_back(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="keyword">size_t</span> j = <span class="number">0</span>, m = prm.size(), k; j &lt; m; ++j) {</span><br><span class="line">          <span class="keyword">if</span>((<span class="keyword">double</span>)i * prm[j] &gt;= n) <span class="keyword">break</span>;</span><br><span class="line">          div[k = i * prm[j]] = prm[j];</span><br><span class="line">          <span class="keyword">if</span>(i % prm[j] == <span class="number">0</span>) {</span><br><span class="line">            phi[k] = phi[i] * prm[j], mu[k] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">else</span> mu[k] = -mu[i], phi[k] = phi[i] * (prm[j] - <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  } <span class="comment">// namespace prime</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * minimum isomorphic representation of string</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp,<span class="keyword">typename</span> _Comp&gt;</span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">size_t</span> isomorph_min(_Tp data[],<span class="built_in">std</span>::<span class="keyword">size_t</span> size,_Comp comp) {</span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">size_t</span> i = <span class="number">0</span>, j = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="keyword">size_t</span> k; i &lt; size &amp;&amp; j &lt; size;) {</span><br><span class="line">      <span class="keyword">for</span>(k = <span class="number">0</span>; data[i + k] == data[j + k] &amp;&amp; k &lt; size; ++k)</span><br><span class="line">        ;</span><br><span class="line">      <span class="keyword">if</span>(k == size) <span class="keyword">return</span> i;</span><br><span class="line">      <span class="keyword">if</span>(comp(data[j + k], data[i + k])) <span class="built_in">std</span>::swap(i, j);</span><br><span class="line">      j = <span class="built_in">std</span>::max(j + k + <span class="number">1</span>, i + <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * maximum isomorphic representation of string</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp,<span class="keyword">typename</span> _Comp&gt;</span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">size_t</span> isomorph_max(_Tp data[],<span class="built_in">std</span>::<span class="keyword">size_t</span> size,_Comp comp) {</span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">size_t</span> i = <span class="number">0</span>, j = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="keyword">size_t</span> k, p = -<span class="number">1</span>; i &lt; size &amp;&amp; j &lt; size;) {</span><br><span class="line">      <span class="keyword">for</span>(k = <span class="number">0</span>; data[i + k] == data[j + k] &amp;&amp; k &lt; size; ++k)</span><br><span class="line">        ;</span><br><span class="line">      <span class="keyword">if</span>(k == size) {</span><br><span class="line">        i = <span class="built_in">std</span>::max(i, j);</span><br><span class="line">        <span class="keyword">if</span>(~p) <span class="keyword">for</span>(p = i - p; i + p &lt; size; i = i + p)</span><br><span class="line">          ;</span><br><span class="line">        j = i + <span class="number">1</span>, p = i;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">if</span>(comp(data[j + k], data[i + k])) <span class="built_in">std</span>::swap(i, j);</span><br><span class="line">        j = <span class="built_in">std</span>::max(j + k + <span class="number">1</span>, i + <span class="number">1</span>);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* CSL_ALGO_H_ */</span></span><br></pre></td></tr></table></figure>
<h2 id="數學">數學</h2><h3 id="矩陣">矩陣</h3><h4 id="矩陣類">矩陣類</h4><figure class="highlight cpp"><figcaption><span>matrix.h</span><a href="/code/Template/matrix.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Matrix 矩阵</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"><span class="preprocessor">#ifndef MATRIX_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MATRIX_H_ 20151229L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="keyword">class</span> matrix {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> T <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> T* pointer;</span><br><span class="line">    <span class="keyword">typedef</span> T&amp; reference;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> matrix&lt;T&gt; _Self;</span><br><span class="line"></span><br><span class="line">    matrix() :</span><br><span class="line">      data(), h(), w() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    matrix(<span class="keyword">size_t</span>ype h, <span class="keyword">size_t</span>ype w) :</span><br><span class="line">      data(h * w), h(h), w(w) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> _<span class="function">Self</span><br><span class="line">    <span class="title">identity</span><span class="params">(size_type n)</span> </span>{</span><br><span class="line">      _<span class="function">Self <span class="title">res</span><span class="params">(n, n)</span></span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        res[i][i] = <span class="keyword">value_t</span>ype(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">std</span>::move(res);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> size_type</span><br><span class="line">    <span class="title">height</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> h;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> size_type</span><br><span class="line">    <span class="title">width</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> w;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">value_t</span>ype*</span><br><span class="line">    <span class="keyword">operator</span> [] (<span class="keyword">size_t</span>ype x) {</span><br><span class="line">      <span class="keyword">return</span> data.data() + x * w;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">value_t</span>ype*</span><br><span class="line">    <span class="keyword">operator</span> [] (<span class="keyword">size_t</span>ype x) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> data.data() + x * w;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    _Self&amp;</span><br><span class="line">    <span class="keyword">operator</span> *= (<span class="keyword">const</span> _Self&amp; b) {</span><br><span class="line">      _<span class="function">Self <span class="title">c</span><span class="params">(h, b.w)</span></span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; h; ++i) {</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype k = <span class="number">0</span>; k &lt; w; ++k) {</span><br><span class="line">          <span class="keyword">value_t</span>ype tmp = (*<span class="keyword">this</span>)[i][k];</span><br><span class="line">          <span class="keyword">if</span>(!tmp) <span class="keyword">continue</span>;</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; b.w; ++j)</span><br><span class="line">            c[i][j] += tmp * b[k][j];</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> (*<span class="keyword">this</span>) = <span class="built_in">std</span>::move(c);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    _Self</span><br><span class="line">    <span class="keyword">operator</span> * (<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) *= b;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    _Self&amp;</span><br><span class="line">    <span class="keyword">operator</span> += (<span class="keyword">const</span> _Self&amp; b) {</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>, n = height() * width(); i &lt; n; ++i)</span><br><span class="line">        data[i] += b.data[i];</span><br><span class="line">      <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    _Self</span><br><span class="line">    <span class="keyword">operator</span> + (<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) += b;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream&amp;</span><br><span class="line">    <span class="keyword">operator</span> &lt;&lt; (<span class="built_in">std</span>::ostream &amp;os, <span class="keyword">const</span> _Self&amp; a) {</span><br><span class="line">      <span class="keyword">size_t</span>ype n = a.height();</span><br><span class="line">      <span class="keyword">size_t</span>ype m = a.width();</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; m; ++j)</span><br><span class="line">          os &lt;&lt; a[i][j] &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">        os &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> os;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">value_t</span>ype&gt; data;</span><br><span class="line">    <span class="keyword">size_t</span>ype h, w;</span><br><span class="line">  };</span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* MATRIX_H_ */</span></span><br></pre></td></tr></table></figure>
<h4 id="高斯消元">高斯消元</h4><figure class="highlight cpp"><figcaption><span>gauss.h</span><a href="/code/Template/gauss.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Gaussian Elimination 高斯消元法</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef GAUSS_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> GAUSS_H_ 20151229L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef CSL_ALGO_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> message("need : csl_algo.h")</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;csl_algo.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef MATRIX_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> message("need : matrix.h")</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;matrix.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="comment">// for matrix of normal type</span></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="keyword">class</span> gauss {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> T <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span>ype dim;</span><br><span class="line">    <span class="keyword">size_t</span>ype equ;</span><br><span class="line">    <span class="keyword">size_t</span>ype var;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; <span class="built_in">free</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">value_t</span>ype&gt; ans;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(csl::matrix&lt;value_type&gt; mat)</span> </span>{</span><br><span class="line">      equ = mat.height();</span><br><span class="line">      var = mat.width() - <span class="number">1</span>;</span><br><span class="line">      dim = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">free</span>.assign(var, <span class="keyword">true</span>);</span><br><span class="line">      ans.assign(var, <span class="keyword">value_t</span>ype());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 阶梯矩阵</span></span><br><span class="line">      <span class="keyword">size_t</span>ype r, c;</span><br><span class="line">      <span class="keyword">for</span>(r = <span class="number">0</span>, c = <span class="number">0</span>; r &lt; equ &amp;&amp; c &lt; var; ++c) {</span><br><span class="line">        <span class="comment">// 行变换</span></span><br><span class="line">        <span class="keyword">size_t</span>ype max_r = r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r + <span class="number">1</span>; i &lt; equ; ++i)</span><br><span class="line">          <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">abs</span>(mat[i][c]) &gt; <span class="built_in">std</span>::<span class="built_in">abs</span>(mat[max_r][c])) max_r = i;</span><br><span class="line">        <span class="keyword">if</span>(max_r != r) <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r; i &lt;= var; ++i)</span><br><span class="line">          <span class="built_in">std</span>::swap(mat[r][i], mat[max_r][i]);</span><br><span class="line">        <span class="keyword">if</span>(!csl::sgn(mat[r][c])) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 消元</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r + <span class="number">1</span>; i &lt; equ; ++i) {</span><br><span class="line">          <span class="keyword">if</span>(csl::sgn(mat[i][c])) {</span><br><span class="line">            <span class="keyword">value_t</span>ype tmp = mat[i][c] / mat[r][c];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = c; j &lt;= var; ++j)</span><br><span class="line">              mat[i][j] -= tmp * mat[r][j];</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        ++r;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 无解</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r; i &lt; equ; ++i)</span><br><span class="line">        <span class="keyword">if</span>(csl::sgn(mat[i][c])) {</span><br><span class="line">          dim = -<span class="number">1</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 无穷解</span></span><br><span class="line">      <span class="keyword">if</span>(r &lt; var) {</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">          <span class="comment">// 不确定变元</span></span><br><span class="line">          <span class="keyword">size_t</span>ype cnt = <span class="number">0</span>, idx;</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; var; ++j)</span><br><span class="line">            <span class="keyword">if</span>(csl::sgn(mat[i][j]) &amp;&amp; <span class="built_in">free</span>[j]) ++cnt, idx = j;</span><br><span class="line">          <span class="keyword">if</span>(cnt &gt; <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 求出变元</span></span><br><span class="line">          <span class="keyword">value_t</span>ype tmp = mat[i][var];</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; var; ++j)</span><br><span class="line">            <span class="keyword">if</span>(csl::sgn(mat[i][j]) &amp;&amp; j != idx) tmp -= mat[i][j] * ans[j];</span><br><span class="line">          ans[idx] = tmp / mat[i][idx], <span class="built_in">free</span>[idx] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        dim = var - r;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 唯一解</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = var - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">        <span class="keyword">value_t</span>ype tmp = mat[i][var];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = i + <span class="number">1</span>; j &lt; var; ++j)</span><br><span class="line">          <span class="keyword">if</span>(csl::sgn(mat[i][j])) tmp -= mat[i][j] * ans[j];</span><br><span class="line">        ans[i] = tmp / mat[i][i];</span><br><span class="line">      }</span><br><span class="line">      dim = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for matrix of boolean</span></span><br><span class="line">  <span class="keyword">template</span>&lt;&gt;</span><br><span class="line">  <span class="keyword">class</span> gauss&lt;<span class="keyword">bool</span>&gt; {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span>ype dim;</span><br><span class="line">    <span class="keyword">size_t</span>ype equ;</span><br><span class="line">    <span class="keyword">size_t</span>ype var;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; <span class="built_in">free</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">value_t</span>ype&gt; ans;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(csl::matrix&lt;value_type&gt; mat)</span> </span>{</span><br><span class="line">      equ = mat.height();</span><br><span class="line">      var = mat.width() - <span class="number">1</span>;</span><br><span class="line">      dim = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">free</span>.assign(var, <span class="keyword">true</span>);</span><br><span class="line">      ans.assign(var, <span class="keyword">value_t</span>ype());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 阶梯矩阵</span></span><br><span class="line">      <span class="keyword">size_t</span>ype r, c;</span><br><span class="line">      <span class="keyword">for</span>(r = <span class="number">0</span>, c = <span class="number">0</span>; r &lt; equ &amp;&amp; c &lt; var; ++c) {</span><br><span class="line">        <span class="comment">// 行变换</span></span><br><span class="line">        <span class="keyword">size_t</span>ype max_r = r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r + <span class="number">1</span>; i &lt; equ; ++i)</span><br><span class="line">          <span class="keyword">if</span>(mat[i][c] &gt; mat[max_r][c]) max_r = i;</span><br><span class="line">        <span class="keyword">if</span>(max_r != r) <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r; i &lt;= var; ++i)</span><br><span class="line">          <span class="built_in">std</span>::swap(mat[r][i], mat[max_r][i]);</span><br><span class="line">        <span class="keyword">if</span>(!mat[r][c]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 消元</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r + <span class="number">1</span>; i &lt; equ; ++i)</span><br><span class="line">          <span class="keyword">if</span>(mat[i][c]) <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = c; j &lt;= var; ++j)</span><br><span class="line">            mat[i][j] ^= mat[r][j];</span><br><span class="line">        ++r;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 无解</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r; i &lt; equ; ++i)</span><br><span class="line">        <span class="keyword">if</span>(mat[i][c]) {</span><br><span class="line">          dim = -<span class="number">1</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 无穷解</span></span><br><span class="line">      <span class="keyword">if</span>(r &lt; var) {</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = r - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">          <span class="comment">// 不确定变元</span></span><br><span class="line">          <span class="keyword">size_t</span>ype cnt = <span class="number">0</span>, idx;</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; var; ++j)</span><br><span class="line">            <span class="keyword">if</span>(mat[i][j] &amp;&amp; <span class="built_in">free</span>[j]) ++cnt, idx = j;</span><br><span class="line">          <span class="keyword">if</span>(cnt &gt; <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 求出变元</span></span><br><span class="line">          <span class="keyword">value_t</span>ype tmp = mat[i][var];</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; var; ++j)</span><br><span class="line">            <span class="keyword">if</span>(mat[i][j] &amp;&amp; j != idx) tmp ^= mat[i][j] * ans[j];</span><br><span class="line">          ans[idx] = tmp, <span class="built_in">free</span>[idx] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        dim = var - r;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 唯一解</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = var - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">        <span class="keyword">value_t</span>ype tmp = mat[i][var];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = i + <span class="number">1</span>; j &lt; var; ++j)</span><br><span class="line">          <span class="keyword">if</span>(mat[i][j]) tmp ^= mat[i][j] * ans[j];</span><br><span class="line">        <span class="keyword">if</span>(mat[i][i]) ans[i] = tmp;</span><br><span class="line">      }</span><br><span class="line">      dim = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* GAUSS_H_ */</span></span><br></pre></td></tr></table></figure>
<h3 id="快速傅里葉變換">快速傅里葉變換</h3><figure class="highlight cpp"><figcaption><span>ntt.h</span><a href="/code/Template/ntt.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Fast Fourier Transform 快速傅里叶变换</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef NTT_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> NTT_H_ 20151229L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"><span class="preprocessor">#ifndef CSL_MATH_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> message("need : csl_math.h");</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;csl_math.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">template</span>&lt; <span class="keyword">typename</span> T = <span class="keyword">long</span> <span class="keyword">long</span>, <span class="keyword">typename</span> _Sequence = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt; &gt;</span><br><span class="line">  <span class="keyword">struct</span> ntt {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">size_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> _Sequence container;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * g ^ (P - 1) = 1 (mod P)</span><br><span class="line">     * P            g</span><br><span class="line">     * 786433       10</span><br><span class="line">     * 880803841    26</span><br><span class="line">     * 985661441    3</span><br><span class="line">     * 998244353    3</span><br><span class="line">     * 1004535809   3</span><br><span class="line">     * 1811939329   13</span><br><span class="line">     * 2113929217   5</span><br><span class="line">     * 2130706433   3</span><br><span class="line">     */</span></span><br><span class="line">    ntt(T P, T g) : P(P), g(g ? g : csl::root(P)) {}</span><br><span class="line"></span><br><span class="line">    ntt(<span class="keyword">size_t</span>ype n) {</span><br><span class="line">      <span class="keyword">for</span> (P = (<span class="number">1</span> &lt;&lt; n) + <span class="number">1</span>; ; P += <span class="number">1</span> &lt;&lt; n) {</span><br><span class="line">        <span class="keyword">bool</span> b = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (T j = <span class="number">2</span>; j * j &lt; P; j++)</span><br><span class="line">          <span class="keyword">if</span> (P % j == <span class="number">0</span>) { b = <span class="keyword">false</span>; <span class="keyword">break</span>; }</span><br><span class="line">        <span class="keyword">if</span> (b) <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">for</span> (g = <span class="number">2</span>; ; ++g) {</span><br><span class="line">        T k = g; <span class="keyword">bool</span> b = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; k = k * k % P, ++j)</span><br><span class="line">          <span class="keyword">if</span> (k == <span class="number">1</span>) { b = <span class="keyword">false</span>; <span class="keyword">break</span>; }</span><br><span class="line">        <span class="keyword">if</span> (b &amp;&amp; k == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function">container <span class="title">operator</span> <span class="params">()</span> <span class="params">(<span class="keyword">const</span> container&amp; a, <span class="keyword">const</span> container&amp; b)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">size_t</span>ype n = StripLeadingZero(a), m = StripLeadingZero(b);</span><br><span class="line">      <span class="function">container <span class="title">u</span><span class="params">(a.data()</span>, a.<span class="title">data</span><span class="params">()</span> + n), <span class="title">v</span><span class="params">(b.data()</span>, b.<span class="title">data</span><span class="params">()</span> + m)</span>;</span><br><span class="line">      <span class="keyword">size_t</span>ype d = n + m - <span class="number">1</span>, s;</span><br><span class="line">      <span class="keyword">for</span>(s = <span class="number">1</span>; s &lt; d; s &lt;&lt;= <span class="number">1</span>);</span><br><span class="line">      u.resize(s), v.resize(s);</span><br><span class="line">      T *l = u.data(), *r = v.data();</span><br><span class="line">      trans(l, s), trans(r, s);</span><br><span class="line">      T i_s = csl::<span class="built_in">pow</span>(T(<span class="number">1</span>), T(s), P - <span class="number">2</span>, P);</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s; ++i) l[i] = l[i] * i_s % P * r[i] % P;</span><br><span class="line">      <span class="built_in">std</span>::reverse(l + <span class="number">1</span>, l + s);</span><br><span class="line">      trans(l, s), u.resize(d);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">std</span>::move(u);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span></span><br><span class="line">    <span class="title">trans</span><span class="params">(T a[], <span class="keyword">int</span> n)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, x = <span class="number">0</span>, y = <span class="number">0</span>; i &lt;= n; i++){</span><br><span class="line">        <span class="keyword">if</span> (x &gt; y) <span class="built_in">std</span>::swap(a[x], a[y]);</span><br><span class="line">        x ^= i &amp; -i, y ^= n / (i &amp; -i) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> m = <span class="number">1</span>; m &lt; n; m += m){</span><br><span class="line">        T e = csl::<span class="built_in">pow</span>(T(<span class="number">1</span>), g, ((P - <span class="number">1</span>) / m) &gt;&gt; <span class="number">1</span>, P), w = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; n; w = <span class="number">1</span>, x += m &lt;&lt; <span class="number">1</span>)</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; m; y++, w = w * e % P){</span><br><span class="line">            T t = w * a[x + y + m] % P;</span><br><span class="line">            a[x + y + m] = (a[x + y] + P - t) % P;</span><br><span class="line">            a[x + y] = (a[x + y] + t) % P;</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> size_type <span class="title">StripLeadingZero</span><span class="params">(<span class="keyword">const</span> container&amp; value)</span> </span>{</span><br><span class="line">      <span class="keyword">auto</span> l = value.data(), r = value.data() + value.size();</span><br><span class="line">      <span class="keyword">for</span> (--r; r &gt; l &amp;&amp; !*r; --r);</span><br><span class="line">      <span class="keyword">return</span> r - l + <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    T P, g;</span><br><span class="line">  };</span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* NTT_H_ */</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>fft.h</span><a href="/code/Template/fft.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Fast Fourier Transform 快速傅里叶变换</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"><span class="preprocessor">#ifndef FFT_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> FFT_H_ 20160328L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;complex&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef CSL_MATH_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> message("need : csl_math.h");</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;csl_math.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">template</span>&lt; <span class="keyword">typename</span> _Tp = <span class="built_in">std</span>::<span class="keyword">complex</span>&lt;<span class="keyword">double</span>&gt; &gt;</span><br><span class="line">  <span class="keyword">class</span> fft {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> _Tp <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="keyword">size_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">value_t</span>ype&gt; container;</span><br><span class="line"></span><br><span class="line">    <span class="function">container <span class="title">operator</span> <span class="params">()</span> <span class="params">(container u, container v)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">size_t</span>ype n = StripLeadingZero(u), m = StripLeadingZero(v);</span><br><span class="line">      <span class="keyword">size_t</span>ype d = n + m - <span class="number">1</span>, s = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (s &lt; d) s &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">      u.resize(s), <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>()(u, <span class="number">0</span>);</span><br><span class="line">      v.resize(s), <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>()(v, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; s; ++i) u[i] *= v[i];</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>()(u, <span class="number">1</span>), u.resize(d);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;ui : u) ui = <span class="built_in">std</span>::round(ui.real());</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">std</span>::move(u);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span> <span class="params">()</span> <span class="params">(container&amp; a, <span class="keyword">bool</span> inv)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">int</span> n = a.size();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j, t, k; i &lt; n; ++i) {</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>, t = i, k = n &gt;&gt; <span class="number">1</span>; k; k &gt;&gt;= <span class="number">1</span>, t &gt;&gt;= <span class="number">1</span>) j = (j &lt;&lt; <span class="number">1</span>) | (t &amp; <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) swap(a[i], a[j]) ;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">2</span>, ds = <span class="number">1</span>; s &lt;= n; ds = s, s &lt;&lt;= <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">typename</span> <span class="keyword">value_t</span>ype::<span class="keyword">value_t</span>ype wo = (inv ? -<span class="number">1</span> : <span class="number">1</span>) * <span class="number">2</span> * M_PI / s;</span><br><span class="line">        <span class="keyword">value_t</span><span class="function">ype <span class="title">wn</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">cos</span>(wo)</span>, <span class="built_in">std</span>::<span class="title">sin</span><span class="params">(wo)</span>), <span class="title">w</span><span class="params">(1, 0)</span>, t</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; ds; ++k, w = w * wn)</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt; n; i += s)</span><br><span class="line">            a[i + ds] = a[i] - (t = w * a[i + ds]), a[i] += t;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> (inv) <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;ai : a) ai /= n;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> size_type <span class="title">StripLeadingZero</span><span class="params">(container&amp; value)</span> </span>{</span><br><span class="line">      <span class="keyword">size_t</span>ype n = value.size();</span><br><span class="line">      <span class="keyword">while</span> (n &gt; <span class="number">1</span> &amp;&amp; norm(value[n - <span class="number">1</span>]) &lt; .<span class="number">5</span>) --n;</span><br><span class="line">      <span class="keyword">return</span> value.resize(n), n;</span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* FFT_H_ */</span></span><br></pre></td></tr></table></figure>
<h3 id="分數">分數</h3><figure class="highlight cpp"><figcaption><span>fraction.cpp</span><a href="/code/scl/fraction.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> fraction{</span><br><span class="line">  T n,d;</span><br><span class="line">  fraction(<span class="keyword">const</span> T &amp;_n=<span class="number">0</span>,<span class="keyword">const</span> T &amp;_d=<span class="number">1</span>):n(_n),d(_d)</span><br><span class="line">  { T t=<span class="built_in">std</span>::__gcd(n,d); n/=t,d/=t; <span class="keyword">if</span>(d&lt;<span class="number">0</span>)n=-n,d=-d; }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>-()<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> fraction(-n,d); }�� </span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>+(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> fraction(n*b.d+b.n*d,d*b.d); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>-(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> fraction(n*b.d-b.n*d,d*b.d); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>*(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> fraction(n*b.n,d*b.d); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>/(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> fraction(n*b.d,d*b.n); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>+=(<span class="keyword">const</span> fraction &amp;b)</span><br><span class="line">  { <span class="keyword">return</span> *<span class="keyword">this</span>=fraction(n*b.d+b.n*d,d*b.d); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>-=(<span class="keyword">const</span> fraction &amp;b)</span><br><span class="line">  { <span class="keyword">return</span> *<span class="keyword">this</span>=fraction(n*b.d-b.n*d,d*b.d); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>*=(<span class="keyword">const</span> fraction &amp;b)</span><br><span class="line">  { <span class="keyword">return</span> *<span class="keyword">this</span>=fraction(n*b.n,d*b.d); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">const</span> fraction <span class="keyword">operator</span>/=(<span class="keyword">const</span> fraction &amp;b)</span><br><span class="line">  { <span class="keyword">return</span> *<span class="keyword">this</span>=fraction(n*b.d,d*b.n); }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> n*b.d&lt;b.n*d; }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> n*b.d&gt;b.n*d; }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> ==(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> n*b.d==b.n*d; }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;=(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> n*b.d&lt;=b.n*d; }</span><br><span class="line">  <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;=(<span class="keyword">const</span> fraction &amp;b)<span class="keyword">const</span></span><br><span class="line">  { <span class="keyword">return</span> n*b.d&gt;=b.n*d; }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<h3 id="大數">大數</h3><figure class="highlight cpp"><figcaption><span>BigInt.h</span><a href="/code/Template/BigInt.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : BigInt.h 大整数</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef BIGINT_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BIGINT_H_ 20160312L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;climits&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> long long long</span></span><br><span class="line">  <span class="keyword">class</span> BigInt {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">uint32_t</span> uint;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">uint64_t</span> ulong;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; uint &gt; container;</span><br><span class="line">    <span class="keyword">typedef</span> BigInt _Self;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> kcbitUint = <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint kuMaskHighBit = (uint)INT_MIN;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MultiplyThreshold = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> _sign;</span><br><span class="line">    container _bits;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    BigInt() :</span><br><span class="line">        _sign(<span class="number">0</span>), _bits() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(<span class="keyword">int</span> value) {</span><br><span class="line">      <span class="keyword">if</span> (value &lt; <span class="number">0</span>)</span><br><span class="line">        _sign = -<span class="number">1</span>, _bits = container(<span class="number">1</span>, -value);</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (value &gt; <span class="number">0</span>)</span><br><span class="line">        _sign = +<span class="number">1</span>, _bits = container(<span class="number">1</span>, value);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        _sign = <span class="number">0</span>, _bits = container();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(uint value) :</span><br><span class="line">        _sign(+<span class="number">1</span>), _bits(<span class="number">1</span>, value) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(<span class="keyword">long</span> value) {</span><br><span class="line">      <span class="keyword">if</span> (INT_MIN &lt;= value &amp;&amp; value &lt;= INT_MAX)</span><br><span class="line">        *<span class="keyword">this</span> = _Self(<span class="keyword">int</span>(value));</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        ulong x = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (value &lt; <span class="number">0</span>)</span><br><span class="line">          x = (ulong)-value, _sign = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          x = (ulong)value, _sign = +<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= UINT_MAX)</span><br><span class="line">          _bits = container(<span class="number">1</span>, x);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          _bits = container(<span class="number">2</span>), _bits[<span class="number">0</span>] = x, _bits[<span class="number">1</span>] = x &gt;&gt; kcbitUint;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(ulong value) {</span><br><span class="line">      _sign = +<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (value &lt;= UINT_MAX)</span><br><span class="line">        _bits = container(<span class="number">1</span>, value);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        _bits = container(<span class="number">2</span>), _bits[<span class="number">0</span>] = value, _bits[<span class="number">1</span>] = value &gt;&gt; kcbitUint;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(<span class="keyword">int</span> n, <span class="keyword">const</span> container&amp; rgu) :</span><br><span class="line">        _sign(n), _bits(rgu) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(<span class="keyword">const</span> container&amp; value, <span class="keyword">bool</span> negative) {</span><br><span class="line">      StripLeadingZero(_bits = value);</span><br><span class="line">      _sign = !_bits.size() ? <span class="number">0</span> : negative ? -<span class="number">1</span> : +<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(container&amp;&amp; value, <span class="keyword">bool</span> negative) {</span><br><span class="line">      StripLeadingZero(_bits = <span class="built_in">std</span>::move(value));</span><br><span class="line">      _sign = !_bits.size() ? <span class="number">0</span> : negative ? -<span class="number">1</span> : +<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    BigInt(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; s) {</span><br><span class="line">      <span class="keyword">int</span> n = s.size(), cur = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (s[cur] == <span class="string">'0'</span>)</span><br><span class="line">        _sign = <span class="number">0</span>, ++cur;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (s[cur] == <span class="string">'-'</span>)</span><br><span class="line">        _sign = -<span class="number">1</span>, ++cur;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        _sign = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      container base = container(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">      _bits = container(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">while</span> (cur &lt; n) {</span><br><span class="line">        uint d = s[cur++] - <span class="string">'0'</span>;</span><br><span class="line">        container lb = container(_bits.size() + base.size());</span><br><span class="line">        <span class="built_in">std</span>::swap(lb, _bits);</span><br><span class="line">        Multiply(lb.data(), lb.size(), base.data(), base.size(), data(), size());</span><br><span class="line">        container newBits = container(<span class="number">1</span>, d);</span><br><span class="line">        <span class="keyword">if</span> (d) AddSelf(data(), size(), newBits.data(), newBits.size());</span><br><span class="line">        StripLeadingZero(_bits);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">inline</span> uint* data() {</span><br><span class="line">      <span class="keyword">return</span> _bits.data();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">const</span> uint* data() <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> _bits.data();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> uint <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> _bits.size();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">to_string</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> FormatBigInt(*<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> _<span class="function">Self <span class="title">abs</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> _Self(_sign &lt; <span class="number">0</span> ? -_sign : _sign, _bits);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="built_in">std</span>::istream&amp; <span class="keyword">operator</span> &gt;&gt;(<span class="built_in">std</span>::istream&amp; is, _Self&amp; value) {</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">string</span> s;</span><br><span class="line">      <span class="keyword">return</span> is &gt;&gt; s, value = _Self(s), is;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span> &lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, <span class="keyword">const</span> _Self&amp; value) {</span><br><span class="line">      <span class="keyword">return</span> os &lt;&lt; value.to_string();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(<span class="keyword">const</span> _Self&amp; other)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (_sign != other._sign) <span class="keyword">return</span> _sign &lt; other._sign ? -<span class="number">1</span> : +<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (!_sign) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> cmp = Compare(data(), size(), other.data(), other.size());</span><br><span class="line">      <span class="keyword">return</span> _sign &gt; <span class="number">0</span> ? cmp : -cmp;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">equals</span><span class="params">(<span class="keyword">const</span> _Self&amp; other)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (_sign != other._sign) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (_bits == other._bits) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DnM</span><span class="params">(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right, _Self&amp; q, _Self&amp; r)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (!left._sign)</span><br><span class="line">        q = r = left;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (left.size() &lt; right.size())</span><br><span class="line">        q = _Self(<span class="number">0</span>), r = left;</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        container cr = container(left._bits), cq = container(left.size() - right.size() + <span class="number">1</span>);</span><br><span class="line">        Divide(cr.data(), cr.size(), right.data(), right.size(), cq.data(), cq.size());</span><br><span class="line">        r = _Self(<span class="built_in">std</span>::move(cr), left._sign &lt; <span class="number">0</span>);</span><br><span class="line">        q = _Self(<span class="built_in">std</span>::move(cq), (left._sign &lt; <span class="number">0</span>) ^ (right._sign &lt; <span class="number">0</span>));</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> +() <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> _Self(_sign, _bits);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> -() <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> _Self(-_sign, _bits);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> !() <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> _sign == <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left.compareTo(right) &lt; <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;=(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left.compareTo(right) &lt;= <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left.compareTo(right) &gt; <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;=(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left.compareTo(right) &gt;= <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> ==(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left.equals(right);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> !=(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> !left.equals(right);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> +(_Self left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left += right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> -(_Self left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left -= right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> *(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">if</span> (!left._sign) <span class="keyword">return</span> left;</span><br><span class="line">      <span class="keyword">if</span> (!right._sign) <span class="keyword">return</span> right;</span><br><span class="line">      container bits = container(left.size() + right.size());</span><br><span class="line">      <span class="keyword">if</span> (left.size() &lt; right.size())</span><br><span class="line">        Multiply(right.data(), right.size(), left.data(), left.size(), bits.data(), bits.size());</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        Multiply(left.data(), left.size(), right.data(), right.size(), bits.data(), bits.size());</span><br><span class="line">      <span class="keyword">return</span> _Self(<span class="built_in">std</span>::move(bits), (left._sign &lt; <span class="number">0</span>) ^ (right._sign &lt; <span class="number">0</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> /(<span class="keyword">const</span> _Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">if</span> (!left._sign) <span class="keyword">return</span> left;</span><br><span class="line">      <span class="keyword">if</span> (left.size() &lt; right.size())</span><br><span class="line">        <span class="keyword">return</span> _Self(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        container local = container(left._bits), bits = container(left.size() - right.size() + <span class="number">1</span>);</span><br><span class="line">        Divide(local.data(), local.size(), right.data(), right.size(), bits.data(), bits.size());</span><br><span class="line">        <span class="keyword">return</span> _Self(<span class="built_in">std</span>::move(bits), (left._sign &lt; <span class="number">0</span>) ^ (right._sign &lt; <span class="number">0</span>));</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> %(_Self left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left %= right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self&amp; <span class="keyword">operator</span> +=(_Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">if</span> (!right._sign) <span class="keyword">return</span> left;</span><br><span class="line">      <span class="keyword">if</span> (!left._sign) <span class="keyword">return</span> left = right;</span><br><span class="line">      <span class="keyword">if</span> (left._sign != right._sign)</span><br><span class="line">        left = Subtract(left._bits, left._sign, right._bits, right._sign);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        left = Add(left._bits, left._sign, right._bits, right._sign);</span><br><span class="line">      <span class="keyword">return</span> left;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self&amp; <span class="keyword">operator</span> -=(_Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">if</span> (!right._sign) <span class="keyword">return</span> left;</span><br><span class="line">      <span class="keyword">if</span> (!left._sign) <span class="keyword">return</span> left = -right;</span><br><span class="line">      <span class="keyword">if</span> (left._sign != right._sign)</span><br><span class="line">        left = Add(left._bits, left._sign, right._bits, -right._sign);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        left = Subtract(left._bits, left._sign, right._bits, right._sign);</span><br><span class="line">      <span class="keyword">return</span> left;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self&amp; <span class="keyword">operator</span> *=(_Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left = left * right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self&amp; <span class="keyword">operator</span> /=(_Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">return</span> left = left / right;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self&amp; <span class="keyword">operator</span> %=(_Self&amp; left, <span class="keyword">const</span> _Self&amp; right) {</span><br><span class="line">      <span class="keyword">if</span> (!left._sign) <span class="keyword">return</span> left;</span><br><span class="line">      <span class="keyword">if</span> (left.size() &lt; right.size()) <span class="keyword">return</span> left;</span><br><span class="line">      Divide(left.data(), left.size(), right.data(), right.size(), container().data(), <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> left = _Self(<span class="built_in">std</span>::move(left._bits), left._sign &lt; <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> &lt;&lt;(<span class="keyword">const</span> _Self&amp; value, <span class="keyword">int</span> shift) {</span><br><span class="line">      <span class="keyword">if</span> (shift == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shift == INT_MIN)</span><br><span class="line">        <span class="keyword">return</span> (value &gt;&gt; INT_MAX) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shift &lt; <span class="number">0</span>) <span class="keyword">return</span> value &gt;&gt; -shift;</span><br><span class="line">      <span class="keyword">int</span> ds = shift / kcbitUint, ss = shift - (ds * kcbitUint);</span><br><span class="line">      container xd;</span><br><span class="line">      <span class="keyword">int</span> xl;</span><br><span class="line">      <span class="keyword">bool</span> negx = GetPartsForBitManipulation(value, xd, xl);</span><br><span class="line">      <span class="keyword">int</span> zl = xl + ds + <span class="number">1</span>;</span><br><span class="line">      container zd = container(zl);</span><br><span class="line">      <span class="keyword">if</span> (ss == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; xl; i++)</span><br><span class="line">          zd[i + ds] = xd[i];</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">int</span> carryShift = kcbitUint - ss, i;</span><br><span class="line">        uint carry = <span class="number">0</span>, rot;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; xl; i++)</span><br><span class="line">          rot = xd[i], zd[i + ds] = rot &lt;&lt; ss | carry, carry = rot &gt;&gt; carryShift;</span><br><span class="line">        zd[i + ds] = carry;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> _Self(zd, negx);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> _Self <span class="keyword">operator</span> &gt;&gt;(<span class="keyword">const</span> _Self&amp; value, <span class="keyword">int</span> shift) {</span><br><span class="line">      <span class="keyword">if</span> (shift == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shift == INT_MIN)</span><br><span class="line">        <span class="keyword">return</span> ((value &lt;&lt; INT_MAX) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shift &lt; <span class="number">0</span>) <span class="keyword">return</span> value &lt;&lt; -shift;</span><br><span class="line">      <span class="keyword">int</span> ds = shift / kcbitUint, ss = shift - (ds * kcbitUint);</span><br><span class="line">      container xd;</span><br><span class="line">      <span class="keyword">int</span> xl;</span><br><span class="line">      <span class="keyword">bool</span> negx = GetPartsForBitManipulation(value, xd, xl);</span><br><span class="line">      <span class="keyword">if</span> (negx) {</span><br><span class="line">        <span class="keyword">if</span> (shift &gt;= (kcbitUint * xl)) <span class="keyword">return</span> _Self(-<span class="number">1L</span>L);</span><br><span class="line">        xd.resize(xl), DangerousMakeTwosComplement(xd);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">int</span> zl = xl - ds;</span><br><span class="line">      <span class="keyword">if</span> (zl &lt; <span class="number">0</span>) zl = <span class="number">0</span>;</span><br><span class="line">      container zd = container(zl);</span><br><span class="line">      <span class="keyword">if</span> (ss == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = xl - <span class="number">1</span>; i &gt;= ds; i--)</span><br><span class="line">          zd[i - ds] = xd[i];</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">int</span> carryShift = kcbitUint - ss;</span><br><span class="line">        uint carry = <span class="number">0</span>, rot;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = xl - <span class="number">1</span>; i &gt;= ds; i--) {</span><br><span class="line">          rot = xd[i];</span><br><span class="line">          zd[i - ds] = (rot &gt;&gt; ss) | ((negx &amp;&amp; i == xl - <span class="number">1</span>) ? (<span class="number">0xFFFFFFFF</span> &lt;&lt; carryShift) : carry);</span><br><span class="line">          carry = (rot &lt;&lt; carryShift);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> (negx) DangerousMakeTwosComplement(zd); <span class="comment">// mutates zd</span></span><br><span class="line">      <span class="keyword">return</span> _Self(zd, negx);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Compare</span><span class="params">(<span class="keyword">const</span> uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (ll ^ rl) <span class="keyword">return</span> (ll &lt; rl) ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = ll - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="keyword">if</span> (l[i] ^ r[i]) <span class="keyword">return</span> (l[i] &lt; r[i]) ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StripLeadingZero</span><span class="params">(container&amp; bits)</span> </span>{</span><br><span class="line">      <span class="keyword">const</span> uint* data = bits.data();</span><br><span class="line">      uint len = bits.size();</span><br><span class="line">      <span class="keyword">while</span> (len &gt; <span class="number">0</span> &amp;&amp; data[len - <span class="number">1</span>] == <span class="number">0</span>)</span><br><span class="line">        --len;</span><br><span class="line">      bits.resize(len);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> _<span class="function">Self <span class="title">Add</span><span class="params">(container left, <span class="keyword">int</span> ls, container right, <span class="keyword">int</span> rs)</span> </span>{</span><br><span class="line">      container *l = &amp;left, *s = &amp;right;</span><br><span class="line">      <span class="keyword">if</span> (l-&gt;size() &lt; s-&gt;size()) <span class="built_in">std</span>::swap(l, s);</span><br><span class="line">      uint ll = l-&gt;size(), sl = s-&gt;size();</span><br><span class="line">      <span class="keyword">long</span> res = AddSelf(l-&gt;data(), ll, s-&gt;data(), sl);</span><br><span class="line">      <span class="keyword">if</span> (res) l-&gt;push_back(res);</span><br><span class="line">      <span class="keyword">return</span> _Self(<span class="built_in">std</span>::move(*l), ls &lt; <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> _<span class="function">Self <span class="title">Subtract</span><span class="params">(container left, <span class="keyword">int</span> ls, container right, <span class="keyword">int</span> rs)</span> </span>{</span><br><span class="line">      container *l = &amp;left, *s = &amp;right;</span><br><span class="line">      <span class="keyword">if</span> (Compare(l-&gt;data(), l-&gt;size(), s-&gt;data(), s-&gt;size()) &lt; <span class="number">0</span>) <span class="built_in">std</span>::swap(l, s), ls = -ls;</span><br><span class="line">      uint ll = l-&gt;size(), sl = s-&gt;size();</span><br><span class="line">      SubtractSelf(l-&gt;data(), ll, s-&gt;data(), sl);</span><br><span class="line">      StripLeadingZero(*l);</span><br><span class="line">      <span class="keyword">return</span> _Self(<span class="built_in">std</span>::move(*l), ls &lt; <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">AddSelf</span><span class="params">(uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl)</span> </span>{</span><br><span class="line">      <span class="keyword">long</span> c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rl; i++)</span><br><span class="line">        c = (l[i] + c) + r[i], l[i] = c, c &gt;&gt;= <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = rl; c != <span class="number">0</span> &amp;&amp; i &lt; ll; i++)</span><br><span class="line">        c = l[i] + c, l[i] = c, c &gt;&gt;= <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">return</span> c;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="title">SubtractSelf</span><span class="params">(uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl)</span> </span>{</span><br><span class="line">      <span class="keyword">long</span> c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rl; i++)</span><br><span class="line">        c = (l[i] + c) - r[i], l[i] = c, c &gt;&gt;= <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = rl; c != <span class="number">0</span> &amp;&amp; i &lt; ll; i++)</span><br><span class="line">        c = l[i] + c, l[i] = c, c &gt;&gt;= <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">return</span> c;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Multiply</span><span class="params">(<span class="keyword">const</span> uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl, uint* b, <span class="keyword">int</span> bl)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (rl &lt; MultiplyThreshold) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rl; i++) {</span><br><span class="line">          ulong c = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; ll; j++)</span><br><span class="line">            c = b[i + j] + c + (ulong)l[j] * r[i], b[i + j] = c, c &gt;&gt;= <span class="number">32</span>;</span><br><span class="line">          b[i + ll] = c;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">int</span> n = rl &gt;&gt; <span class="number">1</span>, n2 = n &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">const</span> uint *llo = l, *lhi = l + n, *rlo = r, *rhi = r + n;</span><br><span class="line">        <span class="keyword">int</span> llol = n, lhil = ll - n, rlol = n, rhil = rl - n;</span><br><span class="line">        uint *blo = b, *bhi = b + n2;</span><br><span class="line">        <span class="keyword">int</span> blol = n2, bhil = bl - n2;</span><br><span class="line">        Multiply(llo, llol, rlo, rlol, blo, blol);</span><br><span class="line">        Multiply(lhi, lhil, rhi, rhil, bhi, bhil);</span><br><span class="line">        <span class="keyword">int</span> lfl = lhil + <span class="number">1</span>, rfl = rhil + <span class="number">1</span>, col = lfl + rfl;</span><br><span class="line">        <span class="function">container <span class="title">lf</span><span class="params">(lhi, lhi + lhil)</span></span>;</span><br><span class="line">        lf.resize(lfl);</span><br><span class="line">        AddSelf(lf.data(), lfl, llo, llol);</span><br><span class="line">        <span class="function">container <span class="title">rf</span><span class="params">(rhi, rhi + rhil)</span></span>;</span><br><span class="line">        rf.resize(rfl);</span><br><span class="line">        AddSelf(rf.data(), rfl, rlo, rlol);</span><br><span class="line">        container co = container(col);</span><br><span class="line">        Multiply(lf.data(), lfl, rf.data(), rfl, co.data(), col);</span><br><span class="line">        SubtractSelf(co.data(), col, bhi, bhil);</span><br><span class="line">        SubtractSelf(co.data(), col, blo, blol);</span><br><span class="line">        AddSelf(b + n, bl - n, co.data(), col);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Divide</span><span class="params">(uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl, uint* b, <span class="keyword">int</span> bl)</span> </span>{</span><br><span class="line">      uint dHi = r[rl - <span class="number">1</span>], dLo = rl &gt; <span class="number">1</span> ? r[rl - <span class="number">2</span>] : <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> sh = __builtin_clz(dHi), bsh = <span class="number">32</span> - sh;</span><br><span class="line">      <span class="keyword">if</span> (sh &gt; <span class="number">0</span>) {</span><br><span class="line">        uint dNx = rl &gt; <span class="number">2</span> ? r[rl - <span class="number">3</span>] : <span class="number">0</span>;</span><br><span class="line">        dHi = (dHi &lt;&lt; sh) | (dLo &gt;&gt; bsh);</span><br><span class="line">        dLo = (dLo &lt;&lt; sh) | (dNx &gt;&gt; bsh);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = ll; i &gt;= rl; i--) {</span><br><span class="line">        <span class="keyword">int</span> n = i - rl;</span><br><span class="line">        uint t = i &lt; ll ? l[i] : <span class="number">0</span>;</span><br><span class="line">        ulong vHi = ((ulong)t &lt;&lt; <span class="number">32</span>) | l[i - <span class="number">1</span>];</span><br><span class="line">        uint vLo = i &gt; <span class="number">1</span> ? l[i - <span class="number">2</span>] : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (sh &gt; <span class="number">0</span>) {</span><br><span class="line">          uint vNx = i &gt; <span class="number">2</span> ? l[i - <span class="number">3</span>] : <span class="number">0</span>;</span><br><span class="line">          vHi = (vHi &lt;&lt; sh) | (vLo &gt;&gt; bsh);</span><br><span class="line">          vLo = (vLo &lt;&lt; sh) | (vNx &gt;&gt; bsh);</span><br><span class="line">        }</span><br><span class="line">        ulong d = <span class="built_in">std</span>::min(vHi / dHi, <span class="number">0xFFFFFFFF</span>ULL);</span><br><span class="line">        <span class="keyword">while</span> (DivideGuessTooBig(d, vHi, vLo, dHi, dLo))</span><br><span class="line">          --d;</span><br><span class="line">        <span class="keyword">if</span> (d &gt; <span class="number">0</span> &amp;&amp; SubtractDivisor(l + n, ll - n, r, rl, d) != t)</span><br><span class="line">          AddDivisor(l + n, ll - n, r, rl), --d;</span><br><span class="line">        <span class="keyword">if</span> (bl != <span class="number">0</span>) b[n] = (uint)d;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; ll) l[i] = <span class="number">0</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> uint <span class="title">AddDivisor</span><span class="params">(uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl)</span> </span>{</span><br><span class="line">      ulong c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rl; i++)</span><br><span class="line">        c = (l[i] + c) + r[i], l[i] = c, c &gt;&gt;= <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">return</span> c;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> uint <span class="title">SubtractDivisor</span><span class="params">(uint* l, <span class="keyword">int</span> ll, <span class="keyword">const</span> uint* r, <span class="keyword">int</span> rl, ulong q)</span> </span>{</span><br><span class="line">      ulong c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rl; i++) {</span><br><span class="line">        c += r[i] * q;</span><br><span class="line">        uint digit = (uint)c;</span><br><span class="line">        c = (c &gt;&gt; <span class="number">32</span>) + (l[i] &lt; digit), l[i] -= digit;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> c;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">DivideGuessTooBig</span><span class="params">(ulong q, ulong vHi, uint vLo, uint dHi, uint dLo)</span> </span>{</span><br><span class="line">      ulong cHi = dHi * q, cLo = dLo * q;</span><br><span class="line">      cHi = cHi + (cLo &gt;&gt; <span class="number">32</span>), cLo = cLo &amp; <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">      <span class="keyword">if</span> (cHi ^ vHi) <span class="keyword">return</span> cHi &gt; vHi;</span><br><span class="line">      <span class="keyword">if</span> (cLo ^ vLo) <span class="keyword">return</span> cLo &gt; vLo;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">GetPartsForBitManipulation</span><span class="params">(<span class="keyword">const</span> _Self&amp; x, container&amp; xd, <span class="keyword">int</span>&amp; xl)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (x._bits.empty())</span><br><span class="line">        xd.assign(<span class="number">1</span>, (x._sign &lt; <span class="number">0</span>) ? (uint)-x._sign : (uint)x._sign);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        xd = x._bits;</span><br><span class="line">      xl = (x._bits.empty() ? <span class="number">1</span> : x._bits.size());</span><br><span class="line">      <span class="keyword">return</span> x._sign &lt; <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DangerousMakeTwosComplement</span><span class="params">(container&amp; d)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (!d.empty() &amp;&amp; d.size() &gt; <span class="number">0</span>) {</span><br><span class="line">        d[<span class="number">0</span>] = ~d[<span class="number">0</span>] + <span class="number">1</span>;</span><br><span class="line">        uint i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; d[i - <span class="number">1</span>] == <span class="number">0</span> &amp;&amp; i &lt; d.size(); i++)</span><br><span class="line">          d[i] = ~d[i] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; d.size(); i++)</span><br><span class="line">          d[i] = ~d[i];</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">FormatBigInt</span><span class="params">(<span class="keyword">const</span> _Self&amp; value)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (value._sign == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">"0"</span>;</span><br><span class="line">      <span class="keyword">const</span> uint kuBase = <span class="number">1000000000</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> kcchBase = <span class="number">9</span>;</span><br><span class="line">      <span class="keyword">int</span> d = <span class="number">0</span>, cs = value._bits.size(), cd = <span class="number">0</span>;</span><br><span class="line">      container rd = container(cs * <span class="number">10</span> / <span class="number">9</span> + <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> is = cs; --is &gt;= <span class="number">0</span>;) {</span><br><span class="line">        uint uc = value._bits[is];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> id = <span class="number">0</span>; id &lt; cd; id++) {</span><br><span class="line">          ulong ur = ((ulong)rd[id] &lt;&lt; kcbitUint) | uc;</span><br><span class="line">          rd[id] = (uint)(ur % kuBase), uc = (uint)(ur / kuBase);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (uc != <span class="number">0</span>) {</span><br><span class="line">          rd[cd++] = uc % kuBase, uc /= kuBase;</span><br><span class="line">          <span class="keyword">if</span> (uc != <span class="number">0</span>) rd[cd++] = uc;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">int</span> cm = cd * kcchBase;</span><br><span class="line">      <span class="keyword">if</span> (d &gt; <span class="number">0</span> &amp;&amp; d &gt; cm) cm = d;</span><br><span class="line">      <span class="keyword">if</span> (value._sign &lt; <span class="number">0</span>) cm = cm + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">char</span>* s = <span class="keyword">new</span> <span class="keyword">char</span>[cm + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">int</span> id = cm;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> iuDst = <span class="number">0</span>; iuDst &lt; cd - <span class="number">1</span>; iuDst++) {</span><br><span class="line">        uint ud = rd[iuDst];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> cch = kcchBase; --cch &gt;= <span class="number">0</span>;)</span><br><span class="line">          s[--id] = (<span class="keyword">char</span>)(<span class="string">'0'</span> + ud % <span class="number">10</span>), ud /= <span class="number">10</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">for</span> (uint uDig = rd[cd - <span class="number">1</span>]; uDig != <span class="number">0</span>;)</span><br><span class="line">        s[--id] = (<span class="keyword">char</span>)(<span class="string">'0'</span> + uDig % <span class="number">10</span>), uDig /= <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> t = cm - id; d &gt; <span class="number">0</span> &amp;&amp; d &gt; t;)</span><br><span class="line">        s[--id] = <span class="string">'0'</span>, d--;</span><br><span class="line">      <span class="keyword">if</span> (value._sign &lt; <span class="number">0</span>) s[--id] = <span class="string">'-'</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">string</span>(s + id, s + cm);</span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line"><span class="comment">// class BigInt</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">undef</span> long</span></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="built_in">std</span> {</span><br><span class="line">  <span class="keyword">inline</span> csl::<span class="function">BigInt <span class="title">abs</span><span class="params">(<span class="keyword">const</span> csl::BigInt&amp; x)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> x.<span class="built_in">abs</span>();</span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="built_in">string</span> <span class="title">to_string</span><span class="params">(<span class="keyword">const</span> csl::BigInt&amp; x)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> x.to_string();</span><br><span class="line">  }</span><br><span class="line">} <span class="comment">// namespace std</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* BIGINT_H_ */</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>BigDec.h</span><a href="/code/Template/BigDec.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : BigDec 高精度自然数</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"><span class="preprocessor">#ifndef BIGDEC_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BIGDEC_H_ 20160318L</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;cstdint&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;cstring&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iomanip&gt;</span></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp, <span class="keyword">int</span> _Sz&gt;</span><br><span class="line">  <span class="keyword">class</span> <span class="built_in">array</span> {</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    _Tp _data[_Sz];</span><br><span class="line">    <span class="keyword">int</span> _size;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">array</span>() : _size() {}</span><br><span class="line">    <span class="built_in">array</span>(<span class="keyword">int</span> n, _Tp x = _Tp()) : _size(n) { <span class="keyword">while</span> (n &gt; <span class="number">0</span>) _data[--n] = x; }</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">inline</span> _Tp* data() { <span class="keyword">return</span> _data; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">const</span> _Tp* data() <span class="keyword">const</span> { <span class="keyword">return</span> _data; }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>{ <span class="keyword">return</span> _size; }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>{ _size = <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> _Tp&amp; <span class="keyword">operator</span> [](<span class="keyword">int</span> x) { <span class="keyword">return</span> _data[x]; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">const</span> _Tp&amp; <span class="keyword">operator</span> [](<span class="keyword">int</span> x) <span class="keyword">const</span> { <span class="keyword">return</span> _data[x]; }</span><br><span class="line">    <span class="keyword">inline</span> _Tp&amp; at(<span class="keyword">int</span> x) { <span class="keyword">return</span> _data[x]; }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line">    </span>{ <span class="keyword">if</span> (x &lt;= _size) _size = x; <span class="keyword">else</span> <span class="keyword">while</span> (_size &lt; x) _data[_size++] = _Tp(); }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_back</span><span class="params">(_Tp x)</span> </span>{ _data[_size++] = x; }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pop_back</span><span class="params">()</span> </span>{ --_size; }</span><br><span class="line">  }; <span class="comment">// class array</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Sequence = csl::<span class="built_in">array</span>&lt;<span class="built_in">std</span>::<span class="keyword">uint32_t</span>, 50&gt; &gt;</span><br><span class="line">  <span class="keyword">class</span> BigDec {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">int32_t</span> int32;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">uint32_t</span> uint32;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">int64_t</span> int64;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">uint64_t</span> uint64;</span><br><span class="line">    <span class="keyword">typedef</span> _Sequence container;</span><br><span class="line">    <span class="keyword">typedef</span> BigDec&lt;_Sequence&gt; _Self;</span><br><span class="line">    <span class="keyword">static</span> int32 Bit, Base;</span><br><span class="line">    BigDec() : _bits(<span class="number">1</span>, <span class="number">0</span>) {}</span><br><span class="line">    BigDec(int32 value) { split(_bits, value); }</span><br><span class="line">    BigDec(uint32 value) { split(_bits, value); }</span><br><span class="line">    BigDec(int64 value) { split(_bits, value); }</span><br><span class="line">    BigDec(uint64 value) { split(_bits, value); }</span><br><span class="line">    BigDec(<span class="keyword">const</span> container&amp; value) : _bits(value) {}</span><br><span class="line">    BigDec(container&amp;&amp; value) : _bits(<span class="built_in">std</span>::move(value)) {}</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BigDec</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *p)</span> </span>{</span><br><span class="line">      <span class="keyword">int</span> n = <span class="built_in">strlen</span>(p); _bits.resize((n - <span class="number">1</span>) / Bit + <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = n, j = <span class="number">0</span>, k = <span class="number">1</span>; i &gt; <span class="number">0</span>; --i)</span><br><span class="line">      { _bits[j] += (p[i - <span class="number">1</span>] - <span class="string">'0'</span>) * k; <span class="keyword">if</span> ((k *= <span class="number">10</span>) == Base) k = <span class="number">1</span>, ++j; }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">inline</span> uint32* data()</span><br><span class="line">    { <span class="keyword">return</span> _bits.data(); }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">const</span> uint32* data() <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _bits.data(); }</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> int32 <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span></span><br><span class="line">    </span>{ <span class="keyword">return</span> _bits.size(); }</span><br><span class="line">    <span class="keyword">inline</span> _Self&amp; <span class="keyword">operator</span> += (<span class="keyword">const</span> _Self&amp; value)</span><br><span class="line">    { AddSelf(_bits, value._bits); <span class="keyword">return</span> *<span class="keyword">this</span>; }</span><br><span class="line">    <span class="keyword">inline</span> _Self&amp; <span class="keyword">operator</span> -= (<span class="keyword">const</span> _Self&amp; value)</span><br><span class="line">    { SubSelf(_bits, value._bits); <span class="keyword">return</span> *<span class="keyword">this</span>; }</span><br><span class="line">    <span class="keyword">inline</span> _Self&amp; <span class="keyword">operator</span> *= (<span class="keyword">const</span> _Self&amp; value)</span><br><span class="line">    { _bits = Multi(_bits, value._bits); <span class="keyword">return</span> *<span class="keyword">this</span>; }</span><br><span class="line">    <span class="keyword">inline</span> _Self&amp; <span class="keyword">operator</span> /= (<span class="keyword">const</span> _Self&amp; value)</span><br><span class="line">    { container r; Divide(_bits, value._bits, r); <span class="keyword">return</span> _bits = <span class="built_in">std</span>::move(r), *<span class="keyword">this</span>; }</span><br><span class="line">    <span class="keyword">inline</span> _Self&amp; <span class="keyword">operator</span> %= (<span class="keyword">const</span> _Self&amp; value)</span><br><span class="line">    { container r; Divide(_bits, value._bits, r); <span class="keyword">return</span> *<span class="keyword">this</span>; }</span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> +(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) += b; }</span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> -(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) -= b; }</span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> *(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) *= b; }</span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> /(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) /= b; }</span><br><span class="line">    <span class="keyword">inline</span> _Self <span class="keyword">operator</span> %(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _Self(*<span class="keyword">this</span>) %= b; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> ==(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> Compare(_bits, b._bits) == <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> !=(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> Compare(_bits, b._bits) != <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;=(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> Compare(_bits, b._bits) &lt;= <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;=(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> Compare(_bits, b._bits) &gt;= <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> Compare(_bits, b._bits) &lt; <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;(<span class="keyword">const</span> _Self&amp; b) <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> Compare(_bits, b._bits) &gt; <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> !() <span class="keyword">const</span></span><br><span class="line">    { <span class="keyword">return</span> _bits.size() == <span class="number">1</span> &amp;&amp; _bits[<span class="number">0</span>] == <span class="number">0</span>; }</span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::istream&amp; <span class="keyword">operator</span> &gt;&gt;(<span class="built_in">std</span>::istream &amp;i, _Self&amp; n)</span><br><span class="line">    { <span class="built_in">std</span>::<span class="built_in">string</span> s; <span class="keyword">return</span> i &gt;&gt; s, n = _Self(s.data()), i; }</span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span> &lt;&lt;(<span class="built_in">std</span>::ostream &amp;o, <span class="keyword">const</span> _Self&amp; n) {</span><br><span class="line">      <span class="keyword">const</span> container&amp; b = n._bits;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = b.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        o &lt;&lt; b[i] &lt;&lt; <span class="built_in">std</span>::setfill(<span class="string">'0'</span>) &lt;&lt; <span class="built_in">std</span>::setw(Bit);</span><br><span class="line">      <span class="keyword">return</span> o &lt;&lt; <span class="built_in">std</span>::setfill(<span class="string">' '</span>) &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(container&amp; bits, uint64 value)</span></span><br><span class="line">    </span>{ bits.clear(); <span class="keyword">do</span> { bits.push_back(value % Base), value /= Base; } <span class="keyword">while</span> (value); }</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StripLeadingZero</span><span class="params">(container&amp; bits)</span></span><br><span class="line">    </span>{ int32 l = bits.size(); <span class="keyword">while</span> (l &gt; <span class="number">1</span> &amp;&amp; bits[l - <span class="number">1</span>] == <span class="number">0</span>) --l; bits.resize(l); }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Compare</span><span class="params">(<span class="keyword">const</span> container&amp; l, <span class="keyword">const</span> container&amp; r)</span> </span>{</span><br><span class="line">      int32 ll = l.size(), rl = r.size();</span><br><span class="line">      <span class="keyword">if</span> (ll ^ rl) <span class="keyword">return</span> (ll &lt; rl) ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = ll - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="keyword">if</span> (l[i] ^ r[i]) <span class="keyword">return</span> (l[i] &lt; r[i]) ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddSelf</span><span class="params">(container&amp; l, <span class="keyword">const</span> container&amp; r)</span> </span>{</span><br><span class="line">      int32 ll = l.size(), rl = r.size(), c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (ll &lt; rl) l.resize(ll = rl);</span><br><span class="line">      <span class="keyword">for</span> (int32 i = <span class="number">0</span>; i &lt; ll; ++i) {</span><br><span class="line">        c = c + l[i]; <span class="keyword">if</span> (i &lt; rl) c = c + r[i];</span><br><span class="line">        <span class="keyword">if</span> (c &lt; Base) l[i] = c, c = <span class="number">0</span>; <span class="keyword">else</span> l[i] = c - Base, c = <span class="number">1</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> (c) l.push_back(c);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SubSelf</span><span class="params">(container&amp; l, <span class="keyword">const</span> container&amp; r)</span> </span>{</span><br><span class="line">      int32 ll = l.size(), rl = r.size(), c = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (int32 i = <span class="number">0</span>; i &lt; ll; ++i) {</span><br><span class="line">        c = c + l[i]; <span class="keyword">if</span> (i &lt; rl) c = c - r[i];</span><br><span class="line">        <span class="keyword">if</span> (c &lt; <span class="number">0</span>) l[i] = c + Base, c = -<span class="number">1</span>; <span class="keyword">else</span> l[i] = c, c = <span class="number">0</span>;</span><br><span class="line">      }</span><br><span class="line">      StripLeadingZero(l);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> container <span class="title">Multi</span><span class="params">(<span class="keyword">const</span> container&amp; l, <span class="keyword">const</span> container&amp; r)</span> </span>{</span><br><span class="line">      int32 ll = l.size(), rl = r.size(), bl = ll + rl;</span><br><span class="line">      <span class="function">container <span class="title">b</span><span class="params">(bl)</span></span>;</span><br><span class="line">      <span class="keyword">for</span> (int32 i = <span class="number">0</span>; i &lt; ll; i++) {</span><br><span class="line">        int64 c = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (int32 j = <span class="number">0</span>; j &lt; rl || c &gt; <span class="number">0</span>; j++) {</span><br><span class="line">          <span class="keyword">if</span> (j &lt; rl) c += (int64)l[i] * r[j];</span><br><span class="line">          int32 k = i + j;</span><br><span class="line">          <span class="keyword">if</span> (k &lt; bl) c += b[k]; <span class="keyword">else</span> b.resize(bl = k + <span class="number">1</span>);</span><br><span class="line">          b[k] = c % Base, c /= Base;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> StripLeadingZero(b), <span class="built_in">std</span>::move(b);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Divide</span><span class="params">(container&amp; l, <span class="keyword">const</span> container&amp; r, container&amp; q)</span> </span>{</span><br><span class="line">      <span class="keyword">if</span> (Compare(l, r) == -<span class="number">1</span> &amp;&amp; (q = container(<span class="number">1</span>, <span class="number">0</span>), <span class="keyword">true</span>)) <span class="keyword">return</span>;</span><br><span class="line">      int32 ll = l.size(); q.resize(ll);</span><br><span class="line">      <span class="function">container <span class="title">c</span><span class="params">(1, 0)</span></span>;</span><br><span class="line">      <span class="keyword">for</span> (int32 i = ll - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) {</span><br><span class="line">        <span class="keyword">if</span> (c.size() != <span class="number">1</span> || c[<span class="number">0</span>] != <span class="number">0</span>) {</span><br><span class="line">          c.resize(c.size() + <span class="number">1</span>);</span><br><span class="line">          <span class="keyword">for</span> (int32 j = c.size() - <span class="number">1</span>; j &gt; <span class="number">0</span>; --j)</span><br><span class="line">            c[j] = c[j - <span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">        c[<span class="number">0</span>] = l[i];</span><br><span class="line">        int32 left = <span class="number">0</span>, right = Base - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) {</span><br><span class="line">          int32 mid = (left + right + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">if</span> (Compare(Multi(r, container(<span class="number">1</span>, mid)), c) &lt;= <span class="number">0</span>) left = mid; <span class="keyword">else</span> right = mid - <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        q[i] = left, SubSelf(c, Multi(r, container(<span class="number">1</span>, left)));</span><br><span class="line">      }</span><br><span class="line">      l = <span class="built_in">std</span>::move(c), StripLeadingZero(q);</span><br><span class="line">    }</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    container _bits;</span><br><span class="line">  }; <span class="comment">// class BigDec</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Sequence&gt; <span class="keyword">int</span> BigDec&lt;_Sequence&gt;::Bit = <span class="number">9</span>;</span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Sequence&gt; <span class="keyword">int</span> BigDec&lt;_Sequence&gt;::Base = <span class="number">1000000000</span>;</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* BIGDEC_H_ */</span></span><br></pre></td></tr></table></figure>
<h3 id="随机素数测试和大分解">随机素数测试和大分解</h3><figure class="highlight cpp"><figcaption><span>prime.cpp</span><a href="/code/scl/prime.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* *************************************************</span><br><span class="line"> * Miller_Rabin 算法进行素数测试</span><br><span class="line"> * 速度快，可以判断一个 &lt; 2^63 的数是不是素数</span><br><span class="line"> *</span><br><span class="line"> **************************************************/</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> S = <span class="number">8</span>; <span class="comment">//随机算法判定次数，一般8~10就够了</span></span><br><span class="line"><span class="comment">// 计算ret = (a*b)%c a,b,c &lt; 2^63</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">mult_mod</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">long</span> <span class="keyword">long</span> b,<span class="keyword">long</span> <span class="keyword">long</span> c)</span></span><br><span class="line"></span>{</span><br><span class="line">  a %= c;</span><br><span class="line">  b %= c;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> tmp = a;</span><br><span class="line">  <span class="keyword">while</span>(b)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(b &amp; <span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      ret += tmp;</span><br><span class="line">      <span class="keyword">if</span>(ret &gt; c)ret -= c;<span class="comment">//直接取模慢很多</span></span><br><span class="line">    }</span><br><span class="line">    tmp &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(tmp &gt; c)tmp -= c;</span><br><span class="line">    b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 计算 ret = (a^n)%mod</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">pow_mod</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">long</span> <span class="keyword">long</span> n,<span class="keyword">long</span> <span class="keyword">long</span> mod)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> temp = a%mod;</span><br><span class="line">  <span class="keyword">while</span>(n)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(n &amp; <span class="number">1</span>)ret = mult_mod(ret,temp,mod);</span><br><span class="line">    temp = mult_mod(temp,temp,mod);</span><br><span class="line">    n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 通过 a^(n-1)=1(mod n)来判断n是不是素数</span></span><br><span class="line"><span class="comment">// n-1 = x*2^t 中间使用二次判断</span></span><br><span class="line"><span class="comment">// 是合数返回true, 不一定是合数返回false</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">long</span> <span class="keyword">long</span> n,<span class="keyword">long</span> <span class="keyword">long</span> x,<span class="keyword">long</span> <span class="keyword">long</span> t)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> ret = pow_mod(a,x,n);</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> last = ret;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= t;i++)</span><br><span class="line">  {</span><br><span class="line">    ret = mult_mod(ret,ret,n);</span><br><span class="line">    <span class="keyword">if</span>(ret == <span class="number">1</span> &amp;&amp; last != <span class="number">1</span> &amp;&amp; last != n-<span class="number">1</span>)<span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//合数</span></span><br><span class="line">    last = ret;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(ret != <span class="number">1</span>)<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//**************************************************</span></span><br><span class="line"><span class="comment">// Miller_Rabin算法</span></span><br><span class="line"><span class="comment">// 是素数返回true,(可能是伪素数)</span></span><br><span class="line"><span class="comment">// 不是素数返回false</span></span><br><span class="line"><span class="comment">//**************************************************</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Miller_Rabin</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>( n &lt; <span class="number">2</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">if</span>( n == <span class="number">2</span>)<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">if</span>( (n&amp;<span class="number">1</span>) == <span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">false</span>;<span class="comment">//偶数</span></span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> x = n - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> t = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>( (x&amp;<span class="number">1</span>)==<span class="number">0</span> ){x &gt;&gt;= <span class="number">1</span>; t++;}</span><br><span class="line">  srand(time(NULL));<span class="comment">/* *************** */</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; S;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> a = rand()%(n-<span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( check(a,n,x,t) )</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//**********************************************</span></span><br><span class="line"><span class="comment">// pollard_rho 算法进行质因素分解</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//*********************************************</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> factor[<span class="number">100</span>];<span class="comment">//质因素分解结果（刚返回时时无序的）</span></span><br><span class="line"><span class="keyword">int</span> tol;<span class="comment">//质因素的个数，编号0~tol-1</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">gcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">long</span> <span class="keyword">long</span> b)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> t;</span><br><span class="line">  <span class="keyword">while</span>(b)</span><br><span class="line">  {</span><br><span class="line">    t = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = t%b;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(a &gt;= <span class="number">0</span>)<span class="keyword">return</span> a;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> -a;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//找出一个因子</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">pollard_rho</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x,<span class="keyword">long</span> <span class="keyword">long</span> c)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> i = <span class="number">1</span>, k = <span class="number">2</span>;</span><br><span class="line">  srand(time(NULL));</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> x0 = rand()%(x-<span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> y = x0;</span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    i ++;</span><br><span class="line">    x0 = (mult_mod(x0,x0,x) + c)%x;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> d = gcd(y - x0,x);</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">1</span> &amp;&amp; d != x)<span class="keyword">return</span> d;</span><br><span class="line">    <span class="keyword">if</span>(y == x0)<span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">if</span>(i == k){y = x0; k += k;}</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//对 n进行素因子分解，存入factor. k设置为107左右即可</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">findfac</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> n,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(n == <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span>(Miller_Rabin(n))</span><br><span class="line">  {</span><br><span class="line">    factor[tol++] = n;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> p = n;</span><br><span class="line">  <span class="keyword">int</span> c = k;</span><br><span class="line">  <span class="keyword">while</span>( p &gt;= n)</span><br><span class="line">    p = pollard_rho(p,c--);<span class="comment">//值变化，防止死循环k</span></span><br><span class="line">  findfac(p,k);</span><br><span class="line">  findfac(n/p,k);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//POJ 1811</span></span><br><span class="line"><span class="comment">//给出一个N(2 &lt;= N &lt; 2^54),如果是素数，输出"Prime",否则输出最小的素因子</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> n;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>(T--)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%I64d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">if</span>(Miller_Rabin(n))<span class="built_in">printf</span>(<span class="string">"Prime\n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      tol = <span class="number">0</span>;</span><br><span class="line">      findfac(n,<span class="number">107</span>);</span><br><span class="line">      <span class="keyword">long</span> <span class="keyword">long</span> ans = factor[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; tol;i++)</span><br><span class="line">        ans = min(ans,factor[i]);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="莫比烏斯反演">莫比烏斯反演</h3><figure class="highlight cpp"><figcaption><span>mobius.cpp</span><a href="/code/scl/mobius.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BZOJ 2301 对于给出的 n个询问</span></span><br><span class="line"><span class="comment">// 每次求有多少数对(x,y)满足 a≤x≤b，c≤y≤d，且 gcd(x,y) = k</span></span><br><span class="line"><span class="comment">// gcd(x,y)函数为 x和 y的最大公约数</span></span><br><span class="line"><span class="comment">// 1≤n≤50000 1≤a≤b≤50000 1≤c≤d≤50000 1≤k≤50000</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">bool</span> check[MAXN+<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span> prime[MAXN+<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span> mu[MAXN+<span class="number">10</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Moblus</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(check,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(check));</span><br><span class="line">  mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= MAXN; i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>( !check[i] )</span><br><span class="line">    {</span><br><span class="line">      prime[tot++] = i;</span><br><span class="line">      mu[i] = -<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; tot; j ++)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>( i * prime[j] &gt; MAXN) <span class="keyword">break</span>;</span><br><span class="line">      check[i * prime[j]] = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">if</span>( i % prime[j] == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        mu[i * prime[j]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        mu[i * prime[j]] = -mu[i];</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> sum[MAXN+<span class="number">10</span>];</span><br><span class="line"><span class="comment">//找[1,n],[1,m]内互质的数的对数</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(n &gt; m)swap(n,m);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, la = <span class="number">0</span>; i &lt;= n; i = la+<span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    la = min(n/(n/i),m/(m/i));</span><br><span class="line">    ans += (<span class="keyword">long</span> <span class="keyword">long</span>)(sum[la] - sum[i-<span class="number">1</span>])*(n/i)*(m/i);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  Moblus();</span><br><span class="line">  sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= MAXN;i++)</span><br><span class="line">    sum[i] = sum[i-<span class="number">1</span>] + mu[i];</span><br><span class="line">  <span class="keyword">int</span> a,b,c,d,k;</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>(T--)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d%d"</span>,&amp;a,&amp;b,&amp;c,&amp;d,&amp;k);</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans = solve(b/k,d/k) - solve((a-<span class="number">1</span>)/k,d/k) - solve(b/k,(c-<span class="number">1</span>)/k) + solve((a-<span class="number">1</span>)/k,(c-<span class="number">1</span>)/k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="圖論">圖論</h2><figure class="highlight cpp"><figcaption><span>graph.h</span><a href="/code/Template/graph.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Graph 图论</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef GRAPH_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> GRAPH_H_ 20150911L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">  <span class="keyword">struct</span> _graph_node {</span><br><span class="line">    <span class="keyword">typedef</span> _Tp <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> _graph_node&lt;_Tp&gt;* _Link;</span><br><span class="line">    <span class="keyword">typedef</span> _graph_node&lt;_Tp&gt; _Self;</span><br><span class="line"></span><br><span class="line">    _graph_node() :</span><br><span class="line">        prev(), next(), from(), to(), data() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    _graph_node(_Link a,_Link b,<span class="keyword">size_t</span>ype c,<span class="keyword">size_t</span>ype d,<span class="keyword">value_t</span>ype e) :</span><br><span class="line">        prev(a), next(b), from(c), to(d), data(e) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    _Link prev;</span><br><span class="line">    _Link next;</span><br><span class="line">    <span class="keyword">size_t</span>ype from;</span><br><span class="line">    <span class="keyword">size_t</span>ype to;</span><br><span class="line">    <span class="keyword">value_t</span>ype data;</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">  <span class="keyword">struct</span> graph {</span><br><span class="line">    <span class="comment">// template parameter.</span></span><br><span class="line">    <span class="keyword">typedef</span> _Tp <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> _Tp* pointer;</span><br><span class="line">    <span class="keyword">typedef</span> _Tp&amp; reference;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> _graph_node&lt;_Tp&gt;* iterator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> _graph_node&lt;_Tp&gt; _Node;</span><br><span class="line">    <span class="keyword">typedef</span> _graph_node&lt;_Tp&gt;* _Link;</span><br><span class="line">    <span class="keyword">typedef</span> graph&lt;_Tp&gt; _Self;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// member function.</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">m_add_edge</span><span class="params">(size_type from,size_type to,<span class="keyword">const</span> value_type&amp; data)</span> </span>{</span><br><span class="line">      _Link node = m_data.data() + m_size++;</span><br><span class="line">      *node = _Node(<span class="number">0</span>, m_impl[from], from, to, data);</span><br><span class="line">      <span class="keyword">if</span>(m_impl[from]) m_impl[from]-&gt;prev = node;</span><br><span class="line">      m_impl[from] = node;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constructor &amp; destructor.</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">graph</span><span class="params">(size_type __v = 0,size_type __e = 0)</span> :</span><br><span class="line">        <span class="title">m_size</span><span class="params">()</span> </span>{</span><br><span class="line">      m_impl.reserve(__v);</span><br><span class="line">      m_data.reserve(__e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// iterators.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// capacity.</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(size_type __v,size_type __e)</span> </span>{</span><br><span class="line">      m_impl.assign(__v, _Link());</span><br><span class="line">      m_data.resize(__e);</span><br><span class="line">      m_size = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> m_size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// element access.</span></span><br><span class="line">    <span class="keyword">inline</span> _<span class="function">Link <span class="title">getHead</span><span class="params">(size_type __x)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> m_impl[__x];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> _<span class="function">Link <span class="title">getEdge</span><span class="params">(size_type __x)</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> m_data.data() + __x;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> size_type <span class="title">getEdgeIndex</span><span class="params">(_Link __x)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> __x - m_data.data();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// modifiers.</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(size_type from,size_type to,<span class="keyword">const</span> value_type&amp; data)</span> </span>{</span><br><span class="line">      m_add_edge(from, to, data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_double_edge</span><span class="params">(size_type from,size_type to,</span><br><span class="line">        <span class="keyword">const</span> value_type&amp; data)</span> </span>{</span><br><span class="line">      m_add_edge(from, to, data);</span><br><span class="line">      m_add_edge(to, from, data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_couple_edge</span><span class="params">(size_type from,size_type to,</span><br><span class="line">        <span class="keyword">const</span> value_type&amp; data1,<span class="keyword">const</span> value_type&amp; data2 = value_type()</span>) </span>{</span><br><span class="line">      m_add_edge(from, to, data1);</span><br><span class="line">      m_add_edge(to, from, data2);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// operator overloading.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// specialized algorithms.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// member variable.</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;_Link&gt; m_impl;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;_Node&gt; m_data;</span><br><span class="line">    <span class="keyword">size_t</span>ype m_size;</span><br><span class="line"></span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">  <span class="keyword">struct</span> tarjan {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> graph&lt;_Tp&gt;::_Link _Link;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">void</span> __scc(<span class="keyword">size_t</span>ype u) {</span><br><span class="line">      dfn[u] = low[u] = ++idx;</span><br><span class="line">      vis[u] = <span class="keyword">true</span>;</span><br><span class="line">      sta.push_back(u);</span><br><span class="line">      <span class="keyword">for</span>(_Link i = <span class="built_in">map</span>-&gt;getHead(u); i; i = i-&gt;next) {</span><br><span class="line">        <span class="keyword">size_t</span>ype v = i-&gt;to;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v]) {</span><br><span class="line">          __scc(v);</span><br><span class="line">          <span class="keyword">if</span>(low[u] &gt; low[v]) low[u] = low[v];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">          <span class="keyword">if</span>(vis[v] &amp;&amp; low[u] &gt; dfn[v]) low[u] = dfn[v];</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span>(dfn[u] == low[u]) {</span><br><span class="line">        <span class="keyword">size_t</span>ype w;</span><br><span class="line">        <span class="keyword">do</span> {</span><br><span class="line">          w = sta.back();</span><br><span class="line">          sta.pop_back();</span><br><span class="line">          vis[w] = <span class="keyword">false</span>;</span><br><span class="line">          key[w] = cnt;</span><br><span class="line">        }<span class="keyword">while</span>(w != u);</span><br><span class="line">        ++cnt;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> __dcc(<span class="keyword">size_t</span>ype u,<span class="keyword">size_t</span>ype p) {</span><br><span class="line">      dfn[u] = low[u] = ++idx;</span><br><span class="line">      sta.push_back(u);</span><br><span class="line">      <span class="keyword">for</span>(_Link i = <span class="built_in">map</span>-&gt;getHead(u); i; i = i-&gt;next) {</span><br><span class="line">        <span class="keyword">size_t</span>ype v = i-&gt;to;</span><br><span class="line">        <span class="keyword">if</span>(v == p) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v]) {</span><br><span class="line">          __dcc(v, u);</span><br><span class="line">          <span class="keyword">if</span>(low[u] &gt; low[v]) low[u] = low[v];</span><br><span class="line">          <span class="keyword">if</span>(dfn[u] &lt; low[v]) {</span><br><span class="line">            <span class="keyword">size_t</span>ype w;</span><br><span class="line">            <span class="keyword">do</span> {</span><br><span class="line">              w = sta.back();</span><br><span class="line">              sta.pop_back();</span><br><span class="line">              key[w] = cnt;</span><br><span class="line">            }<span class="keyword">while</span>(w != v);</span><br><span class="line">            cnt++;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">          <span class="keyword">if</span>(low[u] &gt; dfn[v]) low[u] = dfn[v];</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scc</span><span class="params">(graph&lt;_Tp&gt;&amp; __map)</span> </span>{</span><br><span class="line">      <span class="built_in">map</span> = &amp;__map;</span><br><span class="line">      <span class="keyword">size_t</span>ype __n = <span class="built_in">map</span>-&gt;m_impl.size();</span><br><span class="line">      idx = <span class="number">0</span>;</span><br><span class="line">      cnt = <span class="number">0</span>;</span><br><span class="line">      sta.reserve(__n);</span><br><span class="line">      dfn.assign(__n, <span class="number">0</span>);</span><br><span class="line">      low.resize(__n);</span><br><span class="line">      key.resize(__n);</span><br><span class="line">      vis.assign(__n, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; __n; ++i)</span><br><span class="line">        <span class="keyword">if</span>(!dfn[i]) __scc(i);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dcc</span><span class="params">(graph&lt;_Tp&gt;&amp; __map)</span> </span>{</span><br><span class="line">      <span class="built_in">map</span> = &amp;__map;</span><br><span class="line">      <span class="keyword">size_t</span>ype __n = <span class="built_in">map</span>-&gt;m_impl.size();</span><br><span class="line">      idx = <span class="number">0</span>;</span><br><span class="line">      cnt = <span class="number">0</span>;</span><br><span class="line">      sta.reserve(__n);</span><br><span class="line">      dfn.assign(__n, <span class="number">0</span>);</span><br><span class="line">      low.resize(__n);</span><br><span class="line">      key.resize(__n);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; __n; ++i) {</span><br><span class="line">        <span class="keyword">if</span>(dfn[i]) <span class="keyword">continue</span>;</span><br><span class="line">        sta.clear();</span><br><span class="line">        __dcc(i, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span>ype j = <span class="number">0</span>; j &lt; sta.size(); ++j)</span><br><span class="line">          key[sta[j]] = cnt;</span><br><span class="line">        cnt++;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">size_t</span>ype <span class="keyword">operator</span>[](<span class="keyword">const</span> <span class="keyword">size_t</span>ype __x) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> key[__x];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> size_type <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> cnt;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    graph&lt;_Tp&gt;* <span class="built_in">map</span>;</span><br><span class="line">    <span class="keyword">size_t</span>ype idx;</span><br><span class="line">    <span class="keyword">size_t</span>ype cnt;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">size_t</span>ype&gt; sta;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">size_t</span>ype&gt; dfn;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">size_t</span>ype&gt; low;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">size_t</span>ype&gt; key;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; vis;</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* GRAPH_H_ */</span></span><br></pre></td></tr></table></figure>
<h3 id="網絡流">網絡流</h3><h4 id="最大流">最大流</h4><figure class="highlight cpp"><figcaption><span>sap.cpp</span><a href="/code/scl/sap.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 100</span></span><br><span class="line"><span class="keyword">int</span> n,m;<span class="comment">/*點數、邊數*/</span></span><br><span class="line"><span class="keyword">int</span> g[MAXN+<span class="number">5</span>][MAXN+<span class="number">5</span>],f[MAXN+<span class="number">5</span>][MAXN+<span class="number">5</span>],r[MAXN+<span class="number">5</span>][MAXN+<span class="number">5</span>];</span><br><span class="line"><span class="comment">/*容量上限、流量、剩餘容量*/</span></span><br><span class="line"><span class="keyword">int</span> d[MAXN+<span class="number">5</span>],gap[MAXN+<span class="number">5</span>];</span><br><span class="line"><span class="comment">/*層次、gap[i]=層次為i的點之個數*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> flow,<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(x==t)<span class="keyword">return</span> flow;</span><br><span class="line">    <span class="keyword">int</span> tmd=flow,tmp; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i){</span><br><span class="line">        <span class="keyword">if</span>(r[x][i]&amp;&amp;d[x]==d[i]+<span class="number">1</span>){</span><br><span class="line">            tmp=dfs(i,<span class="built_in">std</span>::min(tmd,r[x][i]),s,t);</span><br><span class="line">            f[x][i]+=tmp; f[i][x]-=tmp;</span><br><span class="line">            r[x][i]=g[x][i]-f[x][i];</span><br><span class="line">            r[i][x]=g[i][x]-f[i][x];</span><br><span class="line">            <span class="keyword">if</span>(!(tmd-=tmp))<span class="keyword">return</span> flow;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(!--gap[d[x]])d[s]=n;</span><br><span class="line">    ++gap[++d[x]];</span><br><span class="line">    <span class="keyword">return</span> flow-tmd;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sap</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>{</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="keyword">sizeof</span>(f));</span><br><span class="line">    <span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="keyword">sizeof</span>(d));</span><br><span class="line">    <span class="built_in">memset</span>(gap,<span class="number">0</span>,<span class="keyword">sizeof</span>(gap));</span><br><span class="line">    <span class="built_in">memcpy</span>(r,g,<span class="keyword">sizeof</span>(g));</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(gap[<span class="number">0</span>]=n;d[s]&lt;n;)ans+=dfs(s,INT_MAX,s,t);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ----------------------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sap</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> flow)</span></span>{</span><br><span class="line">  <span class="keyword">if</span>(v==T)<span class="keyword">return</span> flow;</span><br><span class="line">  <span class="keyword">int</span> rec=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(edge *p=d[v];p;p=p-&gt;next)<span class="keyword">if</span>(h[v]==h[p-&gt;t]+<span class="number">1</span>&amp;&amp;p-&gt;f){</span><br><span class="line">      <span class="keyword">int</span> ret=sap(p-&gt;t,min(flow-rec,p-&gt;f));</span><br><span class="line">      p-&gt;f-=ret;p-&gt;pair-&gt;f+=ret;d[v]=p;</span><br><span class="line">      <span class="keyword">if</span>((rec+=ret)==flow)<span class="keyword">return</span> flow;</span><br><span class="line">    }</span><br><span class="line">  d[v]=head[v];</span><br><span class="line">  <span class="keyword">if</span>(!(--gap[h[v]]))h[S]=T;</span><br><span class="line">  gap[++h[v]]++;</span><br><span class="line">  <span class="keyword">return</span> rec;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>dinic.cpp</span><a href="/code/scl/dinic.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 100</span></span><br><span class="line"><span class="keyword">int</span> n,m;<span class="comment">/*點數、邊數*/</span></span><br><span class="line"><span class="keyword">int</span> g[MAXN+<span class="number">5</span>][MAXN+<span class="number">5</span>],f[MAXN+<span class="number">5</span>][MAXN+<span class="number">5</span>],r[MAXN+<span class="number">5</span>][MAXN+<span class="number">5</span>];</span><br><span class="line"><span class="comment">/*容量上限、流量、剩餘容量*/</span></span><br><span class="line"><span class="keyword">int</span> level[MAXN+<span class="number">5</span>];<span class="comment">/*層次*/</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>{</span><br><span class="line">    <span class="built_in">memset</span>(level,<span class="number">0</span>,<span class="keyword">sizeof</span>(level));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;<span class="keyword">int</span> &gt;q;</span><br><span class="line">    q.push(s);</span><br><span class="line">    level[s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.size()){</span><br><span class="line">        <span class="keyword">int</span> x=q.front();q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            <span class="keyword">if</span>(!level[i]&amp;&amp;r[x][i]){</span><br><span class="line">                level[i]=level[x]+<span class="number">1</span>;</span><br><span class="line">                q.push(i);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> level[t]!=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> flow,<span class="keyword">int</span> t)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(x==t)<span class="keyword">return</span> flow;</span><br><span class="line">    <span class="keyword">int</span> tmd=flow,tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n&amp;&amp;tmd;++i){</span><br><span class="line">        <span class="keyword">if</span>(level[i]==level[x]+<span class="number">1</span>&amp;&amp;r[x][i]){</span><br><span class="line">            tmp=dfs(i,<span class="built_in">std</span>::min(tmd,r[x][i]),t);</span><br><span class="line">            f[x][i]+=tmp;</span><br><span class="line">            f[i][x]-=tmp;</span><br><span class="line">            r[x][i]=g[x][i]-f[x][i];</span><br><span class="line">            r[i][x]=g[i][x]-f[i][x];</span><br><span class="line">            tmd-=tmp;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> flow-tmd;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>{</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="keyword">sizeof</span>(f));</span><br><span class="line">    <span class="built_in">memcpy</span>(r,g,<span class="keyword">sizeof</span>(g));</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>,tmd=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(bfs(s,t)){</span><br><span class="line">        <span class="keyword">while</span>((tmd=dfs(s,INT_MAX,t)))ans+=tmd;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="費用流">費用流</h4><figure class="highlight cpp"><figcaption><span>fee.cpp</span><a href="/code/scl/fee.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最小费用大流，求只需要取相反数结果即可。</span></span><br><span class="line"><span class="comment">// 点的总数为 N，点的编号 0~N -1</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">struct</span> Edge</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> to,next,cap,flow,cost;</span><br><span class="line">}edge[MAXM];</span><br><span class="line"><span class="keyword">int</span> head[MAXN],tol;</span><br><span class="line"><span class="keyword">int</span> pre[MAXN],dis[MAXN];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];</span><br><span class="line"><span class="keyword">int</span> N;<span class="comment">//节点总个数，节点编号从0~N-1</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  N = n;</span><br><span class="line">  tol = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(head,-<span class="number">1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> cap,<span class="keyword">int</span> cost)</span></span><br><span class="line"></span>{</span><br><span class="line">  edge[tol].to = v;</span><br><span class="line">  edge[tol].cap = cap;</span><br><span class="line">  edge[tol].cost = cost;</span><br><span class="line">  edge[tol].flow = <span class="number">0</span>;</span><br><span class="line">  edge[tol].next = head[u];</span><br><span class="line">  head[u] = tol++;</span><br><span class="line">  edge[tol].to = u;</span><br><span class="line">  edge[tol].cap = <span class="number">0</span>;</span><br><span class="line">  edge[tol].cost = -cost;</span><br><span class="line">  edge[tol].flow = <span class="number">0</span>;</span><br><span class="line">  edge[tol].next = head[v];</span><br><span class="line">  head[v] = tol++;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; N;i++)</span><br><span class="line">  {</span><br><span class="line">    dis[i] = INF;</span><br><span class="line">    vis[i] = <span class="keyword">false</span>;</span><br><span class="line">    pre[i] = -<span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  dis[s] = <span class="number">0</span>;</span><br><span class="line">  vis[s] = <span class="keyword">true</span>;</span><br><span class="line">  q.push(s);</span><br><span class="line">  <span class="keyword">while</span>(!q.empty())</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> u = q.front();</span><br><span class="line">    q.pop();</span><br><span class="line">    vis[u] = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u]; i != -<span class="number">1</span>;i = edge[i].next)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">      <span class="keyword">if</span>(edge[i].cap &gt; edge[i].flow &amp;&amp;</span><br><span class="line">          dis[v] &gt; dis[u] + edge[i].cost )</span><br><span class="line">      {</span><br><span class="line">        dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">        pre[v] = i;</span><br><span class="line">        <span class="keyword">if</span>(!vis[v])</span><br><span class="line">        {</span><br><span class="line">          vis[v] = <span class="keyword">true</span>;</span><br><span class="line">          q.push(v);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(pre[t] == -<span class="number">1</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//返回的是最大流，cost存的是最小费用</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">minCostMaxflow</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t,<span class="keyword">int</span> &amp;cost)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">  cost = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(spfa(s,t))</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> Min = INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = pre[t];i != -<span class="number">1</span>;i = pre[edge[i^<span class="number">1</span>].to])</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(Min &gt; edge[i].cap - edge[i].flow)</span><br><span class="line">        Min = edge[i].cap - edge[i].flow;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = pre[t];i != -<span class="number">1</span>;i = pre[edge[i^<span class="number">1</span>].to])</span><br><span class="line">    {</span><br><span class="line">      edge[i].flow += Min;</span><br><span class="line">      edge[i^<span class="number">1</span>].flow -= Min;</span><br><span class="line">      cost += edge[i].cost * Min;</span><br><span class="line">    }</span><br><span class="line">    flow += Min;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> flow;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="LCA">LCA</h3><figure class="highlight cpp"><figcaption><span>lca.cpp</span><a href="/code/scl/lca.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span> (d1[u]&lt;d1[v]) swap(u,v);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=maxl-<span class="number">1</span>; i&gt;=<span class="number">0</span>; --i)</span><br><span class="line">    <span class="keyword">if</span> (d1[ath[u][i]]&gt;=d1[v]) u=ath[u][i];</span><br><span class="line">  <span class="keyword">if</span> (u == v) <span class="keyword">return</span> u;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=maxl-<span class="number">1</span>; i&gt;=<span class="number">0</span>; --i)</span><br><span class="line">    <span class="keyword">if</span> (ath[u][i]^ath[v][i]) u=ath[u][i],v=ath[v][i];</span><br><span class="line">  <span class="keyword">return</span> ath[u][<span class="number">0</span>];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>lca-tarjan.cpp</span><a href="/code/scl/lca-tarjan.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 100000</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXQ 100000</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator VIT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;::iterator VPIT;</span><br><span class="line"><span class="keyword">int</span> tr[MAXN+<span class="number">5</span>],siz[MAXN+<span class="number">5</span>];<span class="comment">/*並查集，dfs前必須初始化*/</span></span><br><span class="line"><span class="keyword">int</span> head[MAXN+<span class="number">5</span>],ans[MAXQ+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> v[MAXN+<span class="number">5</span>];<span class="comment">/*走訪標記*/</span> </span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt;G[MAXN+<span class="number">5</span>];</span><br><span class="line"><span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;Q[MAXN+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{ <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) tr[i]=i, siz[i]=<span class="number">1</span>; }</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{ <span class="keyword">return</span> tr[x]==x?x:tr[x]=find(tr[x]); }</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>{</span><br><span class="line">  <span class="keyword">if</span>((a=find(a)) == (b=find(b)))<span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span>(siz[a]&lt;siz[b]) swap(a,b);</span><br><span class="line">  tr[b]=a, siz[a]+=siz[b];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pa)</span></span>{</span><br><span class="line">  head[u]=u; </span><br><span class="line">  <span class="keyword">for</span>(VIT i=G[u].begin(); i!=G[u].end(); ++i){</span><br><span class="line">    <span class="keyword">if</span>(*i==pa)<span class="keyword">continue</span>;</span><br><span class="line">    dfs(*i,u); merge(u,*i);</span><br><span class="line">    head[find(u)]=u;<span class="comment">/*記錄u所在集合的頭為u*/</span> </span><br><span class="line">  }</span><br><span class="line">  v[u]=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (VPIT i=Q[u].begin(); i!=Q[u].end(); ++i)</span><br><span class="line">    <span class="keyword">if</span> (v[i-&gt;first]) ans[i-&gt;second]=head[find(i-&gt;first)];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> n,m,a,b;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;++i){</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</span><br><span class="line">    G[a].push_back(b);</span><br><span class="line">    G[b].push_back(a);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;++i){<span class="comment">/*紀錄詢問*/</span> </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</span><br><span class="line">    Q[a].push_back(make_pair(b,i));</span><br><span class="line">    Q[b].push_back(make_pair(a,i));</span><br><span class="line">  }</span><br><span class="line">  init(n);</span><br><span class="line">  dfs(<span class="number">1</span>,-<span class="number">1</span>);<span class="comment">/*假設編號為1~n，root=1*/</span> </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;++i) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans[i]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="二分圖匹配">二分圖匹配</h3><figure class="highlight cpp"><figcaption><span>binary.cpp</span><a href="/code/scl/binary.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* *******************************</span><br><span class="line"> * 二分图匹配（Hopcroft-Carp算法）</span><br><span class="line"> * 复杂度O(sqrt(n)*E)</span><br><span class="line"> * 邻接表存图，vector实现</span><br><span class="line"> * vector先初始化，然后假如边</span><br><span class="line"> * uN 为左端的顶点数，使用前赋值(点编号0开始)</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;G[MAXN];</span><br><span class="line"><span class="keyword">int</span> uN;</span><br><span class="line"><span class="keyword">int</span> Mx[MAXN],My[MAXN];</span><br><span class="line"><span class="keyword">int</span> dx[MAXN],dy[MAXN];</span><br><span class="line"><span class="keyword">int</span> dis;</span><br><span class="line"><span class="keyword">bool</span> used[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SearchP</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;Q;</span><br><span class="line">  dis = INF;</span><br><span class="line">  <span class="built_in">memset</span>(dx,-<span class="number">1</span>,<span class="keyword">sizeof</span>(dx));</span><br><span class="line">  <span class="built_in">memset</span>(dy,-<span class="number">1</span>,<span class="keyword">sizeof</span>(dy));</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; uN; i++)</span><br><span class="line">    <span class="keyword">if</span>(Mx[i] == -<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      Q.push(i);</span><br><span class="line">      dx[i] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">  <span class="keyword">while</span>(!Q.empty())</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> u = Q.front();</span><br><span class="line">    Q.pop();</span><br><span class="line">    <span class="keyword">if</span>(dx[u] &gt; dis)<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">int</span> sz = G[u].size();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; sz;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">      <span class="keyword">if</span>(dy[v] == -<span class="number">1</span>)</span><br><span class="line">      {</span><br><span class="line">        dy[v] = dx[u] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(My[v] == -<span class="number">1</span>)dis = dy[v];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">          dx[My[v]] = dy[v] + <span class="number">1</span>;</span><br><span class="line">          Q.push(My[v]);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> dis != INF;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> sz = G[u].size();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; sz;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">    <span class="keyword">if</span>(!used[v] &amp;&amp; dy[v] == dx[u] + <span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      used[v] = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">if</span>(My[v] != -<span class="number">1</span> &amp;&amp; dy[v] == dis)<span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span>(My[v] == -<span class="number">1</span> || DFS(My[v]))</span><br><span class="line">      {</span><br><span class="line">        My[v] = u;</span><br><span class="line">        Mx[u] = v;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MaxMatch</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(Mx,-<span class="number">1</span>,<span class="keyword">sizeof</span>(Mx));</span><br><span class="line">  <span class="built_in">memset</span>(My,-<span class="number">1</span>,<span class="keyword">sizeof</span>(My));</span><br><span class="line">  <span class="keyword">while</span>(SearchP())</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">memset</span>(used,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(used));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; uN;i++)</span><br><span class="line">      <span class="keyword">if</span>(Mx[i] == -<span class="number">1</span> &amp;&amp; DFS(i))</span><br><span class="line">        res++;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="一般圖匹配">一般圖匹配</h3><figure class="highlight cpp"><figcaption><span>bloss.cpp</span><a href="/code/scl/bloss.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// URAL 1099 一般图匹配</span></span><br><span class="line"><span class="comment">// 带花树算法</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">250</span>;</span><br><span class="line"><span class="keyword">int</span> N; <span class="comment">//点的个数，点的编号从1到N</span></span><br><span class="line"><span class="keyword">bool</span> Graph[MAXN][MAXN];</span><br><span class="line"><span class="keyword">int</span> Match[MAXN];</span><br><span class="line"><span class="keyword">bool</span> InQueue[MAXN],InPath[MAXN],InBlossom[MAXN];</span><br><span class="line"><span class="keyword">int</span> Head,Tail;</span><br><span class="line"><span class="keyword">int</span> Queue[MAXN];</span><br><span class="line"><span class="keyword">int</span> Start,Finish;</span><br><span class="line"><span class="keyword">int</span> NewBase;</span><br><span class="line"><span class="keyword">int</span> Father[MAXN],Base[MAXN];</span><br><span class="line"><span class="keyword">int</span> Count;<span class="comment">//匹配数，匹配对数是Count/2</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateGraph</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> u,v;</span><br><span class="line">  <span class="built_in">memset</span>(Graph,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(Graph));</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;N);</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v) == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    Graph[u][v] = Graph[v][u] = <span class="keyword">true</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Push</span><span class="params">(<span class="keyword">int</span> u)</span></span><br><span class="line"></span>{</span><br><span class="line">  Queue[Tail] = u;</span><br><span class="line">  Tail++;</span><br><span class="line">  InQueue[u] = <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Pop</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> res = Queue[Head];</span><br><span class="line">  Head++;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">FindCommonAncestor</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(InPath,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(InPath));</span><br><span class="line">  <span class="keyword">while</span>(<span class="keyword">true</span>)</span><br><span class="line">  {</span><br><span class="line">    u = Base[u];</span><br><span class="line">    InPath[u] = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(u == Start) <span class="keyword">break</span>;</span><br><span class="line">    u = Father[Match[u]];</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">while</span>(<span class="keyword">true</span>)</span><br><span class="line">  {</span><br><span class="line">    v = Base[v];</span><br><span class="line">    <span class="keyword">if</span>(InPath[v])<span class="keyword">break</span>;</span><br><span class="line">    v = Father[Match[v]];</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> v;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ResetTrace</span><span class="params">(<span class="keyword">int</span> u)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> v;</span><br><span class="line">  <span class="keyword">while</span>(Base[u] != NewBase)</span><br><span class="line">  {</span><br><span class="line">    v = Match[u];</span><br><span class="line">    InBlossom[Base[u]] = InBlossom[Base[v]] = <span class="keyword">true</span>;</span><br><span class="line">    u = Father[v];</span><br><span class="line">    <span class="keyword">if</span>(Base[u] != NewBase) Father[u] = v;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BloosomContract</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  NewBase = FindCommonAncestor(u,v);</span><br><span class="line">  <span class="built_in">memset</span>(InBlossom,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(InBlossom));</span><br><span class="line">  ResetTrace(u);</span><br><span class="line">  ResetTrace(v);</span><br><span class="line">  <span class="keyword">if</span>(Base[u] != NewBase) Father[u] = v;</span><br><span class="line">  <span class="keyword">if</span>(Base[v] != NewBase) Father[v] = u;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> tu = <span class="number">1</span>; tu &lt;= N; tu++)</span><br><span class="line">    <span class="keyword">if</span>(InBlossom[Base[tu]])</span><br><span class="line">    {</span><br><span class="line">      Base[tu] = NewBase;</span><br><span class="line">      <span class="keyword">if</span>(!InQueue[tu]) Push(tu);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FindAugmentingPath</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(InQueue,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(InQueue));</span><br><span class="line">  <span class="built_in">memset</span>(Father,<span class="number">0</span>,<span class="keyword">sizeof</span>(Father));</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= N;i++)</span><br><span class="line">    Base[i] = i;</span><br><span class="line">  Head = Tail = <span class="number">1</span>;</span><br><span class="line">  Push(Start);</span><br><span class="line">  Finish = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(Head &lt; Tail)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> u = Pop();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> v = <span class="number">1</span>; v &lt;= N; v++)</span><br><span class="line">      <span class="keyword">if</span>(Graph[u][v] &amp;&amp; (Base[u] != Base[v]) &amp;&amp; (Match[u] != v))</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span>((v == Start) || ((Match[v] &gt; <span class="number">0</span>) &amp;&amp; Father[Match[v]] &gt; <span class="number">0</span>))</span><br><span class="line">          BloosomContract(u,v);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Father[v] == <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">          Father[v] = u;</span><br><span class="line">          <span class="keyword">if</span>(Match[v] &gt; <span class="number">0</span>)</span><br><span class="line">            Push(Match[v]);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          {</span><br><span class="line">            Finish = v;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AugmentPath</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> u,v,w;</span><br><span class="line">  u = Finish;</span><br><span class="line">  <span class="keyword">while</span>(u &gt; <span class="number">0</span>)</span><br><span class="line">  {</span><br><span class="line">    v = Father[u];</span><br><span class="line">    w = Match[v];</span><br><span class="line">    Match[v] = u;</span><br><span class="line">    Match[u] = v;</span><br><span class="line">    u = w;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Edmonds</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(Match,<span class="number">0</span>,<span class="keyword">sizeof</span>(Match));</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= N; u++)</span><br><span class="line">    <span class="keyword">if</span>(Match[u] == <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">      Start = u;</span><br><span class="line">      FindAugmentingPath();</span><br><span class="line">      <span class="keyword">if</span>(Finish &gt; <span class="number">0</span>)AugmentPath();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintMatch</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  Count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= N;u++)</span><br><span class="line">    <span class="keyword">if</span>(Match[u] &gt; <span class="number">0</span>)</span><br><span class="line">      Count++;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,Count);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= N; u++)</span><br><span class="line">    <span class="keyword">if</span>(u &lt; Match[u])</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,u,Match[u]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  CreateGraph();<span class="comment">//建图</span></span><br><span class="line">  Edmonds();<span class="comment">//进行匹配</span></span><br><span class="line">  PrintMatch();<span class="comment">//输出匹配数和匹配</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="2-SAT">2-SAT</h3><figure class="highlight cpp"><figcaption><span>2sat.cpp</span><a href="/code/scl/2sat.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HDU 1814 染色法（可以得到字典序最小的解</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">20020</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">struct</span> Edge</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> to,next;</span><br><span class="line">}edge[MAXM];</span><br><span class="line"><span class="keyword">int</span> head[MAXN],tot;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  tot = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(head,-<span class="number">1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  edge[tot].to = v;edge[tot].next = head[u];head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN];<span class="comment">//染色标记，为true表示选择</span></span><br><span class="line"><span class="keyword">int</span> S[MAXN],top;<span class="comment">//栈</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(vis[u^<span class="number">1</span>])<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(vis[u])<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  vis[u] = <span class="keyword">true</span>;</span><br><span class="line">  S[top++] = u;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];i != -<span class="number">1</span>;i = edge[i].next)</span><br><span class="line">    <span class="keyword">if</span>(!dfs(edge[i].to))</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Twosat</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(vis,<span class="keyword">false</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i += <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(vis[i] || vis[i^<span class="number">1</span>])<span class="keyword">continue</span>;</span><br><span class="line">    top = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!dfs(i))</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">while</span>(top)vis[S[--top]] = <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">if</span>(!dfs(i^<span class="number">1</span>)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> n,m;</span><br><span class="line">  <span class="keyword">int</span> u,v;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m) == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">      u--;v--;</span><br><span class="line">      addedge(u,v^<span class="number">1</span>);</span><br><span class="line">      addedge(v,u^<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(Twosat(<span class="number">2</span>*n))</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">2</span>*n;i++)</span><br><span class="line">        <span class="keyword">if</span>(vis[i])</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,i+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"NIE\n"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="結構">結構</h2><h3 id="莫隊算法">莫隊算法</h3><figure class="highlight cpp"><figcaption><span>modui.cpp</span><a href="/code/scl/modui.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 100000 </span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXQ 100000 </span></span><br><span class="line"><span class="keyword">struct</span> Q{</span><br><span class="line">    <span class="keyword">int</span> l,r,i,block;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Q &amp;b)<span class="keyword">const</span>{</span><br><span class="line">        <span class="keyword">return</span> block==b.block?r&lt;b.r:block&lt;b.block;</span><br><span class="line">    }</span><br><span class="line">}q[MAXQ+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> s[MAXN+<span class="number">5</span>],lim;</span><br><span class="line"><span class="keyword">int</span> ans[MAXQ+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> u[MAXN+<span class="number">5</span>],cnt[MAXN+<span class="number">5</span>],cur_ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span></span>{</span><br><span class="line">    x=++u[x];</span><br><span class="line">    --cnt[x-<span class="number">1</span>];</span><br><span class="line">    ++cnt[x];</span><br><span class="line">    cur_ans=max(cur_ans,x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x)</span></span>{</span><br><span class="line">    x=--u[x];</span><br><span class="line">    --cnt[x+<span class="number">1</span>];</span><br><span class="line">    ++cnt[x];</span><br><span class="line">    <span class="keyword">if</span>(!cnt[cur_ans])--cur_ans;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> p[MAXN+<span class="number">5</span>],nn;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i){</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;s[i]);</span><br><span class="line">        p[i-<span class="number">1</span>]=s[i];</span><br><span class="line">    }</span><br><span class="line">    sort(p,p+n);</span><br><span class="line">    nn=unique(p,p+n)-p;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)s[i]=lower_bound(p,p+nn,s[i])-p;</span><br><span class="line">    lim=<span class="number">1</span>+(<span class="keyword">int</span>)<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;++i){</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;q[i].l,&amp;q[i].r);</span><br><span class="line">        q[i].block=q[i].l/lim;</span><br><span class="line">        q[i].i=i;</span><br><span class="line">    }</span><br><span class="line">    sort(q,q+m); </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,L=<span class="number">1</span>,R=<span class="number">0</span>;i&lt;m;++i){<span class="comment">/*這是閉區間的寫法*/</span> </span><br><span class="line">        <span class="keyword">while</span>(R&lt;q[i].r)add(s[++R]);</span><br><span class="line">        <span class="keyword">while</span>(R&gt;q[i].r)sub(s[R--]);</span><br><span class="line">        <span class="keyword">while</span>(L&gt;q[i].l)add(s[--L]);</span><br><span class="line">        <span class="keyword">while</span>(L&lt;q[i].l)sub(s[L++]);</span><br><span class="line">        ans[q[i].i]=cur_ans;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;++i)<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="可持久化樹狀數組">可持久化樹狀數組</h3><figure class="highlight cpp"><figcaption><span>bit-plus.cpp</span><a href="/code/scl/bit-plus.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> P{</span><br><span class="line">    <span class="keyword">int</span> data,id;</span><br><span class="line">    P(<span class="keyword">int</span> d=<span class="number">0</span>,<span class="keyword">int</span> i=<span class="number">0</span>):data(d),id(i){}</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> P &amp;a,<span class="keyword">const</span> P &amp;b){</span><br><span class="line">        <span class="keyword">return</span> a.id&lt;b.id;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"><span class="keyword">int</span> n,now;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;P &gt;tree[<span class="number">100005</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>{</span><br><span class="line">    now=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)tree[i].clear(),tree[i].push_back(P());</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> d)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(;x&lt;=n;x+=x&amp;(-x))tree[x].push_back(P(tree[x].back().data+d,now));</span><br><span class="line">    ++now; </span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> id)</span></span>{<span class="comment">/*查詢第id次操作的區間和，id從0開始計算*/</span></span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;P &gt;::iterator a;</span><br><span class="line">    <span class="keyword">for</span>(;x;x-=x&amp;(-x)){</span><br><span class="line">        a=<span class="built_in">std</span>::upper_bound(tree[x].begin(),tree[x].end(),P(id))-<span class="number">1</span>;</span><br><span class="line">        ans+=a-&gt;data;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="斜堆">斜堆</h3><figure class="highlight cpp"><figcaption><span>skewheap.cpp</span><a href="/code/scl/skewheap.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span>&lt;functional&gt;</span></span><br><span class="line"><span class="preprocessor">#ifndef SKEW_HEAP</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SKEW_HEAP</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> _Compare=<span class="built_in">std</span>::less&lt;T&gt; &gt;</span><br><span class="line"><span class="keyword">class</span> skew_heap{</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">struct</span> node{</span><br><span class="line">            T data;</span><br><span class="line">            node *l,*r;</span><br><span class="line">            node(<span class="keyword">const</span> T&amp;d):data(d),l(<span class="number">0</span>),r(<span class="number">0</span>){}</span><br><span class="line">        }*root;</span><br><span class="line">        <span class="keyword">int</span> _size;</span><br><span class="line">        _Compare cmp;</span><br><span class="line">        node *merge(node *a,node *b){</span><br><span class="line">            <span class="keyword">if</span>(!a||!b)<span class="keyword">return</span> a?a:b;</span><br><span class="line">            <span class="keyword">if</span>(cmp(a-&gt;data,b-&gt;data))<span class="keyword">return</span> merge(b,a);</span><br><span class="line">            node *t=a-&gt;r;</span><br><span class="line">            a-&gt;r=a-&gt;l;</span><br><span class="line">            a-&gt;l=merge(b,t);</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">void</span> _clear(node *&amp;o){</span><br><span class="line">            <span class="keyword">if</span>(o)_clear(o-&gt;l),_clear(o-&gt;r),<span class="keyword">delete</span> o;</span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        skew_heap():root(<span class="number">0</span>),_size(<span class="number">0</span>){}</span><br><span class="line">        ~skew_heap(){_clear(root);}</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>{</span><br><span class="line">            _clear(root);root=<span class="number">0</span>;_size=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">(skew_heap &amp;o)</span></span>{</span><br><span class="line">            root=merge(root,o.root);</span><br><span class="line">            o.root=<span class="number">0</span>;</span><br><span class="line">            _size+=o._size;</span><br><span class="line">            o._size=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(skew_heap &amp;o)</span></span>{</span><br><span class="line">            node *t=root;</span><br><span class="line">            root=o.root;</span><br><span class="line">            o.root=t;</span><br><span class="line">            <span class="keyword">int</span> st=_size;</span><br><span class="line">            _size=o._size;</span><br><span class="line">            o._size=st;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            _size++;</span><br><span class="line">            root=merge(root,<span class="keyword">new</span> node(data));</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="keyword">if</span>(_size)_size--;</span><br><span class="line">            node *tmd=merge(root-&gt;l,root-&gt;r);</span><br><span class="line">            <span class="keyword">delete</span> root;</span><br><span class="line">            root=tmd;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">const</span> T&amp; top(){<span class="keyword">return</span> root-&gt;data;}</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>{<span class="keyword">return</span> _size;}</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span></span>{<span class="keyword">return</span> !_size;}</span><br><span class="line">};</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h3 id="傻逼樹">傻逼樹</h3><figure class="highlight cpp"><figcaption><span>sbt.cpp</span><a href="/code/scl/sbt.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#ifndef SIZE_BALANCED_TREE</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SIZE_BALANCED_TREE</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="keyword">sb_t</span>ree{</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">struct</span> node{</span><br><span class="line">            node *ch[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">int</span> s;</span><br><span class="line">            T data;</span><br><span class="line">            node(<span class="keyword">const</span> T&amp;d):s(<span class="number">1</span>),data(d){}</span><br><span class="line">            node():s(<span class="number">0</span>){ch[<span class="number">0</span>]=ch[<span class="number">1</span>]=<span class="keyword">this</span>;}</span><br><span class="line">        }*nil,*root;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(node *&amp;a,<span class="keyword">bool</span> d)</span></span>{</span><br><span class="line">            node *b=a-&gt;ch[!d];</span><br><span class="line">            a-&gt;ch[!d]=b-&gt;ch[d];</span><br><span class="line">            b-&gt;ch[d]=a;</span><br><span class="line">            b-&gt;s=a-&gt;s;</span><br><span class="line">            a-&gt;s=a-&gt;ch[<span class="number">0</span>]-&gt;s+a-&gt;ch[<span class="number">1</span>]-&gt;s+<span class="number">1</span>;</span><br><span class="line">            a=b;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">(node *&amp;o,<span class="keyword">bool</span> d)</span></span>{</span><br><span class="line">            <span class="keyword">if</span>(o-&gt;ch[d]-&gt;ch[d]-&gt;s&gt;o-&gt;ch[!d]-&gt;s){</span><br><span class="line">                rotate(o,!d);</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(o-&gt;ch[d]-&gt;ch[!d]-&gt;s&gt;o-&gt;ch[!d]-&gt;s){</span><br><span class="line">                rotate(o-&gt;ch[d],d);</span><br><span class="line">                rotate(o,!d);</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">            maintain(o-&gt;ch[<span class="number">1</span>],<span class="number">1</span>);</span><br><span class="line">            maintain(o-&gt;ch[<span class="number">0</span>],<span class="number">0</span>);</span><br><span class="line">            maintain(o,<span class="number">1</span>);</span><br><span class="line">            maintain(o,<span class="number">0</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(node *&amp;o,<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            <span class="keyword">if</span>(!o-&gt;s){</span><br><span class="line">                o=<span class="keyword">new</span> node(data);</span><br><span class="line">                o-&gt;ch[<span class="number">0</span>]=o-&gt;ch[<span class="number">1</span>]=nil;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                ++o-&gt;s;</span><br><span class="line">                <span class="keyword">bool</span> d=o-&gt;data&lt;data;</span><br><span class="line">                insert(o-&gt;ch[d],data);</span><br><span class="line">                maintain(o,d);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">success_erase</span><span class="params">(node *&amp;o)</span></span>{</span><br><span class="line">            node *t=o;</span><br><span class="line">            o=o-&gt;ch[<span class="number">0</span>]-&gt;s?o-&gt;ch[<span class="number">0</span>]:o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">delete</span> t;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">erase</span><span class="params">(node *&amp;o,<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            <span class="keyword">if</span>(!o-&gt;s)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(o-&gt;data==data){</span><br><span class="line">                <span class="keyword">if</span>(!o-&gt;ch[<span class="number">0</span>]-&gt;s||!o-&gt;ch[<span class="number">1</span>]-&gt;s)success_erase(o);</span><br><span class="line">                <span class="keyword">else</span>{</span><br><span class="line">                    --o-&gt;s;</span><br><span class="line">                    node **t=&amp;o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">for</span>(;(*t)-&gt;ch[<span class="number">0</span>]-&gt;s;t=&amp;(*t)-&gt;ch[<span class="number">0</span>])(*t)-&gt;s--;</span><br><span class="line">                    o-&gt;data=(*t)-&gt;data;</span><br><span class="line">                    success_erase(*t);</span><br><span class="line">                }<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>(erase(o-&gt;ch[o-&gt;data&lt;data],data)){</span><br><span class="line">                --o-&gt;s;<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(node *&amp;o)</span></span>{</span><br><span class="line">            <span class="keyword">if</span>(o-&gt;s)clear(o-&gt;ch[<span class="number">0</span>]),clear(o-&gt;ch[<span class="number">1</span>]),<span class="keyword">delete</span> o;</span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">sb_t</span>ree():nil(<span class="keyword">new</span> node),root(nil){}</span><br><span class="line">        ~<span class="keyword">sb_t</span>ree(){clear(root),<span class="keyword">delete</span> nil;}</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>{clear(root),root=nil;}</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            insert(root,data);</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">erase</span><span class="params">(<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            <span class="keyword">return</span> erase(root,data);</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">find</span><span class="params">(<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            node *o=root;</span><br><span class="line">            <span class="keyword">while</span>(o-&gt;s&amp;&amp;o-&gt;data!=data)o=o-&gt;ch[o-&gt;data&lt;data];</span><br><span class="line">            <span class="keyword">return</span> o-&gt;s;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rank</span><span class="params">(<span class="keyword">const</span> T&amp;data)</span></span>{</span><br><span class="line">            <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(node *o=root;o-&gt;s;)</span><br><span class="line">            <span class="keyword">if</span>(o-&gt;data&lt;data)cnt+=o-&gt;ch[<span class="number">0</span>]-&gt;s+<span class="number">1</span>,o=o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> o=o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">return</span> cnt;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">const</span> T&amp;kth(<span class="keyword">int</span> k){</span><br><span class="line">            <span class="keyword">for</span>(node *o=root;;)</span><br><span class="line">            <span class="keyword">if</span>(k&lt;=o-&gt;ch[<span class="number">0</span>]-&gt;s)o=o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(k==o-&gt;ch[<span class="number">0</span>]-&gt;s+<span class="number">1</span>)<span class="keyword">return</span> o-&gt;data;</span><br><span class="line">            <span class="keyword">else</span> k-=o-&gt;ch[<span class="number">0</span>]-&gt;s+<span class="number">1</span>,o=o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">const</span> T&amp;<span class="keyword">operator</span>[](<span class="keyword">int</span> k){</span><br><span class="line">            <span class="keyword">return</span> kth(k);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">const</span> T&amp;preorder(<span class="keyword">const</span> T&amp;data){</span><br><span class="line">            node *x=root,*y=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(x-&gt;s)</span><br><span class="line">            <span class="keyword">if</span>(x-&gt;data&lt;data)y=x,x=x-&gt;ch[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> x=x-&gt;ch[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(y)<span class="keyword">return</span> y-&gt;data;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">const</span> T&amp;successor(<span class="keyword">const</span> T&amp;data){</span><br><span class="line">            node *x=root,*y=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(x-&gt;s)</span><br><span class="line">            <span class="keyword">if</span>(data&lt;x-&gt;data)y=x,x=x-&gt;ch[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> x=x-&gt;ch[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(y)<span class="keyword">return</span> y-&gt;data;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>{<span class="keyword">return</span> root-&gt;s;}</span><br><span class="line">};</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h3 id="伸展樹">伸展樹</h3><figure class="highlight cpp"><figcaption><span>splay.cpp</span><a href="/code/scl/splay.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题目：维修数列</span></span><br><span class="line"><span class="comment">// 经典题，插入、删除、修改、翻转、求和、求和最大的子序列 经典题</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> Key_value ch[ch[root][1]][0]</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">500010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> pre[MAXN],ch[MAXN][<span class="number">2</span>],key[MAXN],size[MAXN];</span><br><span class="line"><span class="keyword">int</span> root,tot1;</span><br><span class="line"><span class="keyword">int</span> sum[MAXN],rev[MAXN],same[MAXN];</span><br><span class="line"><span class="keyword">int</span> lx[MAXN],rx[MAXN],mx[MAXN];</span><br><span class="line"><span class="keyword">int</span> s[MAXN],tot2;<span class="comment">//内存池和容量</span></span><br><span class="line"><span class="keyword">int</span> a[MAXN];</span><br><span class="line"><span class="keyword">int</span> n,q;</span><br><span class="line"><span class="comment">//debug部分**********************************</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Treavel</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(x)</span><br><span class="line">  {</span><br><span class="line">    Treavel(ch[x][<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"结点：%2d: 左儿子 %2d 右儿子 %2d 父结点 %2d size = %2d\n"</span>,x,ch[x][<span class="number">0</span>],ch[x][<span class="number">1</span>],pre[x],size[x]);</span><br><span class="line">    Treavel(ch[x][<span class="number">1</span>]);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"root:%d\n"</span>,root);</span><br><span class="line">  Treavel(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//以上是debug部分**************************************</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">NewNode</span><span class="params">(<span class="keyword">int</span> &amp;r,<span class="keyword">int</span> father,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(tot2) r = s[tot2--];<span class="comment">//取的时候是tot2--,存的时候就是++tot2</span></span><br><span class="line">  <span class="keyword">else</span> r = ++tot1;</span><br><span class="line">  pre[r] = father;</span><br><span class="line">  ch[r][<span class="number">0</span>] = ch[r][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  key[r] = k;</span><br><span class="line">  sum[r] = k;</span><br><span class="line">  rev[r] = same[r] = <span class="number">0</span>;</span><br><span class="line">  lx[r] = rx[r] = mx[r] = k;</span><br><span class="line">  size[r] = <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update_Rev</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!r)<span class="keyword">return</span>;</span><br><span class="line">  swap(ch[r][<span class="number">0</span>],ch[r][<span class="number">1</span>]);</span><br><span class="line">  swap(lx[r],rx[r]);</span><br><span class="line">  rev[r] ^= <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update_Same</span><span class="params">(<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!r)<span class="keyword">return</span>;</span><br><span class="line">  key[r] = v;</span><br><span class="line">  sum[r] = v*size[r];</span><br><span class="line">  lx[r] = rx[r] = mx[r] = max(v,v*size[r]);</span><br><span class="line">  same[r] = <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> lson = ch[r][<span class="number">0</span>], rson = ch[r][<span class="number">1</span>];</span><br><span class="line">  size[r] = size[lson] + size[rson] + <span class="number">1</span>;</span><br><span class="line">  sum[r] = sum[lson] + sum[rson] + key[r];</span><br><span class="line">  lx[r] = max(lx[lson],sum[lson] + key[r] + max(<span class="number">0</span>,lx[rson]));</span><br><span class="line">  rx[r] = max(rx[rson],sum[rson] + key[r] + max(<span class="number">0</span>,rx[lson]));</span><br><span class="line">  mx[r] = max(<span class="number">0</span>,rx[lson]) + key[r] + max(<span class="number">0</span>,lx[rson]);</span><br><span class="line">  mx[r] = max(mx[r],max(mx[lson],mx[rson]));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(same[r])</span><br><span class="line">  {</span><br><span class="line">    Update_Same(ch[r][<span class="number">0</span>],key[r]);</span><br><span class="line">    Update_Same(ch[r][<span class="number">1</span>],key[r]);</span><br><span class="line">    same[r] = <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(rev[r])</span><br><span class="line">  {</span><br><span class="line">    Update_Rev(ch[r][<span class="number">0</span>]);</span><br><span class="line">    Update_Rev(ch[r][<span class="number">1</span>]);</span><br><span class="line">    rev[r] = <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Build</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> father)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(l &gt; r)<span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line">  NewNode(x,father,a[mid]);</span><br><span class="line">  Build(ch[x][<span class="number">0</span>],l,mid-<span class="number">1</span>,x);</span><br><span class="line">  Build(ch[x][<span class="number">1</span>],mid+<span class="number">1</span>,r,x);</span><br><span class="line">  push_up(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  root = tot1 = tot2 = <span class="number">0</span>;</span><br><span class="line">  ch[root][<span class="number">0</span>] = ch[root][<span class="number">1</span>] = size[root] = pre[root] = <span class="number">0</span>;</span><br><span class="line">  same[root] = rev[root] = sum[root] = key[root] = <span class="number">0</span>;</span><br><span class="line">  lx[root] = rx[root] = mx[root] = -INF;</span><br><span class="line">  NewNode(root,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">  NewNode(ch[root][<span class="number">1</span>],root,-<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">  Build(Key_value,<span class="number">0</span>,n-<span class="number">1</span>,ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//旋转,0为左旋，1为右旋</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rotate</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> kind)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> y = pre[x];</span><br><span class="line">  push_down(y);</span><br><span class="line">  push_down(x);</span><br><span class="line">  ch[y][!kind] = ch[x][kind];</span><br><span class="line">  pre[ch[x][kind]] = y;</span><br><span class="line">  <span class="keyword">if</span>(pre[y])</span><br><span class="line">    ch[pre[y]][ch[pre[y]][<span class="number">1</span>]==y] = x;</span><br><span class="line">  pre[x] = pre[y];</span><br><span class="line">  ch[x][kind] = y;</span><br><span class="line">  pre[y] = x;</span><br><span class="line">  push_up(y);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//Splay调整，将r结点调整到goal下面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Splay</span><span class="params">(<span class="keyword">int</span> r,<span class="keyword">int</span> goal)</span></span><br><span class="line"></span>{</span><br><span class="line">  push_down(r);</span><br><span class="line">  <span class="keyword">while</span>(pre[r] != goal)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(pre[pre[r]] == goal)</span><br><span class="line">    {</span><br><span class="line">      push_down(pre[r]);</span><br><span class="line">      push_down(r);</span><br><span class="line">      Rotate(r,ch[pre[r]][<span class="number">0</span>] == r);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      push_down(pre[pre[r]]);</span><br><span class="line">      push_down(pre[r]);</span><br><span class="line">      push_down(r);</span><br><span class="line">      <span class="keyword">int</span> y = pre[r];</span><br><span class="line">      <span class="keyword">int</span> kind = ch[pre[y]][<span class="number">0</span>]==y;</span><br><span class="line">      <span class="keyword">if</span>(ch[y][kind] == r)</span><br><span class="line">      {</span><br><span class="line">        Rotate(r,!kind);</span><br><span class="line">        Rotate(r,kind);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        Rotate(y,kind);</span><br><span class="line">        Rotate(r,kind);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  push_up(r);</span><br><span class="line">  <span class="keyword">if</span>(goal == <span class="number">0</span>) root = r;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Get_kth</span><span class="params">(<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  push_down(r);</span><br><span class="line">  <span class="keyword">int</span> t = size[ch[r][<span class="number">0</span>]] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(t == k)<span class="keyword">return</span> r;</span><br><span class="line">  <span class="keyword">if</span>(t &gt; k)<span class="keyword">return</span> Get_kth(ch[r][<span class="number">0</span>],k);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> Get_kth(ch[r][<span class="number">1</span>],k-t);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//在第pos个数后面插入tot个数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> tot)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; tot;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">  Splay(Get_kth(root,pos+<span class="number">1</span>),<span class="number">0</span>);</span><br><span class="line">  Splay(Get_kth(root,pos+<span class="number">2</span>),root);</span><br><span class="line">  Build(Key_value,<span class="number">0</span>,tot-<span class="number">1</span>,ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//删除子树</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!r)<span class="keyword">return</span>;</span><br><span class="line">  s[++tot2] = r;</span><br><span class="line">  erase(ch[r][<span class="number">0</span>]);</span><br><span class="line">  erase(ch[r][<span class="number">1</span>]);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//从第pos个数开始连续删除tot个数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delete</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> tot)</span></span><br><span class="line"></span>{</span><br><span class="line">  Splay(Get_kth(root,pos),<span class="number">0</span>);</span><br><span class="line">  Splay(Get_kth(root,pos+tot+<span class="number">1</span>),root);</span><br><span class="line">  erase(Key_value);</span><br><span class="line">  pre[Key_value] = <span class="number">0</span>;</span><br><span class="line">  Key_value = <span class="number">0</span>;</span><br><span class="line">  push_up(ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//将从第pos个数开始的连续的tot个数修改为c</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Make_Same</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> tot,<span class="keyword">int</span> c)</span></span><br><span class="line"></span>{</span><br><span class="line">  Splay(Get_kth(root,pos),<span class="number">0</span>);</span><br><span class="line">  Splay(Get_kth(root,pos+tot+<span class="number">1</span>),root);</span><br><span class="line">  Update_Same(Key_value,c);</span><br><span class="line">  push_up(ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//将第pos个数开始的连续tot个数进行反转</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reverse</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> tot)</span></span><br><span class="line"></span>{</span><br><span class="line">  Splay(Get_kth(root,pos),<span class="number">0</span>);</span><br><span class="line">  Splay(Get_kth(root,pos+tot+<span class="number">1</span>),root);</span><br><span class="line">  Update_Rev(Key_value);</span><br><span class="line">  push_up(ch[root][<span class="number">1</span>]);</span><br><span class="line">  push_up(root);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//得到第pos个数开始的tot个数的和</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Get_Sum</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> tot)</span></span><br><span class="line"></span>{</span><br><span class="line">  Splay(Get_kth(root,pos),<span class="number">0</span>);</span><br><span class="line">  Splay(Get_kth(root,pos+tot+<span class="number">1</span>),root);</span><br><span class="line">  <span class="keyword">return</span> sum[Key_value];</span><br><span class="line">}</span><br><span class="line"><span class="comment">//得到第pos个数开始的tot个数中最大的子段和</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Get_MaxSum</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> tot)</span></span><br><span class="line"></span>{</span><br><span class="line">  Splay(Get_kth(root,pos),<span class="number">0</span>);</span><br><span class="line">  Splay(Get_kth(root,pos+tot+<span class="number">1</span>),root);</span><br><span class="line">  <span class="keyword">return</span> mx[Key_value];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InOrder</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!r)<span class="keyword">return</span>;</span><br><span class="line">  push_down(r);</span><br><span class="line">  InOrder(ch[r][<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d "</span>,key[r]);</span><br><span class="line">  InOrder(ch[r][<span class="number">1</span>]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q) == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    Init();</span><br><span class="line">    <span class="keyword">char</span> op[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">int</span> x,y,z;</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">strcmp</span>(op,<span class="string">"INSERT"</span>) == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        Insert(x,y);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(op,<span class="string">"DELETE"</span>) == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        Delete(x,y);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(op,<span class="string">"MAKE-SAME"</span>) == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">        Make_Same(x,y,z);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(op,<span class="string">"REVERSE"</span>) == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        Reverse(x,y);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(op,<span class="string">"GET-SUM"</span>) == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,Get_Sum(x,y));</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(op,<span class="string">"MAX-SUM"</span>) == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,Get_MaxSum(<span class="number">1</span>,size[root]-<span class="number">2</span>));</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="劃分樹">劃分樹</h3><figure class="highlight cpp"><figcaption><span>divide.cpp</span><a href="/code/scl/divide.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * 划分树（查询区间第k大）</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">int</span> tree[<span class="number">20</span>][MAXN];<span class="comment">//表示每层每个位置的值</span></span><br><span class="line"><span class="keyword">int</span> sorted[MAXN];<span class="comment">//已经排序好的数</span></span><br><span class="line"><span class="keyword">int</span> toleft[<span class="number">20</span>][MAXN];<span class="comment">//toleft[p][i]表示第i层从1到i有数分入左边</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> dep)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(l == r)<span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> same = mid - l + <span class="number">1</span>;<span class="comment">//表示等于中间值而且被分入左边的个数</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++) <span class="comment">//注意是l,不是one</span></span><br><span class="line">    <span class="keyword">if</span>(tree[dep][i] &lt; sorted[mid])</span><br><span class="line">      same--;</span><br><span class="line">  <span class="keyword">int</span> lpos = l;</span><br><span class="line">  <span class="keyword">int</span> rpos = mid+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = l;i &lt;= r;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(tree[dep][i] &lt; sorted[mid])</span><br><span class="line">      tree[dep+<span class="number">1</span>][lpos++] = tree[dep][i];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(tree[dep][i] == sorted[mid] &amp;&amp; same &gt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">      tree[dep+<span class="number">1</span>][lpos++] = tree[dep][i];</span><br><span class="line">      same--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      tree[dep+<span class="number">1</span>][rpos++] = tree[dep][i];</span><br><span class="line">    toleft[dep][i] = toleft[dep][l-<span class="number">1</span>] + lpos - l;</span><br><span class="line">  }</span><br><span class="line">  build(l,mid,dep+<span class="number">1</span>);</span><br><span class="line">  build(mid+<span class="number">1</span>,r,dep+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//查询区间第k大的数,[L,R]是大区间，[l,r]是要查询的小区间</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> dep,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(l == r)<span class="keyword">return</span> tree[dep][l];</span><br><span class="line">  <span class="keyword">int</span> mid = (L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> cnt = toleft[dep][r] - toleft[dep][l-<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span>(cnt &gt;= k)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> newl = L + toleft[dep][l-<span class="number">1</span>] - toleft[dep][L-<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> newr = newl + cnt - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> query(L,mid,newl,newr,dep+<span class="number">1</span>,k);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> newr = r + toleft[dep][R] - toleft[dep][r];</span><br><span class="line">    <span class="keyword">int</span> newl = newr - (r-l-cnt);</span><br><span class="line">    <span class="keyword">return</span> query(mid+<span class="number">1</span>,R,newl,newr,dep+<span class="number">1</span>,k-cnt);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> n,m;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m)==<span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">memset</span>(tree,<span class="number">0</span>,<span class="keyword">sizeof</span>(tree));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;tree[<span class="number">0</span>][i]);</span><br><span class="line">      sorted[i] = tree[<span class="number">0</span>][i];</span><br><span class="line">    }</span><br><span class="line">    sort(sorted+<span class="number">1</span>,sorted+n+<span class="number">1</span>);</span><br><span class="line">    build(<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> s,t,k;</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;s,&amp;t,&amp;k);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(<span class="number">1</span>,n,s,t,<span class="number">0</span>,k));</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="動態樹">動態樹</h3><figure class="highlight cpp"><figcaption><span>lct.cpp</span><a href="/code/scl/lct.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态树 HDU 4010</span></span><br><span class="line"><span class="comment">// 切割、合并子树，路径上所有点的权增加一个值，查询路径上点权的最大值</span></span><br><span class="line"><span class="comment">//动态维护一组森林，要求支持一下操作:</span></span><br><span class="line"><span class="comment">//link(a,b) : 如果a,b不在同一颗子树中，则通过在a,b之间连边的方式，连接这两颗子树</span></span><br><span class="line"><span class="comment">//cut(a,b) : 如果a,b在同一颗子树中，且a!=b,则将a视为这颗子树的根以后，切断b与其父亲结点的连接</span></span><br><span class="line"><span class="comment">//ADD(a,b,w): 如果a,b在同一颗子树中，则将a,b之间路径上所有点的点权增加w</span></span><br><span class="line"><span class="comment">//query(a,b): 如果a,b在同一颗子树中，返回a,b之间路径上点权的最大值</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">300010</span>;</span><br><span class="line"><span class="keyword">int</span> ch[MAXN][<span class="number">2</span>],pre[MAXN],key[MAXN];</span><br><span class="line"><span class="keyword">int</span> add[MAXN],rev[MAXN],Max[MAXN];</span><br><span class="line"><span class="keyword">bool</span> rt[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update_Add</span><span class="params">(<span class="keyword">int</span> r,<span class="keyword">int</span> d)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!r)<span class="keyword">return</span>;</span><br><span class="line">  key[r] += d;</span><br><span class="line">  add[r] += d;</span><br><span class="line">  Max[r] += d;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update_Rev</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!r)<span class="keyword">return</span>;</span><br><span class="line">  swap(ch[r][<span class="number">0</span>],ch[r][<span class="number">1</span>]);</span><br><span class="line">  rev[r] ^= <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(add[r])</span><br><span class="line">  {</span><br><span class="line">    Update_Add(ch[r][<span class="number">0</span>],add[r]);</span><br><span class="line">    Update_Add(ch[r][<span class="number">1</span>],add[r]);</span><br><span class="line">    add[r] = <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(rev[r])</span><br><span class="line">  {</span><br><span class="line">    Update_Rev(ch[r][<span class="number">0</span>]);</span><br><span class="line">    Update_Rev(ch[r][<span class="number">1</span>]);</span><br><span class="line">    rev[r] = <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  Max[r] = max(max(Max[ch[r][<span class="number">0</span>]],Max[ch[r][<span class="number">1</span>]]),key[r]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rotate</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> y = pre[x], kind = ch[y][<span class="number">1</span>]==x;</span><br><span class="line">  ch[y][kind] = ch[x][!kind];</span><br><span class="line">  pre[ch[y][kind]] = y;</span><br><span class="line">  pre[x] = pre[y];</span><br><span class="line">  pre[y] = x;</span><br><span class="line">  ch[x][!kind] = y;</span><br><span class="line">  <span class="keyword">if</span>(rt[y])</span><br><span class="line">    rt[y] = <span class="keyword">false</span>, rt[x] = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    ch[pre[x]][ch[pre[x]][<span class="number">1</span>]==y] = x;</span><br><span class="line">  push_up(y);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//P函数先将根结点到r的路径上所有的结点的标记逐级下放</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">P</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!rt[r])P(pre[r]);</span><br><span class="line">  push_down(r);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Splay</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  P(r);</span><br><span class="line">  <span class="keyword">while</span>( !rt[r] )</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> f = pre[r], ff = pre[f];</span><br><span class="line">    <span class="keyword">if</span>(rt[f])</span><br><span class="line">      Rotate(r);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( (ch[ff][<span class="number">1</span>]==f)==(ch[f][<span class="number">1</span>]==r) )</span><br><span class="line">      Rotate(f), Rotate(r);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      Rotate(r), Rotate(r);</span><br><span class="line">  }</span><br><span class="line">  push_up(r);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Access</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> y = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>( ; x ; x = pre[y=x])</span><br><span class="line">  {</span><br><span class="line">    Splay(x);</span><br><span class="line">    rt[ch[x][<span class="number">1</span>]] = <span class="keyword">true</span>, rt[ch[x][<span class="number">1</span>]=y] = <span class="keyword">false</span>;</span><br><span class="line">    push_up(x);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> y;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//判断是否是同根(真实的树，非splay)</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">judge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(pre[u]) u = pre[u];</span><br><span class="line">  <span class="keyword">while</span>(pre[v]) v = pre[v];</span><br><span class="line">  <span class="keyword">return</span> u == v;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//使r成为它所在的树的根</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mroot</span><span class="params">(<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  Access(r);</span><br><span class="line">  Splay(r);</span><br><span class="line">  Update_Rev(r);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//调用后u是原来u和v的lca,v和ch[u][1]分别存着lca的2个儿子</span></span><br><span class="line"><span class="comment">//(原来u和v所在的2颗子树)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> &amp;u,<span class="keyword">int</span> &amp;v)</span></span><br><span class="line"></span>{</span><br><span class="line">  Access(v), v = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(u)</span><br><span class="line">  {</span><br><span class="line">    Splay(u);</span><br><span class="line">    <span class="keyword">if</span>(!pre[u])<span class="keyword">return</span>;</span><br><span class="line">    rt[ch[u][<span class="number">1</span>]] = <span class="keyword">true</span>;</span><br><span class="line">    rt[ch[u][<span class="number">1</span>]=v] = <span class="keyword">false</span>;</span><br><span class="line">    push_up(u);</span><br><span class="line">    u = pre[v = u];</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">link</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(judge(u,v))</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  mroot(u);</span><br><span class="line">  pre[u] = v;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//使u成为u所在树的根，并且v和它父亲的边断开</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(u == v || !judge(u,v))</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  mroot(u);</span><br><span class="line">  Splay(v);</span><br><span class="line">  pre[ch[v][<span class="number">0</span>]] = pre[v];</span><br><span class="line">  pre[v] = <span class="number">0</span>;</span><br><span class="line">  rt[ch[v][<span class="number">0</span>]] = <span class="keyword">true</span>;</span><br><span class="line">  ch[v][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  push_up(v);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ADD</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!judge(u,v))</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  lca(u,v);</span><br><span class="line">  Update_Add(ch[u][<span class="number">1</span>],w);</span><br><span class="line">  Update_Add(v,w);</span><br><span class="line">  key[u] += w;</span><br><span class="line">  push_up(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(!judge(u,v))</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  lca(u,v);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,max(max(Max[v],Max[ch[u][<span class="number">1</span>]]),key[u]));</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> Edge</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> to,next;</span><br><span class="line">}edge[MAXN*<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN],tot;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  edge[tot].to = v;</span><br><span class="line">  edge[tot].next = head[u];</span><br><span class="line">  head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];i != -<span class="number">1</span>; i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>(pre[v] != <span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">    pre[v] = u;</span><br><span class="line">    dfs(v);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="comment">//freopen("in.txt","r",stdin);</span></span><br><span class="line">  <span class="comment">//freopen("out.txt","w",stdout);</span></span><br><span class="line">  <span class="keyword">int</span> n,q,u,v;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      head[i] = -<span class="number">1</span>;</span><br><span class="line">      pre[i] = <span class="number">0</span>;</span><br><span class="line">      ch[i][<span class="number">0</span>] = ch[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      rev[i] = <span class="number">0</span>;</span><br><span class="line">      add[i] = <span class="number">0</span>;</span><br><span class="line">      rt[i] = <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    Max[<span class="number">0</span>] = -<span class="number">2000000000</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">      addedge(u,v);</span><br><span class="line">      addedge(v,u);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;key[i]);</span><br><span class="line">      Max[i] = key[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</span><br><span class="line">    pre[<span class="number">1</span>] = -<span class="number">1</span>;</span><br><span class="line">    dfs(<span class="number">1</span>);</span><br><span class="line">    pre[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> op;</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;op);</span><br><span class="line">      <span class="keyword">if</span>(op == <span class="number">1</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">int</span> x,y;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        link(x,y);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">int</span> x,y;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        cut(x,y);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">3</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">int</span> w,x,y;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;w,&amp;x,&amp;y);</span><br><span class="line">        ADD(x,y,w);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">int</span> x,y;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        query(x,y);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="主席樹">主席樹</h3><figure class="highlight cpp"><figcaption><span>boss.cpp</span><a href="/code/scl/boss.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * 给出一个序列，查询区间内有多少个不相同的数</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">30010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = MAXN * <span class="number">100</span>;</span><br><span class="line"><span class="keyword">int</span> n,q,tot;</span><br><span class="line"><span class="keyword">int</span> a[MAXN];</span><br><span class="line"><span class="keyword">int</span> T[MAXN],lson[M],rson[M],c[M];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> root = tot++;</span><br><span class="line">  c[root] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(l != r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    lson[root] = build(l,mid);</span><br><span class="line">    rson[root] = build(mid+<span class="number">1</span>,r);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> root;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> newroot = tot++, tmp = newroot;</span><br><span class="line">  c[newroot] = c[root] + val;</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">1</span>, r = n;</span><br><span class="line">  <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid)</span><br><span class="line">    {</span><br><span class="line">      lson[newroot] = tot++; rson[newroot] = rson[root];</span><br><span class="line">      newroot = lson[newroot]; root = lson[root];</span><br><span class="line">      r = mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      rson[newroot] = tot++; lson[newroot] = lson[root];</span><br><span class="line">      newroot = rson[newroot]; root = rson[root];</span><br><span class="line">      l = mid+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    c[newroot] = c[root] + val;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> tmp;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> pos)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">1</span>, r = n;</span><br><span class="line">  <span class="keyword">while</span>(pos &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid)</span><br><span class="line">    {</span><br><span class="line">      r = mid;</span><br><span class="line">      root = lson[root];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      ret += c[lson[root]];</span><br><span class="line">      root = rson[root];</span><br><span class="line">      l = mid+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ret + c[root];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="comment">//freopen("in.txt","r",stdin);</span></span><br><span class="line">  <span class="comment">//freopen("out.txt","w",stdout);</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">    T[n+<span class="number">1</span>] = build(<span class="number">1</span>,n);</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;mp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n;i&gt;= <span class="number">1</span>;i--)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(mp.find(a[i]) == mp.end())</span><br><span class="line">      {</span><br><span class="line">        T[i] = update(T[i+<span class="number">1</span>],i,<span class="number">1</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">int</span> tmp = update(T[i+<span class="number">1</span>],mp[a[i]],-<span class="number">1</span>);</span><br><span class="line">        T[i] = update(tmp,i,<span class="number">1</span>);</span><br><span class="line">      }</span><br><span class="line">      mp[a[i]] = i;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">int</span> l,r;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(T[l],r));</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.2 静态区间第 k大 2104</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = MAXN * <span class="number">30</span>;</span><br><span class="line"><span class="keyword">int</span> n,q,m,tot;</span><br><span class="line"><span class="keyword">int</span> a[MAXN], t[MAXN];</span><br><span class="line"><span class="keyword">int</span> T[MAXN], lson[M], rson[M], c[M];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init_hash</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">    t[i] = a[i];</span><br><span class="line">  sort(t+<span class="number">1</span>,t+<span class="number">1</span>+n);</span><br><span class="line">  m = unique(t+<span class="number">1</span>,t+<span class="number">1</span>+n)-t-<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> root = tot++;</span><br><span class="line">  c[root] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(l != r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    lson[root] = build(l,mid);</span><br><span class="line">    rson[root] = build(mid+<span class="number">1</span>,r);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> root;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> lower_bound(t+<span class="number">1</span>,t+<span class="number">1</span>+m,x) - t;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> newroot = tot++, tmp = newroot;</span><br><span class="line">  c[newroot] = c[root] + val;</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">1</span>, r = m;</span><br><span class="line">  <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid)</span><br><span class="line">    {</span><br><span class="line">      lson[newroot] = tot++; rson[newroot] = rson[root];</span><br><span class="line">      newroot = lson[newroot]; root = lson[root];</span><br><span class="line">      r = mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      rson[newroot] = tot++; lson[newroot] = lson[root];</span><br><span class="line">      newroot = rson[newroot]; root = rson[root];</span><br><span class="line">      l = mid+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    c[newroot] = c[root] + val;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> tmp;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> left_root,<span class="keyword">int</span> right_root,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">1</span>, r = m;</span><br><span class="line">  <span class="keyword">while</span>( l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(c[lson[left_root]]-c[lson[right_root]] &gt;= k )</span><br><span class="line">    {</span><br><span class="line">      r = mid;</span><br><span class="line">      left_root = lson[left_root];</span><br><span class="line">      right_root = lson[right_root];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      l = mid + <span class="number">1</span>;</span><br><span class="line">      k -= c[lson[left_root]] - c[lson[right_root]];</span><br><span class="line">      left_root = rson[left_root];</span><br><span class="line">      right_root = rson[right_root];</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="comment">//freopen("in.txt","r",stdin);</span></span><br><span class="line">  <span class="comment">//freopen("out.txt","w",stdout);</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q) == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">    Init_hash();</span><br><span class="line">    T[n+<span class="number">1</span>] = build(<span class="number">1</span>,m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n;i ;i--)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">int</span> pos = hash(a[i]);</span><br><span class="line">      T[i] = update(T[i+<span class="number">1</span>],pos,<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">int</span> l,r,k;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;l,&amp;r,&amp;k);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,t[query(T[l],T[r+<span class="number">1</span>],k)]);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 6.3 树上路径点权第 k大SPOJ COT</span></span><br><span class="line"><span class="comment">// LCA + 主席树</span></span><br><span class="line"><span class="comment">// 主席树部分 *****************</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">200010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = MAXN * <span class="number">40</span>;</span><br><span class="line"><span class="keyword">int</span> n,q,m,TOT;</span><br><span class="line"><span class="keyword">int</span> a[MAXN], t[MAXN];</span><br><span class="line"><span class="keyword">int</span> T[MAXN], lson[M], rson[M], c[M];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init_hash</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">    t[i] = a[i];</span><br><span class="line">  sort(t+<span class="number">1</span>,t+<span class="number">1</span>+n);</span><br><span class="line">  m = unique(t+<span class="number">1</span>,t+n+<span class="number">1</span>)-t-<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> root = TOT++;</span><br><span class="line">  c[root] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(l != r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    lson[root] = build(l,mid);</span><br><span class="line">    rson[root] = build(mid+<span class="number">1</span>,r);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> root;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> lower_bound(t+<span class="number">1</span>,t+<span class="number">1</span>+m,x) - t;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> newroot = TOT++, tmp = newroot;</span><br><span class="line">  c[newroot] = c[root] + val;</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">1</span>, r = m;</span><br><span class="line">  <span class="keyword">while</span>( l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid)</span><br><span class="line">    {</span><br><span class="line">      lson[newroot] = TOT++; rson[newroot] = rson[root];</span><br><span class="line">      newroot = lson[newroot]; root = lson[root];</span><br><span class="line">      r = mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      rson[newroot] = TOT++; lson[newroot] = lson[root];</span><br><span class="line">      newroot = rson[newroot]; root = rson[root];</span><br><span class="line">      l = mid+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    c[newroot] = c[root] + val;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> tmp;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> left_root,<span class="keyword">int</span> right_root,<span class="keyword">int</span> LCA,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> lca_root = T[LCA];</span><br><span class="line">  <span class="keyword">int</span> pos = hash(a[LCA]);</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">1</span>, r = m;</span><br><span class="line">  <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp = c[lson[left_root]] + c[lson[right_root]] - <span class="number">2</span>*c[lson[lca_root]] + (pos &gt;= l &amp;&amp; pos &lt;= mid);</span><br><span class="line">    <span class="keyword">if</span>(tmp &gt;= k)</span><br><span class="line">    {</span><br><span class="line">      left_root = lson[left_root];</span><br><span class="line">      right_root = lson[right_root];</span><br><span class="line">      lca_root = lson[lca_root];</span><br><span class="line">      r = mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      k -= tmp;</span><br><span class="line">      left_root = rson[left_root];</span><br><span class="line">      right_root = rson[right_root];</span><br><span class="line">      lca_root = rson[lca_root];</span><br><span class="line">      l = mid + <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//LCA部分</span></span><br><span class="line"><span class="keyword">int</span> rmq[<span class="number">2</span>*MAXN];<span class="comment">//rmq数组，就是欧拉序列对应的深度序列</span></span><br><span class="line"><span class="keyword">struct</span> ST</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> mm[<span class="number">2</span>*MAXN];</span><br><span class="line">  <span class="keyword">int</span> dp[<span class="number">2</span>*MAXN][<span class="number">20</span>];<span class="comment">//最小值对应的下标</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line">  </span>{</span><br><span class="line">    mm[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      mm[i] = ((i&amp;(i-<span class="number">1</span>)) == <span class="number">0</span>)?mm[i-<span class="number">1</span>]+<span class="number">1</span>:mm[i-<span class="number">1</span>];</span><br><span class="line">      dp[i][<span class="number">0</span>] = i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= mm[n];j++)</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span>&lt;&lt;j) - <span class="number">1</span> &lt;= n; i++)</span><br><span class="line">        dp[i][j] = rmq[dp[i][j-<span class="number">1</span>]] &lt; rmq[dp[i+(<span class="number">1</span>&lt;&lt;(j-<span class="number">1</span>))][j-<span class="number">1</span>]]?dp[i][j-<span class="number">1</span>]:dp[i+(<span class="number">1</span>&lt;&lt;(j-<span class="number">1</span>))][j-<span class="number">1</span>];</span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span><span class="comment">//查询[a,b]之间最小值的下标</span></span><br><span class="line">  </span>{</span><br><span class="line">    <span class="keyword">if</span>(a &gt; b)swap(a,b);</span><br><span class="line">    <span class="keyword">int</span> k = mm[b-a+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> rmq[dp[a][k]] &lt;= rmq[dp[b-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]]?dp[a][k]:dp[b-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k];</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="comment">//边的结构体定义</span></span><br><span class="line"><span class="keyword">struct</span> Edge</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> to,next;</span><br><span class="line">};</span><br><span class="line">Edge edge[MAXN*<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> tot,head[MAXN];</span><br><span class="line"><span class="keyword">int</span> F[MAXN*<span class="number">2</span>];<span class="comment">//欧拉序列，就是dfs遍历的顺序，长度为2*n-1,下标从1开始</span></span><br><span class="line"><span class="keyword">int</span> P[MAXN];<span class="comment">//P[i]表示点i在F中第一次出现的位置</span></span><br><span class="line"><span class="keyword">int</span> cnt;</span><br><span class="line">ST st;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  tot = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(head,-<span class="number">1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span><span class="comment">//加边，无向边需要加两次</span></span><br><span class="line"></span>{</span><br><span class="line">  edge[tot].to = v;</span><br><span class="line">  edge[tot].next = head[u];</span><br><span class="line">  head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pre,<span class="keyword">int</span> dep)</span></span><br><span class="line"></span>{</span><br><span class="line">  F[++cnt] = u;</span><br><span class="line">  rmq[cnt] = dep;</span><br><span class="line">  P[u] = cnt;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];i != -<span class="number">1</span>;i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>(v == pre)<span class="keyword">continue</span>;</span><br><span class="line">    dfs(v,u,dep+<span class="number">1</span>);</span><br><span class="line">    F[++cnt] = u;</span><br><span class="line">    rmq[cnt] = dep;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCA_init</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> node_num)</span><span class="comment">//查询LCA前的初始化</span></span><br><span class="line"></span>{</span><br><span class="line">  cnt = <span class="number">0</span>;</span><br><span class="line">  dfs(root,root,<span class="number">0</span>);</span><br><span class="line">  st.init(<span class="number">2</span>*node_num-<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_lca</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span><span class="comment">//查询u,v的lca编号</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> F[st.query(P[u],P[v])];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_build</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pre)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> pos = hash(a[u]);</span><br><span class="line">  T[u] = update(T[pre],pos,<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u]; i != -<span class="number">1</span>;i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>(v == pre)<span class="keyword">continue</span>;</span><br><span class="line">    dfs_build(v,u);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q) == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">    Init_hash();</span><br><span class="line">    init();</span><br><span class="line">    TOT = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> u,v;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">      addedge(u,v);</span><br><span class="line">      addedge(v,u);</span><br><span class="line">    }</span><br><span class="line">    LCA_init(<span class="number">1</span>,n);</span><br><span class="line">    T[n+<span class="number">1</span>] = build(<span class="number">1</span>,m);</span><br><span class="line">    dfs_build(<span class="number">1</span>,n+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">while</span>(q--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;u,&amp;v,&amp;k);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,t[query(T[u],T[v],query_lca(u,v),k)]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 6.4 动态第 k大 ZOJ 2112</span></span><br><span class="line"><span class="comment">// 树状数组套主席树</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">60010</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2500010</span>;</span><br><span class="line"><span class="keyword">int</span> n,q,m,tot;</span><br><span class="line"><span class="keyword">int</span> a[MAXN], t[MAXN];</span><br><span class="line"><span class="keyword">int</span> T[MAXN], lson[M], rson[M],c[M];</span><br><span class="line"><span class="keyword">int</span> S[MAXN];</span><br><span class="line"><span class="keyword">struct</span> Query</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> kind;</span><br><span class="line">  <span class="keyword">int</span> l,r,k;</span><br><span class="line">}query[<span class="number">10010</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init_hash</span><span class="params">(<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  sort(t,t+k);</span><br><span class="line">  m = unique(t,t+k) - t;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> lower_bound(t,t+m,x)-t;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> root = tot++;</span><br><span class="line">  c[root] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(l != r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line">    lson[root] = build(l,mid);</span><br><span class="line">    rson[root] = build(mid+<span class="number">1</span>,r);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> root;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> root,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> newroot = tot++, tmp = newroot;</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">0</span>, r = m-<span class="number">1</span>;</span><br><span class="line">  c[newroot] = c[root] + val;</span><br><span class="line">  <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid)</span><br><span class="line">    {</span><br><span class="line">      lson[newroot] = tot++; rson[newroot] = rson[root];</span><br><span class="line">      newroot = lson[newroot]; root = lson[root];</span><br><span class="line">      r = mid;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      rson[newroot] = tot++; lson[newroot] = lson[root];</span><br><span class="line">      newroot = rson[newroot]; root = rson[root];</span><br><span class="line">      l = mid+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    c[newroot] = c[root] + val;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> tmp;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> use[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(x &lt;= n)</span><br><span class="line">  {</span><br><span class="line">    S[x] = Insert(S[x],pos,val);</span><br><span class="line">    x += lowbit(x);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(x &gt; <span class="number">0</span>)</span><br><span class="line">  {</span><br><span class="line">    ret += c[lson[use[x]]];</span><br><span class="line">    x -= lowbit(x);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Query</span><span class="params">(<span class="keyword">int</span> left,<span class="keyword">int</span> right,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> left_root = T[left-<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">int</span> right_root = T[right];</span><br><span class="line">  <span class="keyword">int</span> l = <span class="number">0</span>, r = m-<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = left-<span class="number">1</span>;i;i -= lowbit(i)) use[i] = S[i];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = right;i ;i -= lowbit(i)) use[i] = S[i];</span><br><span class="line">  <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp = sum(right) - sum(left-<span class="number">1</span>) + c[lson[right_root]] - c[lson[left_root]];</span><br><span class="line">    <span class="keyword">if</span>(tmp &gt;= k)</span><br><span class="line">    {</span><br><span class="line">      r = mid;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = left-<span class="number">1</span>; i ;i -= lowbit(i))</span><br><span class="line">        use[i] = lson[use[i]];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = right; i; i -= lowbit(i))</span><br><span class="line">        use[i] = lson[use[i]];</span><br><span class="line">      left_root = lson[left_root];</span><br><span class="line">      right_root = lson[right_root];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      l = mid+<span class="number">1</span>;</span><br><span class="line">      k -= tmp;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = left-<span class="number">1</span>; i;i -= lowbit(i))</span><br><span class="line">        use[i] = rson[use[i]];</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = right;i ;i -= lowbit(i))</span><br><span class="line">        use[i] = rson[use[i]];</span><br><span class="line">      left_root = rson[left_root];</span><br><span class="line">      right_root = rson[right_root];</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> l;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Modify</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> p,<span class="keyword">int</span> d)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(x &lt;= n)</span><br><span class="line">  {</span><br><span class="line">    S[x] = Insert(S[x],p,d);</span><br><span class="line">    x += lowbit(x);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> Tcase;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;Tcase);</span><br><span class="line">  <span class="keyword">while</span>(Tcase--)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">    m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">      t[m++] = a[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; q;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line">      <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'Q'</span>)</span><br><span class="line">      {</span><br><span class="line">        query[i].kind = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;query[i].l,&amp;query[i].r,&amp;query[i].k);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        query[i].kind = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;query[i].l,&amp;query[i].r);</span><br><span class="line">        t[m++] = query[i].r;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    Init_hash(m);</span><br><span class="line">    T[<span class="number">0</span>] = build(<span class="number">0</span>,m-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">      T[i] = Insert(T[i-<span class="number">1</span>],hash(a[i]),<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">      S[i] = T[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; q;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(query[i].kind == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,t[Query(query[i].l,query[i].r,query[i].k)]);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        Modify(query[i].l,hash(a[query[i].l]),-<span class="number">1</span>);</span><br><span class="line">        Modify(query[i].l,hash(query[i].r),<span class="number">1</span>);</span><br><span class="line">        a[query[i].l] = query[i].r;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="稀疏表">稀疏表</h3><figure class="highlight cpp"><figcaption><span>sparse.h</span><a href="/code/Template/sparse.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Sparse Table 稀疏表</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"><span class="preprocessor">#ifndef SPARSE_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SPARSE_H_ 20151124L</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="keyword">size_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef CSL_ALGO_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> message("need : csl_algo.h");</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;csl_algo.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="keyword">size_t</span>&gt; msb(<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">msb_build</span><span class="params">(<span class="built_in">std</span>::size_t p_data)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="keyword">size_t</span> i = msb.size(), t = msb[i - <span class="number">1</span>]; i &lt;= p_data; ++i)</span><br><span class="line">      msb.push_back(t += !(i &amp; (i - <span class="number">1</span>)));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> F = csl::min&lt;T&gt;&gt;</span><br><span class="line">  <span class="keyword">class</span> <span class="keyword">sparse_t</span>able {</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">sparse_t</span>able() :</span><br><span class="line">        data(), func() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>{</span><br><span class="line">      data.clear();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> size_t <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> data.empty() ? <span class="number">0</span> : data.at(<span class="number">0</span>).size();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> T <span class="title">query</span><span class="params">(size_t first, size_t last)</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">size_t</span> k = csl::msb[last-first+<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">return</span> func(data[k][first], data[k][last+<span class="number">1</span>-(<span class="number">1</span>&lt;&lt;k)]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(T* s, size_t n)</span> </span>{</span><br><span class="line">      msb_build(n), data.clear();</span><br><span class="line">      data.push_back(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;(s, s+n));</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span> k = <span class="number">1</span>, d = <span class="number">2</span>, t = <span class="number">1</span>; d &lt;= n; ++k, d &lt;&lt;= <span class="number">1</span>, t &lt;&lt;= <span class="number">1</span>) {</span><br><span class="line">        data.push_back(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;(n-d+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>, j = n+<span class="number">1</span>-d; i &lt; j; ++i)</span><br><span class="line">          data[k][i] = func(data[k-<span class="number">1</span>][i], data[k-<span class="number">1</span>][i+t]);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt;&gt; data;</span><br><span class="line">    <span class="keyword">const</span> F func;</span><br><span class="line">  };</span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* SPARSE_H_ */</span></span><br></pre></td></tr></table></figure>
<h2 id="字符串">字符串</h2><h3 id="後綴數組">後綴數組</h3><figure class="highlight cpp"><figcaption><span>sais.cpp</span><a href="/code/scl/sais.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span>&lt;string.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAGIC(XD){\</span><br><span class="line">    memset(sa,0,sizeof(int)*n);\</span><br><span class="line">    memcpy(x,c,sizeof(int)*z);\</span><br><span class="line">    XD\</span><br><span class="line">    memcpy(x+1,c,sizeof(int)*(z-1));\</span><br><span class="line">    for(i=0;i&lt;n;++i){\</span><br><span class="line">        <span class="keyword">if</span>(sa[i]&amp;&amp;!t[sa[i]-1])sa[x[s[sa[i]-1]]++]=sa[i]-1;\</span><br><span class="line">    }\</span><br><span class="line">    memcpy(x,c,sizeof(int)*z);\</span><br><span class="line">    for(i=n-1;i&gt;=0;--i){\</span><br><span class="line">        <span class="keyword">if</span>(sa[i]&amp;&amp;t[sa[i]-1])sa[--x[s[sa[i]-1]]]=sa[i]-1;\</span><br><span class="line">    }\</span><br><span class="line">}</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sais</span><span class="params">(<span class="keyword">int</span> *s,<span class="keyword">int</span> *sa,<span class="keyword">int</span> *p,<span class="keyword">bool</span> *t,<span class="keyword">int</span> *c,<span class="keyword">int</span> n,<span class="keyword">int</span> z)</span></span>{</span><br><span class="line">    <span class="keyword">bool</span> neq=t[n-<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> nn=<span class="number">0</span>,nmxz=-<span class="number">1</span>,*q=sa+n,*ns=s+n,*x=c+z,lst=-<span class="number">1</span>,i,j;</span><br><span class="line">    <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*z);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;++i)++c[s[i]];</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;z-<span class="number">1</span>;++i)c[i+<span class="number">1</span>]+=c[i];</span><br><span class="line">    <span class="keyword">for</span>(i=n-<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)t[i]=(s[i]==s[i+<span class="number">1</span>]?t[i+<span class="number">1</span>]:s[i]&lt;s[i+<span class="number">1</span>]);</span><br><span class="line">    MAGIC(</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;n;++i){</span><br><span class="line">            <span class="keyword">if</span>(t[i]&amp;&amp;!t[i-<span class="number">1</span>])sa[--x[s[i]]]=p[q[i]=nn++]=i;</span><br><span class="line">        }</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;++i)<span class="keyword">if</span>((j=sa[i])&amp;&amp;t[j]&amp;&amp;!t[j-<span class="number">1</span>]){</span><br><span class="line">        neq=lst&lt;<span class="number">0</span>||<span class="built_in">memcmp</span>(s+j,s+lst,(p[q[j]+<span class="number">1</span>]-j)*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        ns[q[lst=j]]=nmxz+=neq;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(nmxz==nn-<span class="number">1</span>)<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nn;++i)q[ns[i]]=i;</span><br><span class="line">    <span class="keyword">else</span> sais(ns,q,p+nn,t+n,c+z,nn,nmxz+<span class="number">1</span>);</span><br><span class="line">    MAGIC(</span><br><span class="line">        <span class="keyword">for</span>(i=nn-<span class="number">1</span>;i&gt;=<span class="number">0</span>;--i)sa[--x[s[p[q[i]]]]]=p[q[i]];</span><br><span class="line">    );</span><br><span class="line">}</span><br><span class="line"><span class="preprocessor">#<span class="keyword">undef</span> MAGIC</span></span><br><span class="line"><span class="comment">/*****************這些是需要用到的陣列大小**************/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> MXN=<span class="number">10000000</span>;</span><br><span class="line"><span class="keyword">int</span> s[MXN*<span class="number">2</span>+<span class="number">5</span>],sa[MXN*<span class="number">2</span>+<span class="number">5</span>],p[MXN+<span class="number">5</span>],c[MXN*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> t[MXN*<span class="number">2</span>+<span class="number">5</span>];</span><br></pre></td></tr></table></figure>
<h3 id="AC自動機">AC自動機</h3><figure class="highlight cpp"><figcaption><span>ac.cpp</span><a href="/code/scl/ac.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span>&lt;queue&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span>&lt;vector&gt;</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">char</span> L=<span class="string">'a'</span>,<span class="keyword">char</span> R=<span class="string">'z'</span>&gt;</span><br><span class="line"><span class="keyword">class</span> ac_automaton{</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">struct</span> joe{</span><br><span class="line">            <span class="keyword">int</span> next[R-L+<span class="number">1</span>],fail,cnt;</span><br><span class="line">            joe():fail(-<span class="number">1</span>),cnt(<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=R-L;++i)next[i]=<span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;joe&gt; S;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        ac_automaton():S(<span class="number">1</span>){}<span class="comment">/*root為0*/</span></span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>{</span><br><span class="line">            S.resize(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=R-L;++i)S[<span class="number">0</span>].next[i]=<span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>{</span><br><span class="line">            <span class="keyword">int</span> o=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,id;s[i];++i){</span><br><span class="line">                id=s[i]-L;</span><br><span class="line">                <span class="keyword">if</span>(!S[o].next[id]){</span><br><span class="line">                    S.push_back(joe());</span><br><span class="line">                    S[o].next[id]=S.size()-<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">                o=S[o].next[id];</span><br><span class="line">            }</span><br><span class="line">            ++S[o].cnt;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span>{</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;<span class="keyword">int</span> &gt; q;</span><br><span class="line">            q.push(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">while</span>(q.size()){</span><br><span class="line">                <span class="keyword">int</span> pa=q.front(),id;</span><br><span class="line">                q.pop();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=R-L;++i){</span><br><span class="line">                    <span class="keyword">if</span>(!S[pa].next[i])<span class="keyword">continue</span>;</span><br><span class="line">                    id=S[pa].fail;</span><br><span class="line">                    <span class="keyword">while</span>(~id&amp;&amp;!S[id].next[i])id=S[id].fail;</span><br><span class="line">                    S[S[pa].next[i]].fail=~id?S[id].next[i]:<span class="number">0</span>;</span><br><span class="line">                    q.push(S[pa].next[i]);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/*傳回所有字串被匹配成功的次數*/</span></span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>{</span><br><span class="line">            <span class="keyword">int</span> ans=<span class="number">0</span>,id,p=<span class="number">0</span>,t;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];++i){</span><br><span class="line">                id=s[i]-L;</span><br><span class="line">                <span class="keyword">while</span>(!S[p].next[id]&amp;&amp;p)p=S[p].fail;</span><br><span class="line">                <span class="keyword">if</span>(!S[p].next[id])<span class="keyword">continue</span>;</span><br><span class="line">                t=p=S[p].next[id];</span><br><span class="line">                <span class="keyword">while</span>(t){</span><br><span class="line">                    ans+=S[t].cnt;<span class="comment">/*如果cnt&gt;0則匹配成功*/</span> </span><br><span class="line">                    t=S[t].fail;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<h3 id="擴展KMP算法">擴展KMP算法</h3><figure class="highlight cpp"><figcaption><span>kmp-plus.cpp</span><a href="/code/scl/kmp-plus.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * 扩展KMP算法</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">//next[i]:x[i...m-1]与x[0...m-1]的最长公共前缀</span></span><br><span class="line"><span class="comment">//extend[i]:y[i...n-1]与x[0...m-1]的最长公共前缀</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre_EKMP</span><span class="params">(<span class="keyword">char</span> x[],<span class="keyword">int</span> m,<span class="keyword">int</span> next[])</span></span><br><span class="line"></span>{</span><br><span class="line">  next[<span class="number">0</span>]=m;</span><br><span class="line">  <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(j+<span class="number">1</span>&lt;m &amp;&amp; x[j]==x[j+<span class="number">1</span>])j++;</span><br><span class="line">  next[<span class="number">1</span>]=j;</span><br><span class="line">  <span class="keyword">int</span> k=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;m;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> p=next[k]+k-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> L=next[i-k];</span><br><span class="line">    <span class="keyword">if</span>(i+L&lt;p+<span class="number">1</span>)next[i]=L;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      j=max(<span class="number">0</span>,p-i+<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">while</span>(i+j&lt;m &amp;&amp; x[i+j]==x[j])j++;</span><br><span class="line">      next[i]=j;</span><br><span class="line">      k=i;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EKMP</span><span class="params">(<span class="keyword">char</span> x[],<span class="keyword">int</span> m,<span class="keyword">char</span> y[],<span class="keyword">int</span> n,<span class="keyword">int</span> next[],<span class="keyword">int</span> extend[])</span></span><br><span class="line"></span>{</span><br><span class="line">  pre_EKMP(x,m,next);</span><br><span class="line">  <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(j&lt;n &amp;&amp; j&lt;m &amp;&amp; x[j]==y[j])j++;</span><br><span class="line">  extend[<span class="number">0</span>]=j;</span><br><span class="line">  <span class="keyword">int</span> k=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> p=extend[k]+k-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> L=next[i-k];</span><br><span class="line">    <span class="keyword">if</span>(i+L&lt;p+<span class="number">1</span>)extend[i]=L;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      j=max(<span class="number">0</span>,p-i+<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">while</span>(i+j&lt;n &amp;&amp; j&lt;m &amp;&amp; y[i+j]==x[j])j++;</span><br><span class="line">      extend[i]=j;</span><br><span class="line">      k=i;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="馬拉車算法">馬拉車算法</h3><figure class="highlight cpp"><figcaption><span>manacher.h</span><a href="/code/Template/manacher.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Manacher Algorithm 马拉车算法</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef MANACHER_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MANACHER_H_ 20150814L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp = <span class="keyword">char</span>,_Tp _FlagS = <span class="string">'@'</span>,_Tp _FlagD = <span class="string">'#'</span>,_Tp _FlagT =</span><br><span class="line">      <span class="string">'\0'</span>&gt;</span><br><span class="line">  <span class="keyword">struct</span> manacher {</span><br><span class="line">    <span class="comment">// template parameter.</span></span><br><span class="line">    <span class="keyword">typedef</span> _Tp <span class="keyword">key_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">value_t</span>ype;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="keyword">size_t</span>ype;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">generate</span><span class="params">(<span class="keyword">const</span> key_type* __src)</span> </span>{</span><br><span class="line">      m_dest.clear();</span><br><span class="line">      m_dest.push_back(_FlagS), m_dest.push_back(_FlagD);</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; __src[i] != _FlagT; i++)</span><br><span class="line">        m_dest.push_back(__src[i]), m_dest.push_back(_FlagD);</span><br><span class="line">      m_dest.push_back(_FlagT);</span><br><span class="line">      m_size = m_dest.size();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calculate</span><span class="params">()</span> </span>{</span><br><span class="line">      m_data.resize(m_size);</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>, p = <span class="number">0</span>; i &lt; m_size; ++i) {</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">int</span> k = (p &gt; i) ? <span class="built_in">std</span>::min(m_data[<span class="number">2</span> * j - i], p - i) : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(m_dest[i + k] == m_dest[i - k])</span><br><span class="line">          ++k;</span><br><span class="line">        <span class="keyword">if</span>(k + i &gt; p) p = k + i, j = i;</span><br><span class="line">        m_data[i] = k;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// capacity.</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">const</span> key_type* __src)</span> </span>{</span><br><span class="line">      generate(__src);</span><br><span class="line">      calculate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span><span class="function">ype <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> m_size - <span class="number">4</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// element access.</span></span><br><span class="line">    <span class="keyword">value_t</span><span class="function">ype <span class="title">query</span><span class="params">()</span> <span class="keyword">const</span> </span>{</span><br><span class="line">      <span class="keyword">value_t</span>ype __res = <span class="keyword">value_t</span>ype();</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">size_t</span>ype i = <span class="number">0</span>; i &lt; m_size; ++i)</span><br><span class="line">        <span class="keyword">if</span>(m_data[i] &gt; __res) __res = m_data[i];</span><br><span class="line">      <span class="keyword">return</span> __res - <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">value_t</span><span class="function">ype <span class="title">at</span><span class="params">(size_type __x)</span> </span>{</span><br><span class="line">      <span class="keyword">return</span> __x + <span class="number">2</span> &lt; m_size ? <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>[](__x) : <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">value_t</span>ype <span class="keyword">operator</span> [](<span class="keyword">size_t</span>ype __x) <span class="keyword">const</span> {</span><br><span class="line">      <span class="keyword">return</span> m_data[__x + <span class="number">2</span>] - <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// member variable.</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">key_t</span>ype&gt; m_dest;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">value_t</span>ype&gt; m_data;</span><br><span class="line">    <span class="keyword">size_t</span>ype m_size;</span><br><span class="line"></span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* MANACHER_H_ */</span></span><br></pre></td></tr></table></figure>
<h2 id="計算幾何">計算幾何</h2><h3 id="類">類</h3><figure class="highlight cpp"><figcaption><span>geometry.h</span><a href="/code/Template/geometry.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Computational Geometry 计算几何</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef GEOMETRY_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> GEOMETRY_H_ 20160331L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef CSL_ALGO_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> message("need : csl_algo.h");</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;csl_algo.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> *  20150821L</span><br><span class="line"> *</span><br><span class="line"> *  static double M_EPS = 1e-8;</span><br><span class="line"> *    判断浮点是否相等时的精度控制</span><br><span class="line"> *</span><br><span class="line"> *  sgn(double __x) : int</span><br><span class="line"> *    判断浮点的符号</span><br><span class="line"> *    -1为负数, 0为零, 1为正数</span><br><span class="line"> *</span><br><span class="line"> *  cmp(double a, double b) : int</span><br><span class="line"> *    判断两个浮点的大小关系</span><br><span class="line"> *    -1为小于, 0为等于, 1为大于</span><br><span class="line"> *</span><br><span class="line"> *  struct point</span><br><span class="line"> *</span><br><span class="line"> *  成员变量：</span><br><span class="line"> *  x : double</span><br><span class="line"> *    横坐标</span><br><span class="line"> *  y : double</span><br><span class="line"> *    纵坐标</span><br><span class="line"> *</span><br><span class="line"> *  运算符重载：</span><br><span class="line"> *  operator - (const point&amp; a, const point&amp; b) : point</span><br><span class="line"> *    点a 到 点b 的向量</span><br><span class="line"> *  operator * (const point&amp; a, const point&amp; b) : double</span><br><span class="line"> *    向量a 与 向量b 的点积(数量积)</span><br><span class="line"> *  operator ^ (const point&amp; a, const point&amp; b) : double</span><br><span class="line"> *    向量a 与 向量b 的叉积(矢量积)</span><br><span class="line"> *  operator &lt; (const point&amp; a, const point&amp; b) : bool</span><br><span class="line"> *    点a 与 点b 的大小关系</span><br><span class="line"> *</span><br><span class="line"> *  rotate(const point&amp; p, double r) : point</span><br><span class="line"> *    点p 以原点为中心旋转 r 弧度</span><br><span class="line"> *</span><br><span class="line"> *  dist(const point&amp; a, const point&amp; b) : double</span><br><span class="line"> *    点a 到 点b 的距离</span><br><span class="line"> *</span><br><span class="line"> *  struct line</span><br><span class="line"> *</span><br><span class="line"> *  成员变量：</span><br><span class="line"> *  s : point</span><br><span class="line"> *    起点</span><br><span class="line"> *  e : point</span><br><span class="line"> *    终点</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="comment">// 点</span></span><br><span class="line">  <span class="keyword">struct</span> point {</span><br><span class="line">    point(<span class="keyword">double</span> __x = <span class="number">0</span>, <span class="keyword">double</span> __y = <span class="number">0</span>) :</span><br><span class="line">        x(__x), y(__y) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  point <span class="keyword">operator</span> - (<span class="keyword">const</span> point&amp; a,<span class="keyword">const</span> point&amp; b) {</span><br><span class="line">    <span class="keyword">return</span> point(a.x - b.x, a.y - b.y);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> ^ (<span class="keyword">const</span> point&amp; a,<span class="keyword">const</span> point&amp; b) {</span><br><span class="line">    <span class="keyword">return</span> a.x * b.y - a.y * b.x;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> * (<span class="keyword">const</span> point&amp; a,<span class="keyword">const</span> point&amp; b) {</span><br><span class="line">    <span class="keyword">return</span> a.x * b.x + a.y * b.y;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> point&amp; a,<span class="keyword">const</span> point&amp; b) {</span><br><span class="line">    <span class="keyword">return</span> sgn(a.x - b.x) ? a.x &lt; b.x : a.y &lt; b.y;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 点绕原点旋转</span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> point <span class="title">rotate</span><span class="params">(<span class="keyword">const</span> point&amp; p,<span class="keyword">double</span> r)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> point(p.x * <span class="built_in">cos</span>(r) - p.y * <span class="built_in">sin</span>(r), p.x * <span class="built_in">sin</span>(r) + p.y * <span class="built_in">cos</span>(r));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 两点间距离</span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">dist</span><span class="params">(<span class="keyword">const</span> point&amp; a,<span class="keyword">const</span> point&amp; b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>((a - b) * (a - b));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 直线 / 线段</span></span><br><span class="line">  <span class="keyword">struct</span> line {</span><br><span class="line">    line() :</span><br><span class="line">        s(), e() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    line(point __s,point __e) :</span><br><span class="line">        s(__s), e(__e) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    point s;</span><br><span class="line">    point e;</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断直线与直线相交</span></span><br><span class="line">  <span class="comment">//@ 0为重合,1为平行,2为相交;2时有交点.</span></span><br><span class="line">  <span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>,point&gt; <span class="keyword">operator</span> &amp;(<span class="keyword">const</span> line&amp; a,<span class="keyword">const</span> line&amp; b) {</span><br><span class="line">    <span class="keyword">if</span>(sgn((a.s - a.e) ^ (b.s - b.e)) == <span class="number">0</span>) {</span><br><span class="line">      <span class="keyword">if</span>(sgn((a.s - b.e) ^ (b.s - b.e)) == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">std</span>::make_pair(<span class="number">0</span>, point());</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">std</span>::make_pair(<span class="number">1</span>, point());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">double</span> t = ((a.s - b.s) ^ (b.s - b.e)) / ((a.s - a.e) ^ (b.s - b.e));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::make_pair(<span class="number">2</span>,</span><br><span class="line">        point(a.s.x + (a.e.x - a.s.x) * t, a.s.y + (a.e.y - a.s.y) * t));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断线段与线段相交</span></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">inter_ss</span><span class="params">(<span class="keyword">const</span> line&amp; a,<span class="keyword">const</span> line&amp; b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::max(a.s.x, a.e.x) &gt;= <span class="built_in">std</span>::min(b.s.x, b.e.x)</span><br><span class="line">        &amp;&amp; <span class="built_in">std</span>::max(b.s.x, b.e.x) &gt;= <span class="built_in">std</span>::min(a.s.x, a.e.x)</span><br><span class="line">        &amp;&amp; <span class="built_in">std</span>::max(a.s.y, a.e.y) &gt;= <span class="built_in">std</span>::min(b.s.y, b.e.y)</span><br><span class="line">        &amp;&amp; <span class="built_in">std</span>::max(b.s.y, b.e.y) &gt;= <span class="built_in">std</span>::min(a.s.y, a.e.y)</span><br><span class="line">        &amp;&amp; sgn((b.s - a.e) ^ (a.s - a.e)) * sgn((b.e - a.e) ^ (a.s - a.e)) &lt;= <span class="number">0</span></span><br><span class="line">        &amp;&amp; sgn((a.s - b.e) ^ (b.s - b.e)) * sgn((a.e - b.e) ^ (b.s - b.e)) &lt;= <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断直线和线段相交</span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">inter_ls</span><span class="params">(<span class="keyword">const</span> line&amp; a,<span class="keyword">const</span> line&amp; b)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> sgn((b.s - a.e) ^ (a.s - a.e)) * sgn((b.e - a.e) ^ (a.s - a.e)) &lt;= <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 点到直线最近的点</span></span><br><span class="line">  <span class="function">point <span class="title">p2line</span><span class="params">(<span class="keyword">const</span> point&amp; p,<span class="keyword">const</span> line&amp; l)</span> </span>{</span><br><span class="line">    <span class="keyword">double</span> t = ((p - l.s) * (l.e - l.s)) / ((l.e - l.s) * (l.e - l.s));</span><br><span class="line">    <span class="keyword">return</span> point(l.s.x + (l.e.x - l.s.x) * t, l.s.y + (l.e.y - l.s.y) * t);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 点到线段最近的点</span></span><br><span class="line">  <span class="function">point <span class="title">p2seg</span><span class="params">(<span class="keyword">const</span> point&amp; p,<span class="keyword">const</span> line&amp; l)</span> </span>{</span><br><span class="line">    <span class="keyword">double</span> t = ((p - l.s) * (l.e - l.s)) / ((l.e - l.s) * (l.e - l.s));</span><br><span class="line">    <span class="keyword">if</span>(t &gt;= <span class="number">0</span> &amp;&amp; t &lt;= <span class="number">1</span>) <span class="keyword">return</span> point(l.s.x + (l.e.x - l.s.x) * t,</span><br><span class="line">        l.s.y + (l.e.y - l.s.y) * t);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> dist(p, l.s) &lt; dist(p, l.e) ? l.s : l.e;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 计算多边形面积</span></span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">ploy_area</span><span class="params">(<span class="keyword">const</span> point p[],<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">double</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">      res += (p[i] ^ p[(i + <span class="number">1</span>) % n]) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(res);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断点在线段上</span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">ponseg</span><span class="params">(<span class="keyword">const</span> point&amp; p,<span class="keyword">const</span> line&amp; l)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> sgn((l.s - p) ^ (l.e - p)) == <span class="number">0</span></span><br><span class="line">        &amp;&amp; sgn((p.x - l.s.x) * (p.x - l.e.x)) &lt;= <span class="number">0</span></span><br><span class="line">        &amp;&amp; sgn((p.y - l.s.y) * (p.y - l.e.y)) &lt;= <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断点与凸多边形关系</span></span><br><span class="line">  <span class="comment">//@ 逆时针凸包;如果是顺时针,&lt;0改&gt;0</span></span><br><span class="line">  <span class="comment">//@ -1为外,0为上,1为内</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">pincploy</span><span class="params">(point x,<span class="keyword">const</span> point p[],<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">      <span class="keyword">if</span>(sgn((p[i] - x) ^ (p[(i + <span class="number">1</span>) % n] - x)) &lt; <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span>(ponseg(x, line(p[i], p[(i + <span class="number">1</span>) % n]))) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断点与任意多边形关系</span></span><br><span class="line">  <span class="comment">//@ -1为外,0为上,1为内</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">pinploy</span><span class="params">(point x,<span class="keyword">const</span> point p[],<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="function">line <span class="title">ray</span><span class="params">(x, point(x.y, -1e11)</span>)</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">      line side = line(p[i], p[(i + <span class="number">1</span>) % n]);</span><br><span class="line">      <span class="keyword">if</span>(ponseg(x, side)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//如果平行轴则不考虑</span></span><br><span class="line">      <span class="keyword">if</span>(sgn(side.s.y - side.e.y) == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">if</span>(ponseg(side.s, ray)) {</span><br><span class="line">        <span class="keyword">if</span>(sgn(side.s.y - side.e.y) &gt; <span class="number">0</span>) cnt++;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(ponseg(side.e, ray)) {</span><br><span class="line">        <span class="keyword">if</span>(sgn(side.e.y - side.s.y) &gt; <span class="number">0</span>) cnt++;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(inter_ss(ray, side)) cnt++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> cnt &amp; <span class="number">1</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//@ 判断凸多边形</span></span><br><span class="line">  <span class="comment">//@ 允许共线边;点可顺可逆</span></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">iscpoly</span><span class="params">(<span class="keyword">const</span> point p[],<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">bool</span> s[<span class="number">3</span>] = {<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>};</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">      s[sgn((p[(i + <span class="number">1</span>) % n] - p[i]) ^ (p[(i + <span class="number">2</span>) % n] - p[i])) + <span class="number">1</span>] = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">if</span>(s[<span class="number">0</span>] &amp;&amp; s[<span class="number">2</span>]) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> point graham_T;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">graham_cmp</span><span class="params">(point p1,point p2)</span> </span>{</span><br><span class="line">    <span class="keyword">double</span> tmp = (p1 - graham_T) ^ (p2 - graham_T);</span><br><span class="line">    <span class="keyword">if</span>(sgn(tmp) &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(sgn(tmp) == <span class="number">0</span> &amp;&amp; sgn(dist(p1, graham_T) - dist(p2, graham_T)) &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;point&gt; graham(<span class="keyword">const</span> point p[],<span class="keyword">int</span> n) {</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;point&gt; res(p, p + n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = res.size() - <span class="number">1</span>; i; --i)</span><br><span class="line">      <span class="keyword">if</span>(res[<span class="number">0</span>] &lt; res[i]) <span class="built_in">std</span>::swap(res[<span class="number">0</span>], res[i]);</span><br><span class="line">    graham_T = res[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">std</span>::sort(res.begin() + <span class="number">1</span>, res.end(), graham_cmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; n; ++i) {</span><br><span class="line">      <span class="keyword">while</span>(m &gt; <span class="number">1</span> &amp;&amp; sgn((res[m - <span class="number">1</span>] - res[m - <span class="number">2</span>]) ^ (res[i] - res[m - <span class="number">2</span>])) &lt;= <span class="number">0</span>)</span><br><span class="line">        --m;</span><br><span class="line">      res[m++] = res[i];</span><br><span class="line">    }</span><br><span class="line">    res.resize(m);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">bound_rect</span><span class="params">(<span class="keyword">const</span> point p[],<span class="keyword">int</span> n)</span> </span>{</span><br><span class="line">    <span class="keyword">double</span> res = <span class="number">1e30</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) {</span><br><span class="line">      point p1 = p[i + <span class="number">1</span>] - p[i];</span><br><span class="line">      <span class="keyword">double</span> min1 = <span class="number">1e30</span>, max1 = -<span class="number">1e30</span>;</span><br><span class="line">      <span class="keyword">double</span> min2 = <span class="number">1e30</span>, max2 = -<span class="number">1e30</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) {</span><br><span class="line">        point p2 = p[j];</span><br><span class="line">        <span class="keyword">double</span> tmp1 = +(p1 ^ p2);</span><br><span class="line">        <span class="keyword">double</span> tmp2 = -(p1 * p2);</span><br><span class="line">        <span class="keyword">if</span>(min1 &gt; tmp1) min1 = tmp1;</span><br><span class="line">        <span class="keyword">if</span>(max1 &lt; tmp1) max1 = tmp1;</span><br><span class="line">        <span class="keyword">if</span>(min2 &gt; tmp2) min2 = tmp2;</span><br><span class="line">        <span class="keyword">if</span>(max2 &lt; tmp2) max2 = tmp2;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">double</span> tmp = (max1 - min1) * (max2 - min2) / (p1.x * p1.x + p1.y * p1.y);</span><br><span class="line">      <span class="keyword">if</span>(res &gt; tmp) res = tmp;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* GEOMETRY_H_ */</span></span><br></pre></td></tr></table></figure>
<h3 id="題">題</h3><figure class="highlight cpp"><figcaption><span>geometry.cpp</span><a href="/code/scl/geometry.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.1 半平面交</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(-<span class="number">1.0</span>);</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">fabs</span>(x) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(x &lt; <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> Point</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">double</span> x,y;</span><br><span class="line">  Point(){}</span><br><span class="line">  Point(<span class="keyword">double</span> _x,<span class="keyword">double</span> _y)</span><br><span class="line">  {</span><br><span class="line">    x = _x; y = _y;</span><br><span class="line">  }</span><br><span class="line">  Point <span class="keyword">operator</span> -(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> Point(x - b.x, y - b.y);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> ^(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.y - y*b.x;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> *(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.x + y*b.y;</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="keyword">struct</span> Line</span><br><span class="line">{</span><br><span class="line">  Point s,e;</span><br><span class="line">  <span class="keyword">double</span> k;</span><br><span class="line">  Line(){}</span><br><span class="line">  Line(Point _s,Point _e)</span><br><span class="line">  {</span><br><span class="line">    s = _s; e = _e;</span><br><span class="line">    k = <span class="built_in">atan2</span>(e.y - s.y,e.x - s.x);</span><br><span class="line">  }</span><br><span class="line">  Point <span class="keyword">operator</span> &amp;(<span class="keyword">const</span> Line &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    Point res = s;</span><br><span class="line">    <span class="keyword">double</span> t = ((s - b.s)^(b.s - b.e))/((s - e)^(b.s - b.e));</span><br><span class="line">    res.x += (e.x - s.x)*t;</span><br><span class="line">    res.y += (e.y - s.y)*t;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="comment">//半平面交，直线的左边代表有效区域</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">HPIcmp</span><span class="params">(Line a,Line b)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">fabs</span>(a.k - b.k) &gt; eps)<span class="keyword">return</span> a.k &lt; b.k;</span><br><span class="line">  <span class="keyword">return</span> ((a.s - b.s)^(b.e - b.s)) &lt; <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">Line Q[<span class="number">110</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HPI</span><span class="params">(Line line[], <span class="keyword">int</span> n, Point res[], <span class="keyword">int</span> &amp;resn)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> tot = n;</span><br><span class="line">  sort(line,line+n,HPIcmp);</span><br><span class="line">  tot = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(line[i].k - line[i-<span class="number">1</span>].k) &gt; eps)</span><br><span class="line">      line[tot++] = line[i];</span><br><span class="line">  <span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</span><br><span class="line">  Q[<span class="number">0</span>] = line[<span class="number">0</span>];</span><br><span class="line">  Q[<span class="number">1</span>] = line[<span class="number">1</span>];</span><br><span class="line">  resn = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; tot; i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>((Q[tail].e-Q[tail].s)^(Q[tail-<span class="number">1</span>].e-Q[tail-<span class="number">1</span>].s)) &lt; eps || <span class="built_in">fabs</span>((Q[head].e-Q[head].s)^(Q[head+<span class="number">1</span>].e-Q[head+<span class="number">1</span>].s)) &lt; eps)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">while</span>(head &lt; tail &amp;&amp; (((Q[tail]&amp;Q[tail-<span class="number">1</span>]) - line[i].s)^(line[i].e-line[i].s)) &gt; eps)</span><br><span class="line">      tail--;</span><br><span class="line">    <span class="keyword">while</span>(head &lt; tail &amp;&amp; (((Q[head]&amp;Q[head+<span class="number">1</span>]) - line[i].s)^(line[i].e-line[i].s)) &gt; eps)</span><br><span class="line">      head++;</span><br><span class="line">    Q[++tail] = line[i];</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">while</span>(head &lt; tail &amp;&amp; (((Q[tail]&amp;Q[tail-<span class="number">1</span>]) - Q[head].s)^(Q[head].e-Q[head].s)) &gt; eps)</span><br><span class="line">    tail--;</span><br><span class="line">  <span class="keyword">while</span>(head &lt; tail &amp;&amp; (((Q[head]&amp;Q[head-<span class="number">1</span>]) - Q[tail].s)^(Q[tail].e-Q[tail].e)) &gt; eps)</span><br><span class="line">    head++;</span><br><span class="line">  <span class="keyword">if</span>(tail &lt;= head + <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head; i &lt; tail; i++)</span><br><span class="line">    res[resn++] = Q[i]&amp;Q[i+<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span>(head &lt; tail - <span class="number">1</span>)</span><br><span class="line">    res[resn++] = Q[head]&amp;Q[tail];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.2 普通半平面交写法 POJ 1750</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-18</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">fabs</span>(x) &lt; eps)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(x &lt; <span class="number">0</span>)<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> Point</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">double</span> x,y;</span><br><span class="line">  Point(){}</span><br><span class="line">  Point(<span class="keyword">double</span> _x,<span class="keyword">double</span> _y)</span><br><span class="line">  {</span><br><span class="line">    x = _x; y = _y;</span><br><span class="line">  }</span><br><span class="line">  Point <span class="keyword">operator</span> -(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> Point(x - b.x, y - b.y);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> ^(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.y - y*b.x;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> *(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.x + y*b.y;</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="comment">//计算多边形面积</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">CalcArea</span><span class="params">(Point p[],<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">double</span> res = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    res += (p[i]^p[(i+<span class="number">1</span>)%n]);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">fabs</span>(res/<span class="number">2</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//通过两点，确定直线方程</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Get_equation</span><span class="params">(Point p1,Point p2,<span class="keyword">double</span> &amp;a,<span class="keyword">double</span> &amp;b,<span class="keyword">double</span> &amp;c)</span></span><br><span class="line"></span>{</span><br><span class="line">  a = p2.y - p1.y;</span><br><span class="line">  b = p1.x - p2.x;</span><br><span class="line">  c = p2.x*p1.y - p1.x*p2.y;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//求交点</span></span><br><span class="line"><span class="function">Point <span class="title">Intersection</span><span class="params">(Point p1,Point p2,<span class="keyword">double</span> a,<span class="keyword">double</span> b,<span class="keyword">double</span> c)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">double</span> u = <span class="built_in">fabs</span>(a*p1.x + b*p1.y + c);</span><br><span class="line">  <span class="keyword">double</span> v = <span class="built_in">fabs</span>(a*p2.x + b*p2.y + c);</span><br><span class="line">  Point t;</span><br><span class="line">  t.x = (p1.x*v + p2.x*u)/(u+v);</span><br><span class="line">  t.y = (p1.y*v + p2.y*u)/(u+v);</span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">}</span><br><span class="line">Point tp[<span class="number">110</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cut</span><span class="params">(<span class="keyword">double</span> a,<span class="keyword">double</span> b,<span class="keyword">double</span> c,Point p[],<span class="keyword">int</span> &amp;cnt)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= cnt;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="comment">//当前点在左侧，逆时针的点</span></span><br><span class="line">    <span class="keyword">if</span>(a*p[i].x + b*p[i].y + c &lt; eps)tp[++tmp] = p[i];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(a*p[i-<span class="number">1</span>].x + b*p[i-<span class="number">1</span>].y + c &lt; -eps)</span><br><span class="line">        tp[++tmp] = Intersection(p[i-<span class="number">1</span>],p[i],a,b,c);</span><br><span class="line">      <span class="keyword">if</span>(a*p[i+<span class="number">1</span>].x + b*p[i+<span class="number">1</span>].y + c &lt; -eps)</span><br><span class="line">        tp[++tmp] = Intersection(p[i],p[i+<span class="number">1</span>],a,b,c);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= tmp;i++)</span><br><span class="line">    p[i] = tp[i];</span><br><span class="line">  p[<span class="number">0</span>] = p[tmp];</span><br><span class="line">  p[tmp+<span class="number">1</span>] = p[<span class="number">1</span>];</span><br><span class="line">  cnt = tmp;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">double</span> V[<span class="number">110</span>],U[<span class="number">110</span>],W[<span class="number">110</span>];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> INF = <span class="number">100000000000.0</span>;</span><br><span class="line">Point p[<span class="number">110</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> id)</span></span><br><span class="line"></span>{</span><br><span class="line">  p[<span class="number">1</span>] = Point(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">  p[<span class="number">2</span>] = Point(INF,<span class="number">0</span>);</span><br><span class="line">  p[<span class="number">3</span>] = Point(INF,INF);</span><br><span class="line">  p[<span class="number">4</span>] = Point(<span class="number">0</span>,INF);</span><br><span class="line">  p[<span class="number">0</span>] = p[<span class="number">4</span>];</span><br><span class="line">  p[<span class="number">5</span>] = p[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">int</span> cnt = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    <span class="keyword">if</span>(i != id)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">double</span> a = (V[i] - V[id])/(V[i]*V[id]);</span><br><span class="line">      <span class="keyword">double</span> b = (U[i] - U[id])/(U[i]*U[id]);</span><br><span class="line">      <span class="keyword">double</span> c = (W[i] - W[id])/(W[i]*W[id]);</span><br><span class="line">      <span class="keyword">if</span>(sgn(a) == <span class="number">0</span> &amp;&amp; sgn(b) == <span class="number">0</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span>(sgn(c) &gt;= <span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">      }</span><br><span class="line">      Cut(a,b,c,p,cnt);</span><br><span class="line">    }</span><br><span class="line">  <span class="keyword">if</span>(sgn(CalcArea(p,cnt)) == <span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%lf%lf%lf"</span>,&amp;V[i],&amp;U[i],&amp;W[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(solve(i))<span class="built_in">printf</span>(<span class="string">"Yes\n"</span>);</span><br><span class="line">      <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"No\n"</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6、三点求圆心坐标（角形外）</span></span><br><span class="line"><span class="comment">// 过三点求圆心坐标</span></span><br><span class="line"><span class="function">Point <span class="title">waixin</span><span class="params">(Point a,Point b,Point c)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">double</span> a1 = b.x - a.x, b1 = b.y - a.y, c1 = (a1*a1 + b1*b1)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> a2 = c.x - a.x, b2 = c.y - a.y, c2 = (a2*a2 + b2*b2)/<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">double</span> d = a1*b2 - a2*b1;</span><br><span class="line">  <span class="keyword">return</span> Point(a.x + (c1*b2 - c2*b1)/d, a.y + (a1*c2 -a2*c1)/d);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7、求两圆相交的面积</span></span><br><span class="line"><span class="comment">// 两个圆的公共部分面积</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Area_of_overlap</span><span class="params">(Point c1,<span class="keyword">double</span> r1,Point c2,<span class="keyword">double</span> r2)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">double</span> d = dist(c1,c2);</span><br><span class="line">  <span class="keyword">if</span>(r1 + r2 &lt; d + eps)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(d &lt; <span class="built_in">fabs</span>(r1 - r2) + eps)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">double</span> r = min(r1,r2);</span><br><span class="line">    <span class="keyword">return</span> PI*r*r;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> x = (d*d + r1*r1 - r2*r2)/(<span class="number">2</span>*d);</span><br><span class="line">  <span class="keyword">double</span> t1 = <span class="built_in">acos</span>(x / r1);</span><br><span class="line">  <span class="keyword">double</span> t2 = <span class="built_in">acos</span>((d - x)/r2);</span><br><span class="line">  <span class="keyword">return</span> r1*r1*t1 + r2*r2*t2 - d*r1*<span class="built_in">sin</span>(t1);</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 8、PickPick Pick公式</span></span><br><span class="line"><span class="comment">// 顶点坐标均是整点的简单多边形：面积=内部格点数目+边上格点数目/2-1</span></span><br></pre></td></tr></table></figure>
<h3 id="旋轉卡殼">旋轉卡殼</h3><figure class="highlight cpp"><figcaption><span>rotate.cpp</span><a href="/code/scl/rotate.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.1 求解平面最远点对POJ 2187</span></span><br><span class="line"><span class="keyword">struct</span> Point</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> x,y;</span><br><span class="line">  Point(<span class="keyword">int</span> _x = <span class="number">0</span>,<span class="keyword">int</span> _y = <span class="number">0</span>)</span><br><span class="line">  {</span><br><span class="line">    x = _x; y = _y;</span><br><span class="line">  }</span><br><span class="line">  Point <span class="keyword">operator</span> -(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> Point(x - b.x, y - b.y);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">int</span> <span class="keyword">operator</span> ^(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.y - y*b.x;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">int</span> <span class="keyword">operator</span> *(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.x + y*b.y;</span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span><br><span class="line">  </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="comment">//距离的平方</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dist2</span><span class="params">(Point a,Point b)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> (a-b)*(a-b);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//******二维凸包，int***********</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">50010</span>;</span><br><span class="line">Point <span class="built_in">list</span>[MAXN];</span><br><span class="line"><span class="keyword">int</span> Stack[MAXN],top;</span><br><span class="line"><span class="keyword">bool</span> _cmp(Point p1,Point p2)</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> tmp = (p1-<span class="built_in">list</span>[<span class="number">0</span>])^(p2-<span class="built_in">list</span>[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">if</span>(tmp &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(tmp == <span class="number">0</span> &amp;&amp; dist2(p1,<span class="built_in">list</span>[<span class="number">0</span>]) &lt;= dist2(p2,<span class="built_in">list</span>[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Graham</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  Point p0;</span><br><span class="line">  <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">  p0 = <span class="built_in">list</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">    <span class="keyword">if</span>(p0.y &gt; <span class="built_in">list</span>[i].y || (p0.y == <span class="built_in">list</span>[i].y &amp;&amp; p0.x &gt; <span class="built_in">list</span>[i].x))</span><br><span class="line">    {</span><br><span class="line">      p0 = <span class="built_in">list</span>[i];</span><br><span class="line">      k = i;</span><br><span class="line">    }</span><br><span class="line">  swap(<span class="built_in">list</span>[k],<span class="built_in">list</span>[<span class="number">0</span>]);</span><br><span class="line">  sort(<span class="built_in">list</span>+<span class="number">1</span>,<span class="built_in">list</span>+n,_cmp);</span><br><span class="line">  <span class="keyword">if</span>(n == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    top = <span class="number">1</span>;</span><br><span class="line">    Stack[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(n == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    top = <span class="number">2</span>;</span><br><span class="line">    Stack[<span class="number">0</span>] = <span class="number">0</span>; Stack[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  Stack[<span class="number">0</span>] = <span class="number">0</span>; Stack[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  top = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; n;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">while</span>(top &gt; <span class="number">1</span> &amp;&amp; ((<span class="built_in">list</span>[Stack[top-<span class="number">1</span>]]-<span class="built_in">list</span>[Stack[top-<span class="number">2</span>]])^(<span class="built_in">list</span>[i]-<span class="built_in">list</span>[Stack[top-<span class="number">2</span>]])) &lt;= <span class="number">0</span>)</span><br><span class="line">      top--;</span><br><span class="line">    Stack[top++] = i;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//旋转卡壳，求两点间距离平方的最大值</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotating_calipers</span><span class="params">(Point p[],<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  Point v;</span><br><span class="line">  <span class="keyword">int</span> cur = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">  {</span><br><span class="line">    v = p[i]-p[(i+<span class="number">1</span>)%n];</span><br><span class="line">    <span class="keyword">while</span>((v^(p[(cur+<span class="number">1</span>)%n]-p[cur])) &lt; <span class="number">0</span>)</span><br><span class="line">      cur = (cur+<span class="number">1</span>)%n;</span><br><span class="line">    ans = max(ans,max(dist2(p[i],p[cur]),dist2(p[(i+<span class="number">1</span>)%n],p[(cur+<span class="number">1</span>)%n])));</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line">Point p[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> n;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="built_in">list</span>[i].input();</span><br><span class="line">    Graham(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; top;i++)p[i] = <span class="built_in">list</span>[Stack[i]];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,rotating_calipers(p,top));</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.2 求解平面点集最大三角形 旋转卡壳</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rotating_calipers</span><span class="params">(Point p[],<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  Point v;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> j = (i+<span class="number">1</span>)%n;</span><br><span class="line">    <span class="keyword">int</span> k = (j+<span class="number">1</span>)%n;</span><br><span class="line">    <span class="keyword">while</span>(j != i &amp;&amp; k != i)</span><br><span class="line">    {</span><br><span class="line">      ans = max(ans,<span class="built_in">abs</span>((p[j]-p[i])^(p[k]-p[i])));</span><br><span class="line">      <span class="keyword">while</span>( ((p[i]-p[j])^(p[(k+<span class="number">1</span>)%n]-p[k])) &lt; <span class="number">0</span> )</span><br><span class="line">        k = (k+<span class="number">1</span>)%n;</span><br><span class="line">      j = (j+<span class="number">1</span>)%n;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line">Point p[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> n;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(n == -<span class="number">1</span>)<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="built_in">list</span>[i].input();</span><br><span class="line">    Graham(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; top;i++)p[i] = <span class="built_in">list</span>[Stack[i]];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.2f\n"</span>,(<span class="keyword">double</span>)rotating_calipers(p,top)/<span class="number">2</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.3 求解两凸包最小距离 POJ 3608</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-8</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">fabs</span>(x) &lt; eps)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(x &lt; <span class="number">0</span>)<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> Point</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">double</span> x,y;</span><br><span class="line">  Point(<span class="keyword">double</span> _x = <span class="number">0</span>,<span class="keyword">double</span> _y = <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  {</span><br><span class="line">    x = _x; y = _y;</span><br><span class="line">  }</span><br><span class="line">  Point <span class="keyword">operator</span> -(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> Point(x - b.x, y - b.y);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> ^(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.y - y*b.x;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">double</span> <span class="keyword">operator</span> *(<span class="keyword">const</span> Point &amp;b)<span class="keyword">const</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> x*b.x + y*b.y;</span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span><br><span class="line">  </span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>,&amp;x,&amp;y);</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="keyword">struct</span> Line</span><br><span class="line">{</span><br><span class="line">  Point s,e;</span><br><span class="line">  Line(){}</span><br><span class="line">  Line(Point _s,Point _e)</span><br><span class="line">  {</span><br><span class="line">    s = _s; e = _e;</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"><span class="comment">//两点间距离</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dist</span><span class="params">(Point a,Point b)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sqrt</span>((a-b)*(a-b));</span><br><span class="line">}</span><br><span class="line"><span class="comment">//点到线段的距离，返回点到线段最近的点</span></span><br><span class="line"><span class="function">Point <span class="title">NearestPointToLineSeg</span><span class="params">(Point P,Line L)</span></span><br><span class="line"></span>{</span><br><span class="line">  Point result;</span><br><span class="line">  <span class="keyword">double</span> t = ((P-L.s)*(L.e-L.s))/((L.e-L.s)*(L.e-L.s));</span><br><span class="line">  <span class="keyword">if</span>(t &gt;=<span class="number">0</span> &amp;&amp; t &lt;= <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    result.x = L.s.x + (L.e.x - L.s.x)*t;</span><br><span class="line">    result.y = L.s.y + (L.e.y - L.s.y)*t;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(dist(P,L.s) &lt; dist(P,L.e))</span><br><span class="line">      result = L.s;</span><br><span class="line">    <span class="keyword">else</span> result = L.e;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span><br><span class="line"> * 求凸包，Graham算法</span><br><span class="line"> * 点的编号0~n-1</span><br><span class="line"> * 返回凸包结果Stack[0~top-1]为凸包的编号</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10010</span>;</span><br><span class="line">Point <span class="built_in">list</span>[MAXN];</span><br><span class="line"><span class="keyword">int</span> Stack[MAXN],top;</span><br><span class="line"><span class="comment">//相对于list[0]的极角排序</span></span><br><span class="line"><span class="keyword">bool</span> _cmp(Point p1,Point p2)</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">double</span> tmp = (p1-<span class="built_in">list</span>[<span class="number">0</span>])^(p2-<span class="built_in">list</span>[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">if</span>(sgn(tmp) &gt; <span class="number">0</span>)<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(sgn(tmp) == <span class="number">0</span> &amp;&amp; sgn(dist(p1,<span class="built_in">list</span>[<span class="number">0</span>]) - dist(p2,<span class="built_in">list</span>[<span class="number">0</span>])) &lt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Graham</span><span class="params">(<span class="keyword">int</span> n)</span></span><br><span class="line"></span>{</span><br><span class="line">  Point p0;</span><br><span class="line">  <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">  p0 = <span class="built_in">list</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">//找最下边的一个点</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>( (p0.y &gt; <span class="built_in">list</span>[i].y) || (p0.y == <span class="built_in">list</span>[i].y &amp;&amp; p0.x &gt; <span class="built_in">list</span>[i].x) )</span><br><span class="line">    {</span><br><span class="line">      p0 = <span class="built_in">list</span>[i];</span><br><span class="line">      k = i;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  swap(<span class="built_in">list</span>[k],<span class="built_in">list</span>[<span class="number">0</span>]);</span><br><span class="line">  sort(<span class="built_in">list</span>+<span class="number">1</span>,<span class="built_in">list</span>+n,_cmp);</span><br><span class="line">  <span class="keyword">if</span>(n == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    top = <span class="number">1</span>;</span><br><span class="line">    Stack[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(n == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    top = <span class="number">2</span>;</span><br><span class="line">    Stack[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    Stack[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  }</span><br><span class="line">  Stack[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  Stack[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  top = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; n;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">while</span>(top &gt; <span class="number">1</span> &amp;&amp; sgn((<span class="built_in">list</span>[Stack[top-<span class="number">1</span>]]-<span class="built_in">list</span>[Stack[top-<span class="number">2</span>]])^(<span class="built_in">list</span>[i]-<span class="built_in">list</span>[Stack[top-<span class="number">2</span>]])) &lt;= <span class="number">0</span>)</span><br><span class="line">      top--;</span><br><span class="line">    Stack[top++] = i;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//点p0到线段p1p2的距离</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">pointtoseg</span><span class="params">(Point p0,Point p1,Point p2)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> dist(p0,NearestPointToLineSeg(p0,Line(p1,p2)));</span><br><span class="line">}</span><br><span class="line"><span class="comment">//平行线段p0p1和p2p3的距离</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dispallseg</span><span class="params">(Point p0,Point p1,Point p2,Point p3)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">double</span> ans1 = min(pointtoseg(p0,p2,p3),pointtoseg(p1,p2,p3));</span><br><span class="line">  <span class="keyword">double</span> ans2 = min(pointtoseg(p2,p0,p1),pointtoseg(p3,p0,p1));</span><br><span class="line">  <span class="keyword">return</span> min(ans1,ans2);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//得到向量a1a2和b1b2的位置关系</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">Get_angle</span><span class="params">(Point a1,Point a2,Point b1,Point b2)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> (a2-a1)^(b1-b2);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">rotating_calipers</span><span class="params">(Point p[],<span class="keyword">int</span> np,Point q[],<span class="keyword">int</span> nq)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> sp = <span class="number">0</span>, sq = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; np;i++)</span><br><span class="line">    <span class="keyword">if</span>(sgn(p[i].y - p[sp].y) &lt; <span class="number">0</span>)</span><br><span class="line">      sp = i;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; nq;i++)</span><br><span class="line">    <span class="keyword">if</span>(sgn(q[i].y - q[sq].y) &gt; <span class="number">0</span>)</span><br><span class="line">      sq = i;</span><br><span class="line">  <span class="keyword">double</span> tmp;</span><br><span class="line">  <span class="keyword">double</span> ans = dist(p[sp],q[sq]);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; np;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">while</span>(sgn(tmp = Get_angle(p[sp],p[(sp+<span class="number">1</span>)%np],q[sq],q[(sq+<span class="number">1</span>)%nq])) &lt; <span class="number">0</span>)</span><br><span class="line">      sq = (sq+<span class="number">1</span>)%nq;</span><br><span class="line">    <span class="keyword">if</span>(sgn(tmp) == <span class="number">0</span>)</span><br><span class="line">      ans = min(ans,dispallseg(p[sp],p[(sp+<span class="number">1</span>)%np],q[sq],q[(sq+<span class="number">1</span>)%nq]));</span><br><span class="line">    <span class="keyword">else</span> ans = min(ans,pointtoseg(q[sq],p[sp],p[(sp+<span class="number">1</span>)%np]));</span><br><span class="line">    sp = (sp+<span class="number">1</span>)%np;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">solve</span><span class="params">(Point p[],<span class="keyword">int</span> n,Point q[],<span class="keyword">int</span> m)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> min(rotating_calipers(p,n,q,m),rotating_calipers(q,m,p,n));</span><br><span class="line">}</span><br><span class="line">Point p[MAXN],q[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> n,m;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m) == <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(n == <span class="number">0</span> &amp;&amp; m == <span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">      <span class="built_in">list</span>[i].input();</span><br><span class="line">    Graham(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; top;i++)</span><br><span class="line">      p[i] = <span class="built_in">list</span>[i];</span><br><span class="line">    n = top;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; m;i++)</span><br><span class="line">      <span class="built_in">list</span>[i].input();</span><br><span class="line">    Graham(m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; top;i++)</span><br><span class="line">      q[i] = <span class="built_in">list</span>[i];</span><br><span class="line">    m = top;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.4f\n"</span>,solve(p,n,q,m));</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="其他">其他</h2><h3 id="三分查找">三分查找</h3><figure class="highlight cpp"><figcaption><span>ternary.cpp</span><a href="/code/scl/ternary.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">f是傳入的函數，eps表示精準度，通常設為1e-5</span><br><span class="line">l,r為邊界，所以必須先預估出極值點的位置 </span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _F&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">ternary_search</span><span class="params">(_F f,<span class="keyword">double</span> l,<span class="keyword">double</span> r,<span class="keyword">double</span> eps)</span></span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> m1,m2;</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;eps){</span><br><span class="line">        m1=l+(r-l)/<span class="number">3</span>; m2=l+(r-l)*<span class="number">2</span>/<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(f(m1)&gt;f(m2))l=m1;<span class="comment">/*如果對象是倒U型函數，則改成 &lt; */</span></span><br><span class="line">        <span class="keyword">else</span> r=m2;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span> x)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> x*x-<span class="number">2</span>*x+<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%.6f\n"</span>,ternary_search(f,-<span class="number">10</span>,<span class="number">10</span>,<span class="number">1e-6</span>)); <span class="comment">/*假設邊界為-10~10*/</span></span><br></pre></td></tr></table></figure>
<h3 id="防爆棧">防爆棧</h3>
<h3 id="輸入掛">輸入掛</h3><figure class="highlight cpp"><figcaption><span>fastio.h</span><a href="/code/Template/fastio.h">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Name : Fast Input/Output 快速读入</span></span><br><span class="line"><span class="comment">// Copyright : fateud.com</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef FASTIO_H_</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> FASTIO_H_ 20151122L</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;ctype.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifndef BUF_SIZE</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> BUF_SIZE (20 &lt;&lt; 20) <span class="comment">// KB(&lt;&lt; 10), MB(&lt;&lt; 20).</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> csl {</span><br><span class="line">  <span class="keyword">namespace</span> fastio {</span><br><span class="line">    <span class="keyword">char</span> BUF[BUF_SIZE];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>* ptr;</span><br><span class="line">    <span class="keyword">char</span>* end;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>{</span><br><span class="line">      ptr = BUF;</span><br><span class="line">      end = BUF + fread(BUF, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), BUF_SIZE, stdin);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> </span>{</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">char</span>* __x = ptr; __x &lt; end; ++__x) {</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isspace</span>(*__x)) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isalnum</span>(*__x)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">nextInt</span><span class="params">(_Tp&amp; __x)</span> </span>{</span><br><span class="line">      __x = _Tp();</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">bool</span> __vf = <span class="number">0</span>, __sf = <span class="number">0</span>; <span class="keyword">true</span>; ++ptr) {</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isdigit</span>(*ptr)) __x = (__x &lt;&lt; <span class="number">3</span>) + (__x &lt;&lt; <span class="number">1</span>) + *ptr - <span class="string">'0'</span>, __vf = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(__vf) {</span><br><span class="line">          <span class="keyword">if</span>(__sf) __x = -__x;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(*ptr == <span class="string">'-'</span>) __sf = <span class="keyword">true</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">nextChar</span><span class="params">(<span class="keyword">char</span>&amp; __x)</span> </span>{</span><br><span class="line">      __x = *ptr, ++ptr;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">nextStr</span><span class="params">(<span class="keyword">char</span>* __s)</span> </span>{</span><br><span class="line">      <span class="keyword">for</span>(; (*__s = *ptr); ++__s, ++ptr);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  } <span class="comment">// namespace fastio</span></span><br><span class="line"></span><br><span class="line">} <span class="comment">// namespace csl</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span> /* FASTIO_H_ */</span></span><br></pre></td></tr></table></figure>
<h3 id="黑科技">黑科技</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">堆</span><br><span class="line">ext/pb_ds/priority_queue.hpp</span><br><span class="line">不可变化 <span class="keyword">binary_heap_t</span>ag</span><br><span class="line">可变化 <span class="keyword">pairing_heap_t</span>ag</span><br><span class="line"></span><br><span class="line">树</span><br><span class="line">ext/pb_ds/assoc_container.hpp</span><br><span class="line">ext/pb_ds/tree_policy.hpp</span><br><span class="line"><span class="keyword">null_t</span>ree_node_update</span><br><span class="line">tree_order_statistics_node_update</span><br><span class="line"><span class="keyword">rb_tree_t</span>ag</span><br><span class="line"></span><br><span class="line">哈希表</span><br><span class="line">ext/pb_ds/assoc_container.hpp</span><br><span class="line">ext/pb_ds/hash_policy.hpp</span><br><span class="line">__gnu_pbds::<span class="keyword">cc_hash_t</span>able &lt;Key, Mapped&gt;</span><br><span class="line">__gnu_pbds::<span class="keyword">gp_hash_t</span>able &lt;Key, Mapped&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> __builtin_ffs (x)</span><br><span class="line">返回x的最后一位<span class="number">1</span>的是从后向前第几位</span><br><span class="line"><span class="keyword">int</span> __builtin_clz (x)</span><br><span class="line">返回前导的<span class="number">0</span>的个数</span><br><span class="line"><span class="keyword">int</span> __builtin_ctz (x)</span><br><span class="line">返回后面的<span class="number">0</span>个个数，和__builtin_clz相对</span><br><span class="line"><span class="keyword">int</span> __builtin_popcount (x)</span><br><span class="line">返回二进制表示中<span class="number">1</span>的个数</span><br><span class="line"><span class="keyword">int</span> __builtin_parity (x)</span><br><span class="line">返回x的奇偶校验位，也就是x的<span class="number">1</span>的个数模<span class="number">2</span>的结果</span><br><span class="line">__gcd(value1, value2)</span><br><span class="line">欧几里得算法</span><br></pre></td></tr></table></figure>
<h3 id="整數拆分">整數拆分</h3><figure class="highlight cpp"><figcaption><span>split.cpp</span><a href="/code/scl/split.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HDU 4651</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">100010</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line">  dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">100000</span>;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>, r = <span class="number">1</span>; i - (<span class="number">3</span> * j * j - j) / <span class="number">2</span> &gt;= <span class="number">0</span>; j++, r *= -<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      dp[i] += dp[i -(<span class="number">3</span> * j * j - j) / <span class="number">2</span>] * r;</span><br><span class="line">      dp[i] %= MOD;</span><br><span class="line">      dp[i] = (dp[i]+MOD)%MOD;</span><br><span class="line">      <span class="keyword">if</span>( i - (<span class="number">3</span> * j * j + j) / <span class="number">2</span> &gt;= <span class="number">0</span> )</span><br><span class="line">        {</span><br><span class="line">        dp[i] += dp[i - (<span class="number">3</span> * j * j + j) / <span class="number">2</span>] * r;</span><br><span class="line">        dp[i] %= MOD;</span><br><span class="line">        dp[i] = (dp[i]+MOD)%MOD;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="keyword">int</span> n;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>(T--)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dp[n]);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//HDU 4658</span></span><br><span class="line"><span class="comment">//数 n(&lt;=10^5)的划分，相同数重复不能超过k个的划分</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">100010</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</span><br><span class="line">  dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">100000</span>;i++)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>, r = <span class="number">1</span>; i - (<span class="number">3</span> * j * j - j) / <span class="number">2</span> &gt;= <span class="number">0</span>; j++, r *= -<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      dp[i] += dp[i -(<span class="number">3</span> * j * j - j) / <span class="number">2</span>] * r;</span><br><span class="line">      dp[i] %= MOD;</span><br><span class="line">      dp[i] = (dp[i]+MOD)%MOD;</span><br><span class="line">      <span class="keyword">if</span>( i - (<span class="number">3</span> * j * j + j) / <span class="number">2</span> &gt;= <span class="number">0</span> )</span><br><span class="line">      {</span><br><span class="line">        dp[i] += dp[i - (<span class="number">3</span> * j * j + j) / <span class="number">2</span>] * r;</span><br><span class="line">        dp[i] %= MOD;</span><br><span class="line">        dp[i] = (dp[i]+MOD)%MOD;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> k)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> ans = dp[n];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>, r = -<span class="number">1</span>; n - k*(<span class="number">3</span> * j * j - j) / <span class="number">2</span> &gt;= <span class="number">0</span>; j++, r *= -<span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">    ans += dp[n -k*(<span class="number">3</span> * j * j - j) / <span class="number">2</span>] * r;</span><br><span class="line">    ans %= MOD;</span><br><span class="line">    ans = (ans+MOD)%MOD;</span><br><span class="line">    <span class="keyword">if</span>( n - k*(<span class="number">3</span> * j * j + j) / <span class="number">2</span> &gt;= <span class="number">0</span> )</span><br><span class="line">    {</span><br><span class="line">      ans += dp[n - k*(<span class="number">3</span> * j * j + j) / <span class="number">2</span>] * r;</span><br><span class="line">      ans %= MOD;</span><br><span class="line">      ans = (ans+MOD)%MOD;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  init();</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="keyword">int</span> n,k;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>(T--)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,solve(n,k));</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h3 id="樹鏈剖分">樹鏈剖分</h3><figure class="highlight cpp"><figcaption><span>chain.cpp</span><a href="/code/scl/chain.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.1 点权 基于点权，查询单值修改路径的上的点权</span></span><br><span class="line"><span class="comment">// HDU 3966 树链剖分 树状数组</span></span><br><span class="line"><span class="comment">// 题意：给一棵树，并给定各个点权的值，然后有3种操作：</span></span><br><span class="line"><span class="comment">// I C1 C2 K: 把C1与C2的路径上的所有点权值加上K</span></span><br><span class="line"><span class="comment">// D C1 C2 K：把C1与C2的路径上的所有点权值减去K</span></span><br><span class="line"><span class="comment">// Q C：查询节点编号为C的权值</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">50010</span>;</span><br><span class="line"><span class="keyword">struct</span> Edge</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> to,next;</span><br><span class="line">}edge[MAXN*<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN],tot;</span><br><span class="line"><span class="keyword">int</span> top[MAXN];<span class="comment">//top[v] 表示v所在的重链的顶端节点</span></span><br><span class="line"><span class="keyword">int</span> fa[MAXN];<span class="comment">//父亲节点</span></span><br><span class="line"><span class="keyword">int</span> deep[MAXN];<span class="comment">//深度</span></span><br><span class="line"><span class="keyword">int</span> num[MAXN];<span class="comment">//num[v] 表示以v为根的子树的节点数</span></span><br><span class="line"><span class="keyword">int</span> p[MAXN];<span class="comment">//p[v]表示v对应的位置</span></span><br><span class="line"><span class="keyword">int</span> fp[MAXN];<span class="comment">//fp和p数组相反</span></span><br><span class="line"><span class="keyword">int</span> son[MAXN];<span class="comment">//重儿子</span></span><br><span class="line"><span class="keyword">int</span> pos;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  tot = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(head,-<span class="number">1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">  pos = <span class="number">1</span>;<span class="comment">//使用树状数组，编号从头1开始</span></span><br><span class="line">  <span class="built_in">memset</span>(son,-<span class="number">1</span>,<span class="keyword">sizeof</span>(son));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  edge[tot].to = v; edge[tot].next = head[u]; head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pre,<span class="keyword">int</span> d)</span></span><br><span class="line"></span>{</span><br><span class="line">  deep[u] = d;</span><br><span class="line">  fa[u] = pre;</span><br><span class="line">  num[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];i != -<span class="number">1</span>; i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>(v != pre)</span><br><span class="line">    {</span><br><span class="line">      dfs1(v,u,d+<span class="number">1</span>);</span><br><span class="line">      num[u] += num[v];</span><br><span class="line">      <span class="keyword">if</span>(son[u] == -<span class="number">1</span> || num[v] &gt; num[son[u]])</span><br><span class="line">        son[u] = v;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getpos</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> sp)</span></span><br><span class="line"></span>{</span><br><span class="line">  top[u] = sp;</span><br><span class="line">  p[u] = pos++;</span><br><span class="line">  fp[p[u]] = u;</span><br><span class="line">  <span class="keyword">if</span>(son[u] == -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">  getpos(son[u],sp);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];i != -<span class="number">1</span>;i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>( v != son[u] &amp;&amp; v != fa[u])</span><br><span class="line">      getpos(v,v);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//树状数组</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> c[MAXN];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> i)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(i &gt; <span class="number">0</span>)</span><br><span class="line">  {</span><br><span class="line">    s += c[i];</span><br><span class="line">    i -= lowbit(i);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> val)</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">while</span>(i &lt;= n)</span><br><span class="line">  {</span><br><span class="line">    c[i] += val;</span><br><span class="line">    i += lowbit(i);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Change</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> val)</span><span class="comment">//u-&gt;v的路径上点的值改变val</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> f1 = top[u], f2 = top[v];</span><br><span class="line">  <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(f1 != f2)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(deep[f1] &lt; deep[f2])</span><br><span class="line">    {</span><br><span class="line">      swap(f1,f2);</span><br><span class="line">      swap(u,v);</span><br><span class="line">    }</span><br><span class="line">    add(p[f1],val);</span><br><span class="line">    add(p[u]+<span class="number">1</span>,-val);</span><br><span class="line">    u = fa[f1];</span><br><span class="line">    f1 = top[u];</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(deep[u] &gt; deep[v]) swap(u,v);</span><br><span class="line">  add(p[u],val);</span><br><span class="line">  add(p[v]+<span class="number">1</span>,-val);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> a[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> M,P;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;n,&amp;M,&amp;P) == <span class="number">3</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> u,v;</span><br><span class="line">    <span class="keyword">int</span> C1,C2,K;</span><br><span class="line">    <span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(M--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">      addedge(u,v);</span><br><span class="line">      addedge(v,u);</span><br><span class="line">    }</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    getpos(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="keyword">sizeof</span>(c));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">    {</span><br><span class="line">      add(p[i],a[i]);</span><br><span class="line">      add(p[i]+<span class="number">1</span>,-a[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(P--)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line">      <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'Q'</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;u);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,sum(p[u]));</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;C1,&amp;C2,&amp;K);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'D'</span>)</span><br><span class="line">          K = -K;</span><br><span class="line">        Change(C1,C2,K);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 3.2 边权  基于边权 修改单条边权 查询路径边权最大值</span></span><br><span class="line"><span class="comment">// SPOJ QTREE 树链剖分 线段树</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">10010</span>;</span><br><span class="line"><span class="keyword">struct</span> Edge</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> to,next;</span><br><span class="line">}edge[MAXN*<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> head[MAXN],tot;</span><br><span class="line"><span class="keyword">int</span> top[MAXN];<span class="comment">//top[v]表示v所在的重链的顶端节点</span></span><br><span class="line"><span class="keyword">int</span> fa[MAXN]; <span class="comment">//父亲节点</span></span><br><span class="line"><span class="keyword">int</span> deep[MAXN];<span class="comment">//深度</span></span><br><span class="line"><span class="keyword">int</span> num[MAXN];<span class="comment">//num[v]表示以v为根的子树的节点数</span></span><br><span class="line"><span class="keyword">int</span> p[MAXN];<span class="comment">//p[v]表示v与其父亲节点的连边在线段树中的位置</span></span><br><span class="line"><span class="keyword">int</span> fp[MAXN];<span class="comment">//和p数组相反</span></span><br><span class="line"><span class="keyword">int</span> son[MAXN];<span class="comment">//重儿子</span></span><br><span class="line"><span class="keyword">int</span> pos;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  tot = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(head,-<span class="number">1</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">  pos = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(son,-<span class="number">1</span>,<span class="keyword">sizeof</span>(son));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span><br><span class="line"></span>{</span><br><span class="line">  edge[tot].to = v;edge[tot].next = head[u];head[u] = tot++;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pre,<span class="keyword">int</span> d)</span> <span class="comment">//第一遍dfs求出fa,deep,num,son</span></span><br><span class="line"></span>{</span><br><span class="line">  deep[u] = d;</span><br><span class="line">  fa[u] = pre;</span><br><span class="line">  num[u] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];i != -<span class="number">1</span>; i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>(v != pre)</span><br><span class="line">    {</span><br><span class="line">      dfs1(v,u,d+<span class="number">1</span>);</span><br><span class="line">      num[u] += num[v];</span><br><span class="line">      <span class="keyword">if</span>(son[u] == -<span class="number">1</span> || num[v] &gt; num[son[u]])</span><br><span class="line">        son[u] = v;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getpos</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> sp)</span> <span class="comment">//第二遍dfs求出top和p</span></span><br><span class="line"></span>{</span><br><span class="line">  top[u] = sp;</span><br><span class="line">  p[u] = pos++;</span><br><span class="line">  fp[p[u]] = u;</span><br><span class="line">  <span class="keyword">if</span>(son[u] == -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">  getpos(son[u],sp);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u] ; i != -<span class="number">1</span>; i = edge[i].next)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">    <span class="keyword">if</span>(v != son[u] &amp;&amp; v != fa[u])</span><br><span class="line">      getpos(v,v);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//线段树</span></span><br><span class="line"><span class="keyword">struct</span> Node</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> l,r;</span><br><span class="line">  <span class="keyword">int</span> Max;</span><br><span class="line">}segTree[MAXN*<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span><br><span class="line"></span>{</span><br><span class="line">  segTree[i].l = l;</span><br><span class="line">  segTree[i].r = r;</span><br><span class="line">  segTree[i].Max = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(l == r)<span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r)/<span class="number">2</span>;</span><br><span class="line">  build(i&lt;&lt;<span class="number">1</span>,l,mid);</span><br><span class="line">  build((i&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> i)</span></span><br><span class="line"></span>{</span><br><span class="line">  segTree[i].Max = max(segTree[i&lt;&lt;<span class="number">1</span>].Max,segTree[(i&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>].Max);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> k,<span class="keyword">int</span> val)</span> <span class="comment">// 更新线段树的第k个值为val</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(segTree[i].l == k &amp;&amp; segTree[i].r == k)</span><br><span class="line">  {</span><br><span class="line">    segTree[i].Max = val;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">int</span> mid = (segTree[i].l + segTree[i].r)/<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span>(k &lt;= mid)update(i&lt;&lt;<span class="number">1</span>,k,val);</span><br><span class="line">  <span class="keyword">else</span> update((i&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,k,val);</span><br><span class="line">  push_up(i);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> <span class="comment">//查询线段树中[l,r] 的最大值</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">if</span>(segTree[i].l == l &amp;&amp; segTree[i].r == r)</span><br><span class="line">    <span class="keyword">return</span> segTree[i].Max;</span><br><span class="line">  <span class="keyword">int</span> mid = (segTree[i].l + segTree[i].r)/<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span>(r &lt;= mid)<span class="keyword">return</span> query(i&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(l &gt; mid)<span class="keyword">return</span> query((i&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,l,r);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> max(query(i&lt;&lt;<span class="number">1</span>,l,mid),query((i&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>,mid+<span class="number">1</span>,r));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span><span class="comment">//查询u-&gt;v边的最大值</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> f1 = top[u], f2 = top[v];</span><br><span class="line">  <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(f1 != f2)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span>(deep[f1] &lt; deep[f2])</span><br><span class="line">    {</span><br><span class="line">      swap(f1,f2);</span><br><span class="line">      swap(u,v);</span><br><span class="line">    }</span><br><span class="line">    tmp = max(tmp,query(<span class="number">1</span>,p[f1],p[u]));</span><br><span class="line">    u = fa[f1]; f1 = top[u];</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(u == v)<span class="keyword">return</span> tmp;</span><br><span class="line">  <span class="keyword">if</span>(deep[u] &gt; deep[v]) swap(u,v);</span><br><span class="line">  <span class="keyword">return</span> max(tmp,query(<span class="number">1</span>,p[son[u]],p[v]));</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> e[MAXN][<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="keyword">int</span> n;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</span><br><span class="line">  <span class="keyword">while</span>(T--)</span><br><span class="line">  {</span><br><span class="line">    init();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n-<span class="number">1</span>;i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;e[i][<span class="number">0</span>],&amp;e[i][<span class="number">1</span>],&amp;e[i][<span class="number">2</span>]);</span><br><span class="line">      addedge(e[i][<span class="number">0</span>],e[i][<span class="number">1</span>]);</span><br><span class="line">      addedge(e[i][<span class="number">1</span>],e[i][<span class="number">0</span>]);</span><br><span class="line">    }</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    getpos(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">0</span>,pos-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n-<span class="number">1</span>; i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(deep[e[i][<span class="number">0</span>]] &gt; deep[e[i][<span class="number">1</span>]])</span><br><span class="line">        swap(e[i][<span class="number">0</span>],e[i][<span class="number">1</span>]);</span><br><span class="line">      update(<span class="number">1</span>,p[e[i][<span class="number">1</span>]],e[i][<span class="number">2</span>]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> u,v;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,op) == <span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'D'</span>)<span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</span><br><span class="line">      <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'Q'</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,find(u,v));<span class="comment">//查询u-&gt;v路径上边权的最大值</span></span><br><span class="line">      <span class="keyword">else</span> update(<span class="number">1</span>,p[e[u-<span class="number">1</span>][<span class="number">1</span>]],v);<span class="comment">//修改第u条边的长度为v</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://fateud.com/acm/scl2016.html" data-title="Standard Code Library 2016 | Fate / Unlimited Darkness" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
        </div>
        <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m ChouUn. <br/>
			This is my blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/fateud" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/ChouUn" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		<a href="https://www.facebook.com/100007530586100" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		<a href="http://www.zhihu.com/people/fateud" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/117134980329222155883?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:chouunsoft@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-sa/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-sa.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="ChouUn">ChouUn</a>
		
		
		</p>
</div>
</footer>
        <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'chouun';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-64280533-1', 'auto');  
  ga('send', 'pageview');
</script>



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F929e5e450ad28647a403dcd2b682acea' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

      </body>
     </html>
     
